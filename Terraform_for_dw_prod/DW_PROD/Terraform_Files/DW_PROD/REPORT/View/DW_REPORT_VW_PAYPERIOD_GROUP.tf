resource "snowflake_view" "DW_REPORT_VW_PAYPERIOD_GROUP" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "REPORT"
	name = "VW_PAYPERIOD_GROUP"
	statement = <<-SQL
	 
SELECT DISTINCT OFFICE_STATE_CODE, 
CASE 
WHEN PP.OFFICE_STATE_CODE IN ('GA','SC') AND D2.DAY_NAME='Fri' THEN 1
WHEN PP.OFFICE_STATE_CODE IN ('GA','SC') AND D2.DAY_NAME='Tue' THEN 2
WHEN PP.OFFICE_STATE_CODE IN ('IL','MI','MO','KY','AL','MS','IN','TN') THEN 3
WHEN PP.OFFICE_STATE_CODE IN ('PA') THEN 4
END AS SOURCE_SYSTEM_ID,
CASE 
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 13 AND PP.OFFICE_STATE_CODE IN ('GA','IL','MI','MO','SC') 
AND SOURCE_SYSTEM_ID IN (1,3) THEN 'BIWEEKLY - 1'
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 13 AND PP.OFFICE_STATE_CODE IN ('GA','SC') 
AND SOURCE_SYSTEM_ID IN (2) THEN 'BIWEEKLY - 4' 
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 20 AND PP.OFFICE_STATE_CODE IN ('AL','MS') 
THEN 'BIWEEKLY - 2'
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 6 AND PP.OFFICE_STATE_CODE IN ('IN','KY','TN') 
THEN 'BIWEEKLY - 3'
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 6 AND PP.OFFICE_STATE_CODE IN ('PA') 
THEN 'WEEKLY'
END AS PAYPERIODFREQUENCY,
D.DAY_NAME AS PAYPERIOD_FIRST_DAY, 
D2.DAY_NAME AS PAYROLL_DAY,
CASE 
WHEN PP.OFFICE_STATE_CODE IN ('GA','IL','MI','MO','SC') AND SOURCE_SYSTEM_ID IN (1,3) THEN 'GA ,IL ,MI ,MO ,SC'
WHEN PP.OFFICE_STATE_CODE IN ('GA','SC') AND SOURCE_SYSTEM_ID IN (2) THEN 'GA ,SC'
WHEN PP.OFFICE_STATE_CODE IN ('AL','MS') THEN 'AL ,MS'
WHEN PP.OFFICE_STATE_CODE IN ('IN','KY','TN') THEN 'IN ,KY ,TN'
WHEN PP.OFFICE_STATE_CODE = 'PA' THEN 'PA'
END AS OFFICE_CODE_JOIN
FROM HAH.FACT_BRANCH_PAYROLL_PERIODS PP
LEFT JOIN HAH.DIM_DATE D ON PP.PERIOD_START_DATE = D.CALENDAR_DATE 
LEFT JOIN HAH.DIM_DATE D2 ON PP.CHECK_DATE = D2.CALENDAR_DATE
WHERE PAYPERIODFREQUENCY IS NOT NULL
ORDER BY PAYPERIODFREQUENCY,OFFICE_STATE_CODE;
SQL
	or_replace = true 
	is_secure = false 
}

