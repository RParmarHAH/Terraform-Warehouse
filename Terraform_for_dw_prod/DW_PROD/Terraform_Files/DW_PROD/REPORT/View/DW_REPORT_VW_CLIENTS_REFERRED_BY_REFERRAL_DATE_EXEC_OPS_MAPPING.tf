resource "snowflake_view" "DW_REPORT_VW_CLIENTS_REFERRED_BY_REFERRAL_DATE_EXEC_OPS_MAPPING" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "REPORT"
	name = "VW_CLIENTS_REFERRED_BY_REFERRAL_DATE_EXEC_OPS_MAPPING"
	statement = <<-SQL
	 
SELECT 
FIRST_CONTRACT_KEY,
FIRST_CONTRACT_CODE,
FIRST_ADJUSTED_AUTH_HOURS,
FIRST_NON_ADJUSTED_AUTH_HOURS,
NEXT_SCHEDULED_VISIT_DATE,
CLIENT_NUMBER,
CLIENT_KEY,
R.SYSTEM_CODE,
R.SOURCE_SYSTEM_ID,
CLIENT_NAME,
CLIENT_HOME_PHONE,
CLIENT_WORK_PHONE,
SUPERVISOR_KEY,
BRANCH_KEY,
FIRST_VISIT_DATE,
LATEST_VISIT_DATE,
REFERRED_DATE,
DAYS_TO_SERVICE,
OPEN_REFERRAL,
REFERRAL_AGE,
FIRST_CONTRACT_BEGIN_DATE,
END_DATE,
R.REFERRER_KEY ,
R.REFERRALS  AS REFERRAL_SOURCE
FROM DW_${var.SF_ENVIRONMENT}.REPORT.CLIENTS_REFERRED R
LEFT JOIN DW_${var.SF_ENVIRONMENT}.REPORT.VW_DASHBOARD_CONTRACTS DC ON DC.CONTRACT_KEY=R.FIRST_CONTRACT_KEY
WHERE DC.INCLUDE_FOR_EXEC_OPS_CLIENTS = 1 AND R.REFERRED_DATE BETWEEN DATEADD('YEAR',-2,DATE_TRUNC('YEAR',CURRENT_DATE)) AND CURRENT_DATE;
SQL
	or_replace = true 
	is_secure = false 
}

