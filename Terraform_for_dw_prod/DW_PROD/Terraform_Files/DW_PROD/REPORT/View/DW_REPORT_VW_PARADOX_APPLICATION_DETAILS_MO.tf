resource "snowflake_view" "DW_REPORT_VW_PARADOX_APPLICATION_DETAILS_MO" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "REPORT"
	name = "VW_PARADOX_APPLICATION_DETAILS_MO"
	statement = <<-SQL
	 
SELECT
    distinct
    CS.CANDIDATE_ID,
    A.FIRST_NAME "First Name",
    A.MIDDLE_NAME "Middle Name",
    A.LAST_NAME "Last Name",
    A.SSN "Social Security Number",
    A.DATE_OF_BIRTH "Date of Birth",
    A.EMAIL "Email",
    COALESCE(CS.CANDIDATE_TIMEZONE, Z.TIMEZONE) "Time zone",
    A.ADDRESS "Address",
    A.ADDRESS_LINE_2 "Address Line 2",
    A.CITY "City",
    G.STATE_ISO_CODE || ' ' || REPLACE(G.COUNTY_NAME, ' County', '') "County",
    CASE 
        WHEN TRIM(LOWER(A.STATE)) = 'pennsylvania'
            THEN 'PA'
        WHEN TRIM(LOWER(A.STATE)) = 'georgia'
            THEN 'GA'
        ELSE
            UPPER(A.STATE)
    END "State",
    A.POSTAL "Zip Code",
    CS.CANDIDATE_LOCATION_COUNTRY Country,
//    J.CITY,
    J.LOCATION_NAME "Branch (Group)",
    CASE 
        WHEN TRIM(LOWER(J.STATE)) = 'pennsylvania'
            THEN 'PA'
        WHEN TRIM(LOWER(J.STATE)) = 'georgia'
            THEN 'GA'
        WHEN TRIM(LOWER(J.STATE)) = 'missouri'
            THEN 'MO'
        ELSE
            J.STATE
    END "Branch STATE", 
    A.MOBILE_PHONE "Phone",
    A.HOME_PHONE "Home Phone",
    A.EEO_SEX "Gender",
    GL.GROUP_ID "AlayaCare Group ID",
    CCL.ID "AlayaCare Cost Center ID",
    J.JOB_TITLE "Position/Job",
    ADMIN_ROLE.ID "AlayaCare Admin Role ID",
    FIELD_ROLE.ID "AlayaCare Field Role Portal ID",
    BR.OFFICE_NUMBER "HAH office number",
    CS.CAPTURE_START_DATE CREATED_DATE,
    S.MOST_RECENT_STAGE_DATETIME UPDATED_DATE
    --,CS.candidate_location__level_2
FROM DW_${var.SF_ENVIRONMENT}.HAH.FACT_APPLICANT_STATUS S
    INNER JOIN DW_${var.SF_ENVIRONMENT}.HAH.DIM_APPLICANT A ON S.APPLICANT_KEY = A.APPLICANT_KEY
    INNER JOIN DW_${var.SF_ENVIRONMENT}.HAH.DIM_JOB J ON S.JOB_KEY = J.JOB_KEY
    LEFT JOIN DISC_${var.SF_ENVIRONMENT}.PARADOX.CANDIDATE_SPECIFIC CS ON S.CANDIDATE_ID = CS.CANDIDATE_ID
    LEFT JOIN DISC_${var.SF_ENVIRONMENT}.ALAYACARE.TBL_COST_CENTRES_TIER_4 CCL ON REGEXP_REPLACE(TRIM(UPPER(CS.CANDIDATE_LOCATION__LEVEL_2)), ' OFFICE', '') = TRIM(UPPER(CCL.PROPERTIES_DESCRIPTION)) 
    LEFT JOIN DISC_${var.SF_ENVIRONMENT}.ALAYACARE.GROUPS GL ON REGEXP_REPLACE(TRIM(UPPER(CS.CANDIDATE_LOCATION__LEVEL_2)), ' OFFICE', '') = TRIM(UPPER(GL.PROPERTIES_DESCRIPTION))
    LEFT JOIN DISC_${var.SF_ENVIRONMENT}.PARADOX.JOB_TITLE_TO_ALAYACARE_SECURITY_ROLE_MAPPING_GA ROLE_MAPPING ON UPPER(TRIM(ROLE_MAPPING.JOB_TITLE)) = UPPER(TRIM(J.JOB_TITLE))
    LEFT JOIN DISC_${var.SF_ENVIRONMENT}.PARADOX.ROLES ADMIN_ROLE ON UPPER(TRIM(ROLE_MAPPING.ALAYACARE_ADMIN_PORTAL_ROLE)) = UPPER(TRIM(ADMIN_ROLE.DESCRIPTION)) AND ADMIN_ROLE.CATEGORY = 'admin'
    LEFT JOIN DISC_${var.SF_ENVIRONMENT}.PARADOX.ROLES FIELD_ROLE ON UPPER(TRIM(ROLE_MAPPING.ALAYACARE_FIELD_PORTAL_ROLE)) = UPPER(TRIM(FIELD_ROLE.DESCRIPTION)) AND FIELD_ROLE.CATEGORY = 'staff'
    LEFT JOIN DW_${var.SF_ENVIRONMENT}.HAH.DIM_GEOGRAPHY G ON A.POSTAL = G.ZIP_CODE
    LEFT JOIN DW_${var.SF_ENVIRONMENT}.HAH.DIM_ZIP_CODE_DETAILED Z ON A.POSTAL = Z.ZIP
    LEFT JOIN DW_${var.SF_ENVIRONMENT}.HAH.DIM_BRANCH BR ON LOWER(TRIM(J.STATE)) = 'missouri' and S.BRANCH_KEY = BR.BRANCH_KEY
WHERE 
    S.APPLICANT_STATUS IN ('Hired: Hired')
    and "Branch STATE" = 'MO';
SQL
	or_replace = true 
	is_secure = false 
}

