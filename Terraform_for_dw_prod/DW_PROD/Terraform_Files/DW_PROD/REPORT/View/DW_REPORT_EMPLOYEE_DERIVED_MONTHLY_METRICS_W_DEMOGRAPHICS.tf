resource "snowflake_view" "DW_REPORT_EMPLOYEE_DERIVED_MONTHLY_METRICS_W_DEMOGRAPHICS" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "REPORT"
	name = "EMPLOYEE_DERIVED_MONTHLY_METRICS_W_DEMOGRAPHICS"
	statement = <<-SQL
	 SELECT edmv.SERVICE_MONTH, edmv.EMPLOYEE_KEY, edmv.SOURCE_SYSTEM_ID, edmv.EMPLOYEE_ID, edmv.SYSTEM_CODE, edmv.EMPLOYEE_PID, edmv.EMPLOYEE_NUMBER, edmv.PAYROLL_ID, 
       edmv.EMPLOYEE_CATEGORY, 
       edmv.FIRST_NAME, edmv.LAST_NAME, 
       emp.Employee_DOB, emp.Employee_Gender, emp.Employee_Ethnicity,
       edmv.BRANCH_KEY, edmv.BRANCH_NAME, edmv.BRANCH_STATE_CODE, 
       edmv.FIRST_SERVICE_MONTH, edmv.LAST_SERVICE_MONTH, edmv.TENURE_IN_MONTHS, edmv.NUMBER_MONTHS_WITH_SERVICE, edmv.NUMBER_MONTHS_WO_SERVICE, 
       edmv.NUMBER_OF_GAPS_IN_SERVICE, edmv.SMALLEST_GAP_IN_SERVICE, edmv.LARGEST_GAP_IN_SERVICE, 
       edmv.NEW_HIRE_FLAG, edmv.FIRST_MONTH_INACTIVE_FLAG, edmv.ACTIVE_FLAG, edmv.REACTIVATED_FLAG, 
       edmv.NUMBER_OF_SERVICE_LINES_PROVIDED, edmv.HC_SERVICE_LINE_PROVIDED, edmv.HH_SERVICE_LINE_PROVIDED, edmv.CLS_SERVICE_LINE_PROVIDED, 
       edmv.NA_SERVICE_LINE_PROVIDED, edmv.IS_SERVICE_LINE_PROVIDED, edmv.NS_SERVICE_LINE_PROVIDED, edmv.OTHER_SERVICE_LINE_PROVIDED,
       edmv.NUMBER_OF_VISITS, edmv.PREVIOUS_MONTH_NUMBER_OF_VISITS, edmv.PREVIOUS_2_MONTH_NUMBER_OF_VISITS, 
       edmv.NEXT_MONTH_NUMBER_OF_VISITS, edmv.NEXT_2_MONTH_NUMBER_OF_VISITS, 
       edmv.NUMBER_OF_DISTINCT_CLIENTS, edmv.PREVIOUS_MONTH_NUMBER_OF_DISTINCT_CLIENTS, edmv.PREVIOUS_2_MONTH_NUMBER_OF_DISTINCT_CLIENTS, 
       edmv.NEXT_MONTH_NUMBER_OF_DISTINCT_CLIENTS, edmv.NEXT_2_MONTH_NUMBER_OF_DISTINCT_CLIENTS, 
       edmv.SUM_OF_HOURS_SERVED, edmv.PREVIOUS_MONTH_SUM_OF_HOURS_SERVED, edmv.PREVIOUS_2_MONTH_SUM_OF_HOURS_SERVED, 
       edmv.NEXT_MONTH_SUM_OF_HOURS_SERVED, edmv.NEXT_2_MONTH_SUM_OF_HOURS_SERVED, 
       edmv.NUMBER_OF_HC_VISITS, edmv.NUMBER_OF_DISTINCT_HC_CLIENTS, edmv.SUM_OF_HC_HOURS_SERVED, 
       edmv.NUMBER_OF_HH_VISITS, edmv.NUMBER_OF_DISTINCT_HH_CLIENTS, edmv.SUM_OF_HH_HOURS_SERVED, 
       edmv.NUMBER_OF_CLS_VISITS, edmv.NUMBER_OF_DISTINCT_CLS_CLIENTS, edmv.SUM_OF_CLS_HOURS_SERVED, 
       edmv.NUMBER_OF_NA_VISITS, edmv.NUMBER_OF_DISTINCT_NA_CLIENTS, edmv.SUM_OF_NA_HOURS_SERVED, 
       edmv.NUMBER_OF_IS_VISITS, edmv.NUMBER_OF_DISTINCT_IS_CLIENTS, edmv.SUM_OF_IS_HOURS_SERVED, 
       edmv.NUMBER_OF_NS_VISITS, edmv.NUMBER_OF_DISTINCT_NS_CLIENTS, edmv.SUM_OF_NS_HOURS_SERVED,
	   edmv.NUMBER_OF_OTHER_VISITS,edmv.NUMBER_OF_DISTINCT_OTHER_CLIENTS,edmv.SUM_OF_OTHER_HOURS_SERVED
FROM DW_${var.SF_ENVIRONMENT}.REPORT.EMPLOYEE_DERIVED_MONTHLY_VISIT_METRICS AS edmv
INNER JOIN DW_${var.SF_ENVIRONMENT}.HAH.DIM_Employee AS emp ON edmv.Employee_Key = emp.Employee_Key;
SQL
	or_replace = true 
	is_secure = false 
}

