resource "snowflake_view" "DW_INTEGRATION_VW_EMPLOYEE_ENTERPRISE_ID_MERGED_SENT_TO_WD" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "INTEGRATION"
	name = "VW_EMPLOYEE_ENTERPRISE_ID_MERGED_SENT_TO_WD"
	statement = <<-SQL
	 SELECT CM.LATEST_ENTERPRISE_ID , CM.OLD_ENTERPRISE_ID, 
        CW_O.FIRST_NAME AS OLD_FIRST_NAME,
        CW_L.FIRST_NAME AS LATEST_FIRST_NAME,
        CW_O.LAST_NAME  AS OLD_LAST_NAME,
        CW_L.LAST_NAME AS LATEST_LAST_NAME,
        CW_O.BRANCH_STATE_CODE AS OLD_BRANCH_STATE,
        CW_L.BRANCH_STATE_CODE AS LATEST_BRANCH_STATE,
        CW_O.WORKDAY_INTERNAL_ID AS OLD_WORKDAY_INTERNAL_ID,
        CW_L.WORKDAY_INTERNAL_ID AS LATEST_WORKDAY_INTERNAL_ID
FROM DW_${var.SF_ENVIRONMENT}.INTEGRATION.EMPLOYEE_CROSS_WALK_MERGED CM
LEFT JOIN DW_${var.SF_ENVIRONMENT}.INTEGRATION.EMPLOYEE_CROSS_WALK CW_L
    ON CW_L.EMPLOYEE_ENTERPRISE_ID = CM.LATEST_ENTERPRISE_ID 
LEFT JOIN DW_${var.SF_ENVIRONMENT}.INTEGRATION.EMPLOYEE_CROSS_WALK CW_O
    ON CW_O.EMPLOYEE_ENTERPRISE_ID = CM.OLD_ENTERPRISE_ID 
WHERE MERGE_REASON ILIKE 'KEYS_MERGED'
AND OLD_ENTERPRISE_ID IN  
    (SELECT DISTINCT "Unique ID to link across tabs/files"
    FROM LOAD_WORKDAY_${var.SF_ENVIRONMENT}.IMPORT_EXTRACTS."01_NAME_DATA_GOLD_08282023" 
    );
SQL
	or_replace = true 
	is_secure = false 
}

