resource "snowflake_procedure" "DW_INTEGRATION_GET_MASTER_DIM_CLIENT_MERGED_DEDUPE" {
	name ="GET_MASTER_DIM_CLIENT_MERGED_DEDUPE"
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "INTEGRATION"
	language  = "SQL"

	arguments {
		name = "STR_ETL_TASK_KEY"
		type = "VARCHAR(16777216)"
}	

	arguments {
		name = "STR_CDC_START"
		type = "VARCHAR(16777216)"
}	

	arguments {
		name = "STR_CDC_END"
		type = "VARCHAR(16777216)"
}	
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

BEGIN
	TRUNCATE table DW_${var.SF_ENVIRONMENT}.INTEGRATION.DIM_CLIENT_MERGED_DEDUPE;
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_GA_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_AL_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_NY_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_OH_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_MICH_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_IN_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_PA_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
	CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_DE_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
    CALL DW_${var.SF_ENVIRONMENT}.INTEGRATION.GET_MASTER_DIM_CLIENT_MS_MERGED_DEDUPE(-1,''1900-01-01'',''2099-12-31'');
END;

 EOT
}

