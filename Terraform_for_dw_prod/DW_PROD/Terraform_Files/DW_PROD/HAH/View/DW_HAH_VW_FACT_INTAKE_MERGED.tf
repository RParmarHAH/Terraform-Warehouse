resource "snowflake_view" "DW_HAH_VW_FACT_INTAKE_MERGED" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "HAH"
	name = "VW_FACT_INTAKE_MERGED"
	statement = <<-SQL
	 	SELECT INTAKE.INTAKE_KEY,
		INTAKE.REPORT_DATE,
		COALESCE(BRANCH_MERGED.BRANCH_KEY, INTAKE.BRANCH_KEY) AS BRANCH_KEY,
		INTAKE.BRANCH_KEY AS ORIGINAL_BRANCH_KEY,
		COALESCE(CLIENT_MERGED.CLIENT_KEY, INTAKE.CLIENT_KEY) AS CLIENT_KEY,
		INTAKE.CLIENT_KEY AS ORIGINAL_CLIENT_KEY,
		INTAKE.CONTRACT_KEY,
		INTAKE.SOURCE_SYSTEM_ID,
		INTAKE.REAUTHORIZED_DATE,
		INTAKE.BRANCH_NAME,
		INTAKE.CLIENT_NUMBER,
		INTAKE.CONTRACT_CODE,
		INTAKE.BILL_RATE,
		INTAKE.SYSTEM_CODE,
		INTAKE.CASE_MANAGER,
		INTAKE.HOURS_AUTHORIZED,
		INTAKE.HOURS_AUTHORIZED_NON_ADJUSTED,
		INTAKE.ETL_TASK_KEY,
		INTAKE.ETL_INSERTED_TASK_KEY,
		INTAKE.ETL_INSERTED_DATE,
		INTAKE.ETL_INSERTED_BY,
		INTAKE.ETL_LAST_UPDATED_DATE,
		INTAKE.ETL_LAST_UPDATED_BY,
		INTAKE.ETL_DELETED_FLAG
	FROM HAH.FACT_INTAKE AS INTAKE
	LEFT JOIN HAH.VW_DIM_BRANCH_MERGED AS BRANCH_MERGED
		ON BRANCH_MERGED.ORIGINAL_BRANCH_KEY = INTAKE.BRANCH_KEY
	LEFT JOIN HAH.VW_DIM_CLIENT_MERGED AS CLIENT_MERGED
		ON CLIENT_MERGED.ORIGINAL_CLIENT_KEY = INTAKE.CLIENT_KEY;
SQL
	or_replace = true 
	is_secure = false 
}

