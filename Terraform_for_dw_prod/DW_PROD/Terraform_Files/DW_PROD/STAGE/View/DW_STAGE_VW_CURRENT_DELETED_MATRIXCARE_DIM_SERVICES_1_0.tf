resource "snowflake_view" "DW_STAGE_VW_CURRENT_DELETED_MATRIXCARE_DIM_SERVICES_1_0" {
	database = "DW_${var.SF_ENVIRONMENT}"
	schema = "STAGE"
	name = "VW_CURRENT_DELETED_MATRIXCARE_DIM_SERVICES_1_0"
	statement = <<-SQL
	 SELECT 
MD5('MATRIXCARE' || '-' || SVCC_ID || '-' || 'MATRIXCARE') AS SERVICE_KEY
FROM DISC_${var.SF_ENVIRONMENT}.MATRIXCARE.HIST_STVHC_T_SERVICECODE
WHERE ETL_DELETED_FLAG = TRUE AND ETL_LAST_UPDATED_DATE >= '1900-01-01'
AND CAST(ETL_LAST_UPDATED_DATE AS DATE) IN 
(SELECT MAX( ETL_LAST_UPDATED_DATE::DATE) FROM DISC_${var.SF_ENVIRONMENT}.MATRIXCARE.HIST_STVHC_T_SERVICECODE);
SQL
	or_replace = true 
	is_secure = false 
}

