CREATE OR REPLACE PROCEDURE DW_PROD.HAH.MERGE_STAGE_OSHAH_FACT_ADMISSION()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE
    return_result VARCHAR;
BEGIN
MERGE INTO DW_PROD.HAH.FACT_ADMISSION AS tgt
USING DW_PROD."STAGE".OSHAH_FACT_ADMISSION AS src
ON TGT.CLIENT_ADMISSION_KEY = SRC.CLIENT_ADMISSION_KEY
WHEN MATCHED
THEN UPDATE SET
	  tgt.SOURCE_SYSTEM_ID=src.SOURCE_SYSTEM_ID
	, tgt.SYSTEM_CODE=src.SYSTEM_CODE
	, tgt.CLIENT_KEY=src.CLIENT_KEY
	, tgt.REFERRER_KEY=src.REFERRER_KEY
	, tgt.SERVICE_KEY=src.SERVICE_KEY
	, tgt.PARTNER_CONTRACT_KEY=src.PARTNER_CONTRACT_KEY
	, tgt.PRIMARY_DIAGNOSIS_KEY=src.PRIMARY_DIAGNOSIS_KEY
	, tgt.REFERRAL_DATE=src.REFERRAL_DATE
	, tgt.REFERRAL_INTAKE_BY_EMP_KEY=src.REFERRAL_INTAKE_BY_EMP_KEY
	, tgt.REFERRAL_ACCEPTED_SERVICES=src.REFERRAL_ACCEPTED_SERVICES
	, tgt.REFERRAL_CAMPAIGN=src.REFERRAL_CAMPAIGN
	, tgt.PREVIOUS_PROVIDER=src.PREVIOUS_PROVIDER
	, tgt.ADMISSION_DATE=src.ADMISSION_DATE
	, tgt.STATUS=src.STATUS
	, tgt.PRIMARY_DIAGNOSIS=src.PRIMARY_DIAGNOSIS
	, tgt.DIAGNOSIS_NOTES=src.DIAGNOSIS_NOTES
	, tgt.DISCHARGE_DATE=src.DISCHARGE_DATE
	, tgt.DISCHARGE_REASON=src.DISCHARGE_REASON
	, tgt.ETL_TASK_KEY=src.ETL_TASK_KEY
	, tgt.ETL_INSERTED_TASK_KEY=src.ETL_INSERTED_TASK_KEY
	, tgt.ETL_INSERTED_DATE=src.ETL_INSERTED_DATE
	, tgt.ETL_INSERTED_BY=src.ETL_INSERTED_BY
	, tgt.ETL_LAST_UPDATED_DATE=src.ETL_LAST_UPDATED_DATE
	, tgt.ETL_LAST_UPDATED_BY=src.ETL_LAST_UPDATED_BY
	, tgt.ETL_DELETED_FLAG=src.ETL_DELETED_FLAG
WHEN NOT MATCHED
THEN INSERT (
	 CLIENT_ADMISSION_KEY,
	 SOURCE_SYSTEM_ID,
	 SYSTEM_CODE,
	 CLIENT_KEY,
	 REFERRER_KEY,
	 SERVICE_KEY,
	 PARTNER_CONTRACT_KEY,
	 PRIMARY_DIAGNOSIS_KEY,
	 REFERRAL_DATE,
	 REFERRAL_INTAKE_BY_EMP_KEY,
	 REFERRAL_ACCEPTED_SERVICES,
	 REFERRAL_CAMPAIGN,
	 PREVIOUS_PROVIDER,
	 ADMISSION_DATE,
	 STATUS,
	 PRIMARY_DIAGNOSIS,
	 DIAGNOSIS_NOTES,
	 DISCHARGE_DATE,
	 DISCHARGE_REASON,
	 ETL_TASK_KEY,
	 ETL_INSERTED_TASK_KEY,
	 ETL_INSERTED_DATE,
	 ETL_INSERTED_BY,
	 ETL_LAST_UPDATED_DATE,
	 ETL_LAST_UPDATED_BY,
	 ETL_DELETED_FLAG)
VALUES (
	src.CLIENT_ADMISSION_KEY,
	src.SOURCE_SYSTEM_ID,
	src.SYSTEM_CODE,
	src.CLIENT_KEY,
	src.REFERRER_KEY,
	src.SERVICE_KEY,
	src.PARTNER_CONTRACT_KEY,
	src.PRIMARY_DIAGNOSIS_KEY,
	src.REFERRAL_DATE,
	src.REFERRAL_INTAKE_BY_EMP_KEY,
	src.REFERRAL_ACCEPTED_SERVICES,
	src.REFERRAL_CAMPAIGN,
	src.PREVIOUS_PROVIDER,
	src.ADMISSION_DATE,
	src.STATUS,
	src.PRIMARY_DIAGNOSIS,
	src.DIAGNOSIS_NOTES,
	src.DISCHARGE_DATE,
	src.DISCHARGE_REASON,
	src.ETL_TASK_KEY,
	src.ETL_INSERTED_TASK_KEY,
	src.ETL_INSERTED_DATE,
	src.ETL_INSERTED_BY,
	src.ETL_LAST_UPDATED_DATE,
	src.ETL_LAST_UPDATED_BY,
	src.ETL_DELETED_FLAG);
SELECT CONCAT(''Message : '',"number of rows inserted", '' Rows Insrted & '' ,"number of rows updated",'' Rows Updated.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
return return_result;
END;
';