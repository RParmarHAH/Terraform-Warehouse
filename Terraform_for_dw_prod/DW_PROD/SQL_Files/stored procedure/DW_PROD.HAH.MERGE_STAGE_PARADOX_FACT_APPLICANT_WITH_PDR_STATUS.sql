CREATE OR REPLACE PROCEDURE DW_PROD.HAH.MERGE_STAGE_PARADOX_FACT_APPLICANT_WITH_PDR_STATUS()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE
    return_result VARCHAR;
BEGIN
    
MERGE INTO 
    DW_PROD.HAH.FACT_APPLICANT_WITH_PDR_STATUS TGT
USING 
    DW_PROD.STAGE.PARADOX_FACT_APPLICANT_WITH_PDR_STATUS STAGE
ON 
    TGT.CANDIDATE_ID = STAGE.CANDIDATE_ID AND TGT.STATUS = STAGE.STATUS 
WHEN MATCHED THEN
    UPDATE SET
        TGT.CANDIDATE_ID = STAGE.CANDIDATE_ID,
        TGT.FIRST_NAME = STAGE.FIRST_NAME,
        TGT.MIDDLE_NAME = STAGE.MIDDLE_NAME,
        TGT.LAST_NAME = STAGE.LAST_NAME,
        TGT.SOCIAL_SECURITY_NUMBER = STAGE.SOCIAL_SECURITY_NUMBER,
        TGT.DATE_OF_BIRTH = STAGE.DATE_OF_BIRTH,
        TGT.EMAIL = STAGE.EMAIL,
        TGT.TIME_ZONE = STAGE.TIME_ZONE,
        TGT.ADDRESS = STAGE.ADDRESS,
        TGT.ADDRESS_LINE_2 = STAGE.ADDRESS_LINE_2,
        TGT.CITY = STAGE.CITY,
        TGT.COUNTY = STAGE.COUNTY,
        TGT.STATE = STAGE.STATE,
        TGT.ZIP_CODE = STAGE.ZIP_CODE,
        TGT.COUNTRY = STAGE.COUNTRY,
        TGT.BRANCH_GROUP = STAGE.BRANCH_GROUP,
        TGT.BRANCH_STATE = STAGE.BRANCH_STATE,
        TGT.PHONE = STAGE.PHONE,
        TGT.HOME_PHONE = STAGE.HOME_PHONE,
        TGT.GENDER = STAGE.GENDER,
        TGT.ALAYACARE_GROUP_ID = STAGE.ALAYACARE_GROUP_ID,
        TGT.ALAYACARE_COST_CENTER_ID = STAGE.ALAYACARE_COST_CENTER_ID,
        TGT.POSITION_JOB = STAGE.POSITION_JOB,
        TGT.ALAYACARE_ADMIN_ROLE_ID = STAGE.ALAYACARE_ADMIN_ROLE_ID,
        TGT.ALAYACARE_FIELD_ROLE_PORTAL_ID = STAGE.ALAYACARE_FIELD_ROLE_PORTAL_ID,
        TGT.HAH_OFFICE_NUMBER = STAGE.HAH_OFFICE_NUMBER,
        TGT.CREATED_DATE = STAGE.CREATED_DATE,
        TGT.UPDATED_DATE = STAGE.UPDATED_DATE,
        TGT.STATUS = STAGE.STATUS,    
        TGT.ETL_TASK_KEY= STAGE.ETL_TASK_KEY,
        TGT.ETL_LAST_UPDATED_DATE= STAGE.ETL_LAST_UPDATED_DATE,
        TGT.ETL_LAST_UPDATED_BY= STAGE.ETL_LAST_UPDATED_BY,
        TGT.ETL_DELETED_FLAG= STAGE.ETL_DELETED_FLAG
WHEN NOT MATCHED THEN
    INSERT (
        CANDIDATE_ID,
        FIRST_NAME,
        MIDDLE_NAME,
        LAST_NAME,
        SOCIAL_SECURITY_NUMBER,
        DATE_OF_BIRTH,
        EMAIL,
        TIME_ZONE,
        ADDRESS,
        ADDRESS_LINE_2,
        CITY,
        COUNTY,
        STATE,
        ZIP_CODE,
        COUNTRY,
        BRANCH_GROUP,
        BRANCH_STATE,
        PHONE,
        HOME_PHONE,
        GENDER,
        ALAYACARE_GROUP_ID,
        ALAYACARE_COST_CENTER_ID,
        POSITION_JOB,
        ALAYACARE_ADMIN_ROLE_ID,
        ALAYACARE_FIELD_ROLE_PORTAL_ID,
        HAH_OFFICE_NUMBER,
        CREATED_DATE,
        UPDATED_DATE,
        STATUS,
        NEWLY_CREATED_FLAG,
        RHAPSODY_DATE_UPDATED,
        ETL_TASK_KEY,
        ETL_INSERTED_TASK_KEY,
        ETL_INSERTED_DATE,
        ETL_INSERTED_BY,
        ETL_LAST_UPDATED_DATE,
        ETL_LAST_UPDATED_BY,
        ETL_DELETED_FLAG
    ) VALUES (
        STAGE.CANDIDATE_ID,
        STAGE.FIRST_NAME,
        STAGE.MIDDLE_NAME,
        STAGE.LAST_NAME,
        STAGE.SOCIAL_SECURITY_NUMBER,
        STAGE.DATE_OF_BIRTH,
        STAGE.EMAIL,
        STAGE.TIME_ZONE,
        STAGE.ADDRESS,
        STAGE.ADDRESS_LINE_2,
        STAGE.CITY,
        STAGE.COUNTY,
        STAGE.STATE,
        STAGE.ZIP_CODE,
        STAGE.COUNTRY,
        STAGE.BRANCH_GROUP,
        STAGE.BRANCH_STATE,
        STAGE.PHONE,
        STAGE.HOME_PHONE,
        STAGE.GENDER,
        STAGE.ALAYACARE_GROUP_ID,
        STAGE.ALAYACARE_COST_CENTER_ID,
        STAGE.POSITION_JOB,
        STAGE.ALAYACARE_ADMIN_ROLE_ID,
        STAGE.ALAYACARE_FIELD_ROLE_PORTAL_ID,
        STAGE.HAH_OFFICE_NUMBER,
        STAGE.CREATED_DATE,
        STAGE.UPDATED_DATE,
        STAGE.STATUS,
        STAGE.NEWLY_CREATED_FLAG,
        STAGE.RHAPSODY_DATE_UPDATED,
        STAGE.ETL_TASK_KEY,
        STAGE.ETL_INSERTED_TASK_KEY,
        STAGE.ETL_INSERTED_DATE,
        STAGE.ETL_INSERTED_BY,
        STAGE.ETL_LAST_UPDATED_DATE,
        STAGE.ETL_LAST_UPDATED_BY,
        STAGE.ETL_DELETED_FLAG
    );

SELECT CONCAT(''Message : '',"number of rows inserted", '' Rows Insrted & '' ,"number of rows updated",'' Rows Updated.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
return return_result;
END;
    ';