CREATE OR REPLACE PROCEDURE DW_PROD.INTEGRATION.TEMP_PROC_APPLICANT_EMPLOYEE_MAPPING("STR_ETL_TASK_KEY" VARCHAR(16777216), "STR_CDC_START" VARCHAR(16777216), "STR_CDC_END" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE JAVASCRIPT
EXECUTE AS CALLER
AS '
  var sql_delete_fact_applicant_status = `DELETE FROM DW_DEV.HAH.FACT_APPLICANT_STATUS WHERE SYSTEM_CODE = ''PARADOX_PROD'';`
  var sql_delete_dim_applicant = `DELETE FROM DW_DEV.HAH.DIM_APPLICANT WHERE SYSTEM_CODE = ''PARADOX_PROD'';`
  var sql_delete_dim_job = `DELETE FROM DW_DEV.HAH.DIM_JOB WHERE SYSTEM_CODE = ''PARADOX_PROD'';`
  
  var sql_insert_dim_applicant = `
    INSERT INTO DW_DEV.HAH.DIM_APPLICANT
    SELECT  
    APPLICANT_KEY,SOURCE_SYSTEM_ID,''PARADOX_PROD'',LAST_NAME,FIRST_NAME,MIDDLE_NAME,APPLICANT_ID,SSN,EMAIL,MOBILE_PHONE,HOME_PHONE,DATE_OF_BIRTH,ADDRESS,ADDRESS_LINE_2
    ,CITY,STATE,STATE_CODE,POSTAL,REFERRER,CATEGORIES,REFERENCES,LINKEDIN,WEBSITE_BLOG_PORTFOLIO,TWITTER,EARLIEST_START_DATE
    ,AVAILABLE_WEEKENDS,AVAILABLE_EVENINGS,AVAILABLE_OVERTIME,LANGUAGES,DRIVERS_LICENSE,COMMERCIAL_DRIVERS_LICENSE,CAN_RELOCATE,CITIZEN_EMPLOYMENT_STATUS
    ,HIGHEST_EDUCATION,COLLEGE_UNIVERSITY,GRADE_POINT_AVG,AGE_18,PILOT_FLIGHT_HOURS,PILOT_GRADE_RATINGS,FELONY_CONVICTION,
    FELONY_EXPLANATION,EEO_CATEGORY,EEO_SEX,EEO_RACE,EEO_ETHNICITY,EEO_DISABILITY,EEOC_VETERAN_STATUS,EEOC_DISABILITY_STATUS,
    ETL_TASK_KEY,ETL_INSERTED_TASK_KEY,ETL_INSERTED_DATE,ETL_INSERTED_BY,ETL_LAST_UPDATED_DATE,ETL_LAST_UPDATED_BY,ETL_DELETED_FLAG
    FROM DW_PROD.HAH.DIM_APPLICANT
    WHERE (SOURCE_SYSTEM_ID = 12 AND SYSTEM_CODE IN (''PARADOX'')) ;
  `
  
  var sql_insert_dim_job = `
    INSERT INTO DW_DEV.HAH.DIM_JOB
    SELECT 
    JOB_KEY,SOURCE_SYSTEM_ID,''PARADOX_PROD'',JOB_ID,STATE,CITY,JOB_POSTING_DATE,JOB_CLOSING_DATE,JOB_CREATED_DATE,JOB_TITLE,JOB_TITLE_CODE
    ,JOB_FAMILY,JOB_FAMILY_CODE,JOB_OWNER,JOB_OWNER_ID,JOB_STATUS,LOCATION_NAME,EXTERNAL_JOB_REFERENCE_NUMBER,ARCHIVED,REQ_AGE,REQ_AGE_GROUP,JOB_POSTING_LINK
    ,ETL_TASK_KEY,ETL_INSERTED_TASK_KEY,ETL_INSERTED_DATE,ETL_INSERTED_BY,ETL_LAST_UPDATED_DATE,ETL_LAST_UPDATED_BY,ETL_DELETED_FLAG,BRANCH_KEY
    FROM DW_PROD.HAH.DIM_JOB
    WHERE (SOURCE_SYSTEM_ID = 12 AND SYSTEM_CODE IN (''PARADOX''));
  `
    
  var sql_insert_fact_applicant_status = `
    INSERT INTO DW_DEV.HAH.FACT_APPLICANT_STATUS
    SELECT 
    APPLICANT_STATUS_KEY,SOURCE_SYSTEM_ID,''PARADOX_PROD'',APPLICANT_KEY,JOB_KEY,JOB_FAMILY,CANDIDATE_ID,DATE_APPLIED,CONVERSATION_INPROGRESS_DATETIME
    ,INTERVIEW_SCHEDULED_DATETIME,INTERVIEW_RESCHEDULED_DATETIME,INTERVIEW_COMPLETED_DATETIME,INTERVIEW_NO_SHOW_DATETIME,NUMBER_OF_TIMES_INTERVIEW_SCHEDULED
    ,APPLICATION_COMPLETE_DATETIME,OFFERS_SENT_DATETIME,OFFERS_ACCEPTED_DATETIME,ONBOARDING_SENT_DATETIME,ONBOARDING_COMPLETED_DATETIME,HIRED_DATETIME
    ,OFFER_DECLINED_DATETIME,REJECTED_DATETIME,REJECTION_REASON,MOST_RECENT_STAGE_DATETIME,APPLICANT_STATUS,PRIOR_STATUS,PRIOR_STATUS_DATETIME,BRANCH_KEY,BRANCH_NAME
    ,null as SANDATA_EMPLOYEE_ID,ETL_TASK_KEY,ETL_INSERTED_TASK_KEY,ETL_INSERTED_DATE,ETL_INSERTED_BY,ETL_LAST_UPDATED_DATE,ETL_LAST_UPDATED_BY,ETL_DELETED_FLAG,BRANCH_STATE_CODE
    FROM DW_PROD.HAH.FACT_APPLICANT_STATUS
    WHERE (SOURCE_SYSTEM_ID = 12 AND SYSTEM_CODE IN (''PARADOX''));
  `
  try {
    snowflake.execute ({sqlText: sql_delete_dim_applicant});
    snowflake.execute ({sqlText: sql_insert_dim_applicant});
    snowflake.execute ({sqlText: sql_delete_dim_job});
    snowflake.execute ({sqlText: sql_insert_dim_job});
    snowflake.execute ({sqlText: sql_delete_fact_applicant_status});
    snowflake.execute ({sqlText: sql_insert_fact_applicant_status});
    return "Succeeded.";   // Return a success/error indicator.
  }
  catch (err)  {
    return "Failed: " + err;   // Return a success/error indicator.
  }
  ';