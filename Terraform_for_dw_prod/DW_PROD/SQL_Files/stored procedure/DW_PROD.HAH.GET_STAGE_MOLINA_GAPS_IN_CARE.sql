CREATE OR REPLACE PROCEDURE DW_PROD.HAH.GET_STAGE_MOLINA_GAPS_IN_CARE("STR_ETL_TASK_KEY" VARCHAR(16777216), "STR_CDC_START" VARCHAR(16777216), "STR_CDC_END" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS 'BEGIN 
--*****************************************************************************************************************************
-- NAME:  MOLINA_GAPS_IN_CARE
--
--
-- DEVELOPMENT LOG:
-- DATE        AUTHOR                NOTES:
-- --------    -------------------   ------------------------------------------------------------------------------------------
-- 08/07/23    ASHISH SHARMA          Initial development
--*****************************************************************************************************************************
INSERT OVERWRITE INTO DW_PROD.STAGE.MOLINA_FACT_GAPS_IN_CARE
SELECT MD5(''MOLINA'' || ''-'' || TRIM(MEMID) || ''-'' || CT.CONTRACT_CODE || ''-'' || TRIM(YEAR_MONTH) || ''-'' || ''MOLINA'') AS GAP_IN_CARE_KEY
		, MD5(''MOLINA'' || ''-'' || TRIM(MEMID) || ''-'' || ''MOLINA'') AS CLIENT_KEY
		, CT.PARTNER_CONTRACT_KEY AS PARTNER_CONTRACT_KEY 
		, TO_DATE(YEAR_MONTH,''YYYYMM'') AS  REPORT_DATE 
		, ''MOLINA'' AS SYSTEM_CODE 
		, 32 AS SOURCE_SYSTEM_ID 
		, BCS_DENOM AS BREAST_CANCER_SCREENING_ELIGIBILITY_FLAG
		, BCS_NUM AS BREAST_CANCER_SCREENING_GAP_FLAG 
		, NULL CERVICAL_CANCER_SCREENING_ELIGIBILITY_FLAG 
		, NULL CERVICAL_CANCER_SCREENING_GAP_FLAG 
		, NULL COLORECTAL_CANCER_SCREENING_ELIGIBILITY_FLAG 
		, NULL COLORECTAL_CANCER_SCREENING_GAP_FLAG 
		, NULL CARE_FOR_OLDER_ADULTS_ELIGIBILITY_FLAG 
		, NULL CARE_FOR_OLDER_ADULTS_GAP_FLAG 
		, CBP_DENOM AS CONTROLLING_HIGH_BLOOD_PRESSURE_ELIGIBILITY_FLAG 
		, CBP_NUM AS CONTROLLING_HIGH_BLOOD_PRESSURE_GAP_FLAG 
		, NULL STATIN_THERAPY_FOR_CARDIOVASCULAR_ELIGIBILITY_FLAG 
		, NULL STATIN_THERAPY_FOR_CARDIOVASCULAR_GAP_FLAG
		, NULL HEMOGLOBIN_A1C_CONTROL_ELIGIBILITY_FLAG 
		, NULL HEMOGLOBIN_A1C_CONTROL_GAP_FLAG 
		, NULL BLOOD_PRESSURE_CONTROL_ELIGIBILITY_FLAG 
		, NULL BLOOD_PRESSURE_CONTROL_GAP_FLAG 
		, NULL EYE_EXAM_FOR_DIABETICS_ELIGIBILITY_FLAG 
		, NULL EYE_EXAM_FOR_DIABETICS_GAP_FLAG 
		, NULL KIDNEY_HEALTH_FOR_DIABETICS_ELIGIBILITY_FLAG 
		, NULL KIDNEY_HEALTH_FOR_DIABETICS_GAP_FLAG 
		, NULL STATIN_THERAPY_FOR_DIABETICS_ELIGIBILITY_FLAG 
		, NULL STATIN_THERAPY_FOR_DIABETICS_GAP_FLAG 
		, NULL OSTEOPOROSIS_MGMT_ELIGIBILITY_FLAG 
		, NULL OSTEOPOROSIS_MGMT_GAP_FLAG 
		, NULL OSTEOPOROSIS_SCREENING_ELIGIBILITY_FLAG 
		, NULL OSTEOPOROSIS_SCREENING_GAP_FLAG 
		, NULL ADVANCED_CARE_PLANNING_ELIGIBILITY_FLAG 
		, NULL ADVANCED_CARE_PLANNING_GAP_FLAG 
		, NULL TRANSITIONS_OF_CARE_ELIGIBILITY_FLAG 
		, NULL TRANSITIONS_OF_CARE_GAP_FLAG 
		, AAP_DENOM AS ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_ELIGIBILITY_FLAG 
		, AAP_NUM AS ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_GAP_FLAG 
		, NULL MEDICATION_ADHERENCE_FOR_DIABETES_ELIGIBILITY_FLAG 
		, NULL MEDICATION_ADHERENCE_FOR_DIABETES_GAP_FLAG 
		, NULL MEDICATION_ADHERENCE_FOR_HYPERTENSION_ELIGIBILITY_FLAG 
		, NULL MEDICATION_ADHERENCE_FOR_HYPERTENSION_GAP_FLAG 
		, NULL MEDICATION_ADHERENCE_FOR_CHOLESTROL_ELIGIBILITY_FLAG 
		, NULL MEDICATION_ADHERENCE_FOR_CHOLESTROL_GAP_FLAG 
		, NULL ANNUAL_WELLNESS_VISIT_ELIGIBILITY_FLAG 
		, NULL ANNUAL_WELLNESS_VISIT_GAP_FLAG 
		, NULL FLU_VACCINE_ELIGIBILITY_FLAG 
		, NULL FLU_VACCINE_GAP_FLAG 
		, NULL ANNUAL_DENTIST_VISIT_ELIGIBILITY_FLAG 
		, NULL ANNUAL_DENTIST_VISIT_GAP_FLAG 
		, NULL COVID_19_VACCINE_GAP_FLAG
		, NULL COVID_19_VACCINE_ELIGIBILITY_FLAG 
		, NULL PNEUMONIA_VACCINE_ELIGIBILITY_FLAG 
		, NULL PNEUMONIA_VACCINE_GAP_FLAG 
		, NULL TDAP_VACCINE_ELIGIBILITY_FLAG 
		, NULL TDAP_VACCINE_GAP_FLAG 
		, NULL SHINGLES_VACCINE_ELIGIBILITY_FLAG 
		, NULL SHINGLES_VACCINE_GAP_FLAG 
		, NULL ANNUAL_EYE_EXAM_ELIGIBILITY_FLAG 
		, NULL ANNUAL_EYE_EXAM_GAP_FLAG 
		, :STR_ETL_TASK_KEY AS ETL_TASK_KEY
		, :STR_ETL_TASK_KEY AS ETL_INSERTED_TASK_KEY
		, CONVERT_TIMEZONE(''UTC'', CURRENT_TIMESTAMP)::TIMESTAMP_NTZ AS ETL_INSERTED_DATE
		, CURRENT_USER AS ETL_INSERTED_BY
		, CONVERT_TIMEZONE(''UTC'', CURRENT_TIMESTAMP)::TIMESTAMP_NTZ AS ETL_LAST_UPDATED_DATE
		, CURRENT_USER AS ETL_LAST_UPDATED_BY
		, 0 as ETL_DELETED_FLAG
		, 0 AS ETL_INFERRED_MEMBER_FLAG 
FROM DISC_PROD.MOLINA.MOLINA_GAPS_IN_CARE GP
INNER JOIN DW_PROD.HAH.DIM_PARTNER_CONTRACT CT ON GP.PARTNER = CT.PARTNER_CODE;
RETURN ''SUCCESS'';
END';