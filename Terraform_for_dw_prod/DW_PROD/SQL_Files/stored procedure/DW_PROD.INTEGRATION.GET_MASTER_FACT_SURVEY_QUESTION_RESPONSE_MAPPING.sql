CREATE OR REPLACE PROCEDURE DW_PROD.INTEGRATION.GET_MASTER_FACT_SURVEY_QUESTION_RESPONSE_MAPPING("STR_ETL_TASK_KEY" VARCHAR(16777216), "STR_CDC_START" VARCHAR(16777216), "STR_CDC_END" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE
    return_result VARCHAR;
BEGIN

    INSERT OVERWRITE INTO DW_PROD.INTEGRATION.FACT_SURVEY_QUESTION_RESPONSE_MAPPING
    SELECT
	question.SURVEY_KEY,
	question.SURVEY_ID,
	question.SURVEY_QUESTION_KEY,
	question.question_id,
	question.question_text,
	'' NPS SCORE = '' || answer AS comments,
	header.SURVEY_RESPONSE_HEADER_KEY,
	header.client_key,
	header.RECORDED_DATE,
	header.EMPLOYEE_KEY
FROM
	DW_PROD.HAH.FACT_SURVEY_QUESTION question
INNER JOIN DW_PROD.HAH.FACT_SURVEY_RESPONSE_DETAIL detail 
    ON
	question.SURVEY_QUESTION_KEY = detail.SURVEY_QUESTION_KEY
INNER JOIN DW_PROD.HAH.DIM_SURVEY_RESPONSE_HEADER header
    ON
	detail.SURVEY_RESPONSE_HEADER_KEY = header.SURVEY_RESPONSE_HEADER_KEY;

SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));

return return_result;
END;

';