CREATE OR REPLACE PROCEDURE DW_PROD.REPORT.GET_REPORT_CLIENT_LINEAR_RETENTION_MONTHLY("STR_ETL_TASK_KEY" VARCHAR(16777216), "STR_CDC_START" VARCHAR(16777216), "STR_CDC_END" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE 
	iteration_limit integer default 12;
	MONTH_DATE DATE;
BEGIN
	MONTH_DATE:=current_DATE();
    -- Check if its the first day of the month 
    IF (DAYOFMONTH(:MONTH_DATE) = 1) THEN
       for i in 0 to iteration_limit do 
       CALL DW_PROD.REPORT.GET_REPORT_CLIENT_LINEAR_RETENTION_MONTHLY_INNER(
                ADD_MONTHS(:MONTH_DATE, -:i), :STR_ETL_TASK_KEY);
       END for;  
    ELSEIF (DAYOFMONTH(:MONTH_DATE) > 1 AND DAYOFMONTH(:MONTH_DATE) <= 15) THEN
        -- Condition 1: Reload data of the previous month and the current month on a daily basis
        CALL DW_PROD.REPORT.GET_REPORT_CLIENT_LINEAR_RETENTION_MONTHLY_INNER(ADD_MONTHS(:MONTH_DATE, -1), :STR_ETL_TASK_KEY);
        CALL DW_PROD.REPORT.GET_REPORT_CLIENT_LINEAR_RETENTION_MONTHLY_INNER(:MONTH_DATE, :STR_ETL_TASK_KEY);
    ELSE
        -- For other days of the month, call the existing procedure for the current month
        CALL DW_PROD.REPORT.GET_REPORT_CLIENT_LINEAR_RETENTION_MONTHLY_INNER(:MONTH_DATE, :STR_ETL_TASK_KEY);
    END IF;

    RETURN ''Wrapper procedure completed.'';
END';