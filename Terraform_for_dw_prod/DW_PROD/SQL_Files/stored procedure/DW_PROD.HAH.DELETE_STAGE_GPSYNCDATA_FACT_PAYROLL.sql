CREATE OR REPLACE PROCEDURE DW_PROD.HAH.DELETE_STAGE_GPSYNCDATA_FACT_PAYROLL()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
	DECLARE 
		RES RESULTSET;
	BEGIN
		IF (DAYOFWEEK(CURRENT_TIMESTAMP()) = 0) 
		THEN RES := (EXECUTE IMMEDIATE ''DELETE FROM HAH.FACT_PAYROLL WHERE SOURCE_SYSTEM_ID = 5 AND PAYROLL_KEY
										NOT IN (SELECT PAYROLL_KEY FROM STAGE.VW_CURRENT_GPSYNCDATA_FACT_PAYROLL)'');
		ELSE RES := (EXECUTE IMMEDIATE ''DELETE FROM HAH.FACT_PAYROLL WHERE SOURCE_SYSTEM_ID = 5 AND PAYROLL_KEY
										IN (SELECT PAYROLL_KEY FROM STAGE.VW_CURRENT_DELETED_GPSYNCDATA_FACT_PAYROLL)'');
	END IF;
  
RETURN ''DONE'';
END;
';