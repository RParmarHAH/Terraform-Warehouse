CREATE OR REPLACE PROCEDURE DW_PROD.HAH.GET_STAGE_DATAFLEXSYNCDATA_DIM_INVOICE_TRANSACTION_TYPE("STR_ETL_TASK_KEY" VARCHAR(16777216), "STR_CDC_START" VARCHAR(16777216), "STR_CDC_END" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
BEGIN
--*****************************************************************************************************************************
-- NAME:  DATAFLEXSYNCDATA_DIM_INVOICE_TRANSACTION_TYPE
--
-- DEVELOPMENT LOG:
-- DATE         AUTHOR              NOTES:
-- --------     ------------------- -----------------------------------------------------------------------------------------------
-- 01/01/23 	PINKAL PANCHAL 		Initial development

--*****************************************************************************************************************************
--
INSERT OVERWRITE INTO STAGE.DATAFLEXSYNCDATA_DIM_INVOICE_TRANSACTION_TYPE
SELECT DISTINCT 
MD5(''DATAFLEXSYNCDATA'' || ''-'' || NVL(WRITEOFFREASON::STRING,''UNKNOWN'') || DBNAME || ''-'' || ''DATAFLEXSYNCDATA'') AS TRANSACTION_TYPE_KEY,
MD5(''DATAFLEXSYNCDATA'' || ''-'' || (''UNKNOWN'') || ''-'' || ''DATAFLEXSYNCDATA'') AS PARENT_TRANSACTION_TYPE_KEY,
NVL(WRITEOFFREASON::STRING,''UNKNOWN'') AS TRANSACTION_CODE,
CASE WHEN WRITEOFFREASON =''0'' THEN ''PAYMENT''
	 WHEN WRITEOFFREASON =''22'' THEN ''OVER SERVICED''
	 WHEN WRITEOFFREASON =''23'' THEN ''BILLING CYCLE DEADLINE''
	 WHEN WRITEOFFREASON =''24'' THEN ''SUPPLEMENTAL HOURS NOT ACCEPTED''
	 WHEN WRITEOFFREASON =''25'' THEN ''HOURS ENTERED ON WRONG CONTRACT/CLIENT''
	 WHEN WRITEOFFREASON =''26'' THEN ''NOT SERVICING PER AUTH''
	 WHEN WRITEOFFREASON =''27'' THEN ''SERVICE ENDED/DECEASED''
	 WHEN WRITEOFFREASON =''28'' THEN ''EXCEEDS TIMELY FILING''
	 WHEN WRITEOFFREASON =''29'' THEN ''CLIENT NOT ELIGIBLE''
	 WHEN WRITEOFFREASON =''30'' THEN ''NOT ELIGIBLE ON DATE OF SERVICE''
	 WHEN WRITEOFFREASON =''31'' THEN ''SMALL BALANCE W/O''
	 WHEN WRITEOFFREASON =''32'' THEN ''UNITS CUTBACK ON PA''
	 WHEN WRITEOFFREASON =''33'' THEN ''DATE NOT ON PA/NOA''
	 WHEN WRITEOFFREASON =''34'' THEN ''SPEND DOWN/COST SHARE''
	 WHEN WRITEOFFREASON =''35'' THEN ''CONTRACTUAL ALLOWANCE''
	 WHEN WRITEOFFREASON =''36'' THEN ''DUPLICATE HOURS ENTERED''
	 WHEN WRITEOFFREASON =''37'' THEN ''MEDICARE QMB''
	 WHEN WRITEOFFREASON =''38'' THEN ''RISK MANAGED CARE''
	 WHEN WRITEOFFREASON =''39'' THEN ''UNCOLLECTABLE''
	 WHEN WRITEOFFREASON =''40'' THEN ''OTHER''
	 WHEN WRITEOFFREASON =''41'' THEN ''SUBMITTED TO COLLECTIONS AGENCY''
	 WHEN WRITEOFFREASON =''42'' THEN ''RATE INCREASE OFFSET''
ELSE ''UNKNOWN'' END AS TRANSACTION_NAME,
CASE 
	 WHEN WRITEOFFREASON =''22'' THEN ''DOLLARS EXHAUSTED OVER SERVICED, SCHEDULING ERROR OVER SERVICED''
	 WHEN WRITEOFFREASON =''25'' THEN ''BILLED WRONG CLIENT, BILLING CORRECTION, BILLED WRONG CODE, BILLED WRONG CONTRAC''
	 WHEN WRITEOFFREASON =''28'' THEN ''DUE TO INCORRECT PA/SAF/NOA''
	 WHEN WRITEOFFREASON =''29'' THEN ''MEMBER NOT ELIGIBLE, IN NURSING FACILITY, NURSING FACILITY UNCOLLECTABLE,INACTIV''
	 WHEN WRITEOFFREASON =''30'' THEN ''SERVICED BEFORE AUTH APPROVED, SERVICED AFTER AUTH TERMED, IN HOSPITAL''
	 WHEN WRITEOFFREASON =''39'' THEN ''PER BRANCH MANAGER,CLT DECEASED,LOST CONTACTW/CLT TO BE USED W/PRIV PAY/CO-PAYS''
	 WHEN WRITEOFFREASON =''40'' THEN ''PAYMENT MISAPPLIED, NO HOLIDAY PAY''
ELSE NULL END AS TRANSACTION_DESC,
DBNAME AS SYSTEM_CODE, 
3 AS SOURCE_SYSTEM_ID,
:STR_ETL_TASK_KEY AS ETL_TASK_KEY,
:STR_ETL_TASK_KEY AS ETL_INSERTED_TASK_KEY,                     
convert_timezone(''UTC'', CURRENT_TIMESTAMP)::timestamp_ntz as ETL_INSERTED_DATE
,CURRENT_USER as ETL_INSERTED_BY
,convert_timezone(''UTC'', CURRENT_TIMESTAMP)::timestamp_ntz as ETL_UPDATED_DATE
,CURRENT_USER as ETL_LAST_UPDATED_BY
,0 as ETL_DELETED_FLAG
FROM
DISC_PROD.DATAFLEXSYNCDATA.DFINVOICEPAYMENTS INVPAY
;

RETURN ''SUCCESS'';
END;
';