CREATE OR REPLACE PROCEDURE DW_PROD.HAH.MERGE_STAGE_MOLINA_GAPS_IN_CARE()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS 'BEGIN 
--*****************************************************************************************************************************
-- NAME:  MOLINA_GAPS_IN_CARE
--
--
-- DEVELOPMENT LOG:
-- DATE        AUTHOR                NOTES:
-- --------    -------------------   ------------------------------------------------------------------------------------------
-- 08/07/23    ASHISH SHARMA          Initial development
--*****************************************************************************************************************************
MERGE INTO DW_PROD.HAH.FACT_GAPS_IN_CARE TGT
USING DW_PROD.STAGE.MOLINA_FACT_GAPS_IN_CARE STAGE
	ON TGT.GAP_IN_CARE_KEY = STAGE.GAP_IN_CARE_KEY 
WHEN MATCHED THEN
UPDATE SET
		TGT.GAP_IN_CARE_KEY = STAGE.GAP_IN_CARE_KEY
		, TGT.PARTNER_CONTRACT_KEY = STAGE.PARTNER_CONTRACT_KEY
		, TGT.REPORT_DATE = STAGE.REPORT_DATE
		, TGT.SYSTEM_CODE = STAGE.SYSTEM_CODE
		, TGT.SOURCE_SYSTEM_ID = STAGE.SOURCE_SYSTEM_ID
		, TGT.BREAST_CANCER_SCREENING_ELIGIBILITY_FLAG = STAGE.BREAST_CANCER_SCREENING_ELIGIBILITY_FLAG
		, TGT.BREAST_CANCER_SCREENING_GAP_FLAG = STAGE.BREAST_CANCER_SCREENING_GAP_FLAG
		, TGT.CERVICAL_CANCER_SCREENING_ELIGIBILITY_FLAG = STAGE.CERVICAL_CANCER_SCREENING_ELIGIBILITY_FLAG
		, TGT.CERVICAL_CANCER_SCREENING_GAP_FLAG = STAGE.CERVICAL_CANCER_SCREENING_GAP_FLAG
		, TGT.COLORECTAL_CANCER_SCREENING_ELIGIBILITY_FLAG = STAGE.COLORECTAL_CANCER_SCREENING_ELIGIBILITY_FLAG
		, TGT.COLORECTAL_CANCER_SCREENING_GAP_FLAG = STAGE.COLORECTAL_CANCER_SCREENING_GAP_FLAG
		, TGT.CARE_FOR_OLDER_ADULTS_ELIGIBILITY_FLAG = STAGE.CARE_FOR_OLDER_ADULTS_ELIGIBILITY_FLAG
		, TGT.CARE_FOR_OLDER_ADULTS_GAP_FLAG = STAGE.CARE_FOR_OLDER_ADULTS_GAP_FLAG
		, TGT.CONTROLLING_HIGH_BLOOD_PRESSURE_ELIGIBILITY_FLAG = STAGE.CONTROLLING_HIGH_BLOOD_PRESSURE_ELIGIBILITY_FLAG
		, TGT.CONTROLLING_HIGH_BLOOD_PRESSURE_GAP_FLAG = STAGE.CONTROLLING_HIGH_BLOOD_PRESSURE_GAP_FLAG
		, TGT.STATIN_THERAPY_FOR_CARDIOVASCULAR_ELIGIBILITY_FLAG = STAGE.STATIN_THERAPY_FOR_CARDIOVASCULAR_ELIGIBILITY_FLAG
		, TGT.STATIN_THERAPY_FOR_CARDIOVASCULAR_GAP_FLAG = STAGE.STATIN_THERAPY_FOR_CARDIOVASCULAR_GAP_FLAG
		, TGT.HEMOGLOBIN_A1C_CONTROL_ELIGIBILITY_FLAG = STAGE.HEMOGLOBIN_A1C_CONTROL_ELIGIBILITY_FLAG
		, TGT.HEMOGLOBIN_A1C_CONTROL_GAP_FLAG = STAGE.HEMOGLOBIN_A1C_CONTROL_GAP_FLAG
		, TGT.BLOOD_PRESSURE_CONTROL_ELIGIBILITY_FLAG = STAGE.BLOOD_PRESSURE_CONTROL_ELIGIBILITY_FLAG
		, TGT.BLOOD_PRESSURE_CONTROL_GAP_FLAG = STAGE.BLOOD_PRESSURE_CONTROL_GAP_FLAG
		, TGT.EYE_EXAM_FOR_DIABETICS_ELIGIBILITY_FLAG = STAGE.EYE_EXAM_FOR_DIABETICS_ELIGIBILITY_FLAG
		, TGT.EYE_EXAM_FOR_DIABETICS_GAP_FLAG = STAGE.EYE_EXAM_FOR_DIABETICS_GAP_FLAG
		, TGT.KIDNEY_HEALTH_FOR_DIABETICS_ELIGIBILITY_FLAG = STAGE.KIDNEY_HEALTH_FOR_DIABETICS_ELIGIBILITY_FLAG
		, TGT.KIDNEY_HEALTH_FOR_DIABETICS_GAP_FLAG = STAGE.KIDNEY_HEALTH_FOR_DIABETICS_GAP_FLAG
		, TGT.STATIN_THERAPY_FOR_DIABETICS_ELIGIBILITY_FLAG = STAGE.STATIN_THERAPY_FOR_DIABETICS_ELIGIBILITY_FLAG
		, TGT.STATIN_THERAPY_FOR_DIABETICS_GAP_FLAG = STAGE.STATIN_THERAPY_FOR_DIABETICS_GAP_FLAG
		, TGT.OSTEOPOROSIS_MGMT_ELIGIBILITY_FLAG = STAGE.OSTEOPOROSIS_MGMT_ELIGIBILITY_FLAG
		, TGT.OSTEOPOROSIS_MGMT_GAP_FLAG = STAGE.OSTEOPOROSIS_MGMT_GAP_FLAG
		, TGT.OSTEOPOROSIS_SCREENING_ELIGIBILITY_FLAG = STAGE.OSTEOPOROSIS_SCREENING_ELIGIBILITY_FLAG 
		, TGT.OSTEOPOROSIS_SCREENING_GAP_FLAG = STAGE.OSTEOPOROSIS_SCREENING_GAP_FLAG
		, TGT.ADVANCED_CARE_PLANNING_ELIGIBILITY_FLAG = STAGE.ADVANCED_CARE_PLANNING_ELIGIBILITY_FLAG
		, TGT.ADVANCED_CARE_PLANNING_GAP_FLAG = STAGE.ADVANCED_CARE_PLANNING_GAP_FLAG
		, TGT.TRANSITIONS_OF_CARE_ELIGIBILITY_FLAG = STAGE.TRANSITIONS_OF_CARE_ELIGIBILITY_FLAG 
		, TGT.TRANSITIONS_OF_CARE_GAP_FLAG = STAGE.TRANSITIONS_OF_CARE_GAP_FLAG 
		, TGT.ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_ELIGIBILITY_FLAG = STAGE.ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_ELIGIBILITY_FLAG
		, TGT.ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_GAP_FLAG = STAGE.ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_GAP_FLAG
		, TGT.MEDICATION_ADHERENCE_FOR_DIABETES_ELIGIBILITY_FLAG = STAGE.MEDICATION_ADHERENCE_FOR_DIABETES_ELIGIBILITY_FLAG
		, TGT.MEDICATION_ADHERENCE_FOR_DIABETES_GAP_FLAG = STAGE.MEDICATION_ADHERENCE_FOR_DIABETES_GAP_FLAG
		, TGT.MEDICATION_ADHERENCE_FOR_HYPERTENSION_ELIGIBILITY_FLAG = STAGE.MEDICATION_ADHERENCE_FOR_HYPERTENSION_ELIGIBILITY_FLAG
		, TGT.MEDICATION_ADHERENCE_FOR_HYPERTENSION_GAP_FLAG = STAGE.MEDICATION_ADHERENCE_FOR_HYPERTENSION_GAP_FLAG
		, TGT.MEDICATION_ADHERENCE_FOR_CHOLESTROL_ELIGIBILITY_FLAG = STAGE.MEDICATION_ADHERENCE_FOR_CHOLESTROL_ELIGIBILITY_FLAG
		, TGT.MEDICATION_ADHERENCE_FOR_CHOLESTROL_GAP_FLAG = STAGE.MEDICATION_ADHERENCE_FOR_CHOLESTROL_GAP_FLAG
		, TGT.ANNUAL_WELLNESS_VISIT_ELIGIBILITY_FLAG = STAGE.ANNUAL_WELLNESS_VISIT_ELIGIBILITY_FLAG
		, TGT.ANNUAL_WELLNESS_VISIT_GAP_FLAG = STAGE.ANNUAL_WELLNESS_VISIT_GAP_FLAG
		, TGT.FLU_VACCINE_ELIGIBILITY_FLAG = STAGE.FLU_VACCINE_ELIGIBILITY_FLAG
		, TGT.FLU_VACCINE_GAP_FLAG = STAGE.FLU_VACCINE_GAP_FLAG
		, TGT.ANNUAL_DENTIST_VISIT_ELIGIBILITY_FLAG = STAGE.ANNUAL_DENTIST_VISIT_ELIGIBILITY_FLAG
		, TGT.ANNUAL_DENTIST_VISIT_GAP_FLAG = STAGE.ANNUAL_DENTIST_VISIT_GAP_FLAG
		, TGT.COVID_19_VACCINE_GAP_FLAG = STAGE.COVID_19_VACCINE_GAP_FLAG
		, TGT.COVID_19_VACCINE_ELIGIBILITY_FLAG = STAGE.COVID_19_VACCINE_ELIGIBILITY_FLAG
		, TGT.PNEUMONIA_VACCINE_ELIGIBILITY_FLAG = STAGE.PNEUMONIA_VACCINE_ELIGIBILITY_FLAG
		, TGT.PNEUMONIA_VACCINE_GAP_FLAG = STAGE.PNEUMONIA_VACCINE_GAP_FLAG
		, TGT.TDAP_VACCINE_ELIGIBILITY_FLAG = STAGE.TDAP_VACCINE_ELIGIBILITY_FLAG
		, TGT.TDAP_VACCINE_GAP_FLAG = STAGE.TDAP_VACCINE_GAP_FLAG
		, TGT.SHINGLES_VACCINE_ELIGIBILITY_FLAG = STAGE.SHINGLES_VACCINE_ELIGIBILITY_FLAG
		, TGT.SHINGLES_VACCINE_GAP_FLAG = STAGE.SHINGLES_VACCINE_GAP_FLAG
		, TGT.ANNUAL_EYE_EXAM_ELIGIBILITY_FLAG = STAGE.ANNUAL_EYE_EXAM_ELIGIBILITY_FLAG
		, TGT.ANNUAL_EYE_EXAM_GAP_FLAG = STAGE.ANNUAL_EYE_EXAM_GAP_FLAG
		, TGT.ETL_TASK_KEY = STAGE.ETL_TASK_KEY
		, TGT.ETL_INSERTED_TASK_KEY = STAGE.ETL_INSERTED_TASK_KEY
		, TGT.ETL_INSERTED_DATE = STAGE.ETL_INSERTED_DATE
		, TGT.ETL_INSERTED_BY = STAGE.ETL_INSERTED_BY
		, TGT.ETL_LAST_UPDATED_DATE = STAGE.ETL_LAST_UPDATED_DATE
		, TGT.ETL_LAST_UPDATED_BY = STAGE.ETL_LAST_UPDATED_BY
		, TGT.ETL_DELETED_FLAG = STAGE.ETL_DELETED_FLAG
		, TGT.ETL_INFERRED_MEMBER_FLAG = STAGE.ETL_INFERRED_MEMBER_FLAG 
WHEN NOT MATCHED THEN
INSERT(
	GAP_IN_CARE_KEY
	, CLIENT_KEY
	, PARTNER_CONTRACT_KEY
	, REPORT_DATE	
	, SYSTEM_CODE	
	, SOURCE_SYSTEM_ID	
	, BREAST_CANCER_SCREENING_ELIGIBILITY_FLAG	
	, BREAST_CANCER_SCREENING_GAP_FLAG	
	, CERVICAL_CANCER_SCREENING_ELIGIBILITY_FLAG	
	, CERVICAL_CANCER_SCREENING_GAP_FLAG	
	, COLORECTAL_CANCER_SCREENING_ELIGIBILITY_FLAG	
	, COLORECTAL_CANCER_SCREENING_GAP_FLAG	
	, CARE_FOR_OLDER_ADULTS_ELIGIBILITY_FLAG	
	, CARE_FOR_OLDER_ADULTS_GAP_FLAG	
	, CONTROLLING_HIGH_BLOOD_PRESSURE_ELIGIBILITY_FLAG	
	, CONTROLLING_HIGH_BLOOD_PRESSURE_GAP_FLAG	
	, STATIN_THERAPY_FOR_CARDIOVASCULAR_ELIGIBILITY_FLAG	
	, STATIN_THERAPY_FOR_CARDIOVASCULAR_GAP_FLAG	
	, HEMOGLOBIN_A1C_CONTROL_ELIGIBILITY_FLAG	
	, HEMOGLOBIN_A1C_CONTROL_GAP_FLAG	
	, BLOOD_PRESSURE_CONTROL_ELIGIBILITY_FLAG	
	, BLOOD_PRESSURE_CONTROL_GAP_FLAG	
	, EYE_EXAM_FOR_DIABETICS_ELIGIBILITY_FLAG	
	, EYE_EXAM_FOR_DIABETICS_GAP_FLAG	
	, KIDNEY_HEALTH_FOR_DIABETICS_ELIGIBILITY_FLAG	
	, KIDNEY_HEALTH_FOR_DIABETICS_GAP_FLAG	
	, STATIN_THERAPY_FOR_DIABETICS_ELIGIBILITY_FLAG	
	, STATIN_THERAPY_FOR_DIABETICS_GAP_FLAG	
	, OSTEOPOROSIS_MGMT_ELIGIBILITY_FLAG	
	, OSTEOPOROSIS_MGMT_GAP_FLAG	
	, OSTEOPOROSIS_SCREENING_ELIGIBILITY_FLAG	
	, OSTEOPOROSIS_SCREENING_GAP_FLAG	
	, ADVANCED_CARE_PLANNING_ELIGIBILITY_FLAG	
	, ADVANCED_CARE_PLANNING_GAP_FLAG	
	, TRANSITIONS_OF_CARE_ELIGIBILITY_FLAG	
	, TRANSITIONS_OF_CARE_GAP_FLAG	
	, ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_ELIGIBILITY_FLAG	
	, ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_GAP_FLAG	
	, MEDICATION_ADHERENCE_FOR_DIABETES_ELIGIBILITY_FLAG	
	, MEDICATION_ADHERENCE_FOR_DIABETES_GAP_FLAG	
	, MEDICATION_ADHERENCE_FOR_HYPERTENSION_ELIGIBILITY_FLAG	
	, MEDICATION_ADHERENCE_FOR_HYPERTENSION_GAP_FLAG	
	, MEDICATION_ADHERENCE_FOR_CHOLESTROL_ELIGIBILITY_FLAG	
	, MEDICATION_ADHERENCE_FOR_CHOLESTROL_GAP_FLAG	
	, ANNUAL_WELLNESS_VISIT_ELIGIBILITY_FLAG	
	, ANNUAL_WELLNESS_VISIT_GAP_FLAG	
	, FLU_VACCINE_ELIGIBILITY_FLAG	
	, FLU_VACCINE_GAP_FLAG	
	, ANNUAL_DENTIST_VISIT_ELIGIBILITY_FLAG	
	, ANNUAL_DENTIST_VISIT_GAP_FLAG	
	, COVID_19_VACCINE_GAP_FLAG	
	, COVID_19_VACCINE_ELIGIBILITY_FLAG	
	, PNEUMONIA_VACCINE_ELIGIBILITY_FLAG	
	, PNEUMONIA_VACCINE_GAP_FLAG	
	, TDAP_VACCINE_ELIGIBILITY_FLAG	
	, TDAP_VACCINE_GAP_FLAG	
	, SHINGLES_VACCINE_ELIGIBILITY_FLAG	
	, SHINGLES_VACCINE_GAP_FLAG	
	, ANNUAL_EYE_EXAM_ELIGIBILITY_FLAG	
	, ANNUAL_EYE_EXAM_GAP_FLAG	
	, ETL_TASK_KEY	
	, ETL_INSERTED_TASK_KEY	
	, ETL_INSERTED_DATE	
	, ETL_INSERTED_BY	
	, ETL_LAST_UPDATED_DATE	
	, ETL_LAST_UPDATED_BY	
	, ETL_DELETED_FLAG	
	, ETL_INFERRED_MEMBER_FLAG

)
VALUES
(
	  STAGE.GAP_IN_CARE_KEY
	, STAGE.CLIENT_KEY
	, STAGE.PARTNER_CONTRACT_KEY
	, STAGE.REPORT_DATE	
	, STAGE.SYSTEM_CODE	
	, STAGE.SOURCE_SYSTEM_ID	
	, STAGE.BREAST_CANCER_SCREENING_ELIGIBILITY_FLAG	
	, STAGE.BREAST_CANCER_SCREENING_GAP_FLAG	
	, STAGE.CERVICAL_CANCER_SCREENING_ELIGIBILITY_FLAG	
	, STAGE.CERVICAL_CANCER_SCREENING_GAP_FLAG	
	, STAGE.COLORECTAL_CANCER_SCREENING_ELIGIBILITY_FLAG	
	, STAGE.COLORECTAL_CANCER_SCREENING_GAP_FLAG	
	, STAGE.CARE_FOR_OLDER_ADULTS_ELIGIBILITY_FLAG	
	, STAGE.CARE_FOR_OLDER_ADULTS_GAP_FLAG	
	, STAGE.CONTROLLING_HIGH_BLOOD_PRESSURE_ELIGIBILITY_FLAG	
	, STAGE.CONTROLLING_HIGH_BLOOD_PRESSURE_GAP_FLAG	
	, STAGE.STATIN_THERAPY_FOR_CARDIOVASCULAR_ELIGIBILITY_FLAG	
	, STAGE.STATIN_THERAPY_FOR_CARDIOVASCULAR_GAP_FLAG	
	, STAGE.HEMOGLOBIN_A1C_CONTROL_ELIGIBILITY_FLAG	
	, STAGE.HEMOGLOBIN_A1C_CONTROL_GAP_FLAG	
	, STAGE.BLOOD_PRESSURE_CONTROL_ELIGIBILITY_FLAG	
	, STAGE.BLOOD_PRESSURE_CONTROL_GAP_FLAG	
	, STAGE.EYE_EXAM_FOR_DIABETICS_ELIGIBILITY_FLAG	
	, STAGE.EYE_EXAM_FOR_DIABETICS_GAP_FLAG	
	, STAGE.KIDNEY_HEALTH_FOR_DIABETICS_ELIGIBILITY_FLAG	
	, STAGE.KIDNEY_HEALTH_FOR_DIABETICS_GAP_FLAG	
	, STAGE.STATIN_THERAPY_FOR_DIABETICS_ELIGIBILITY_FLAG	
	, STAGE.STATIN_THERAPY_FOR_DIABETICS_GAP_FLAG	
	, STAGE.OSTEOPOROSIS_MGMT_ELIGIBILITY_FLAG	
	, STAGE.OSTEOPOROSIS_MGMT_GAP_FLAG	
	, STAGE.OSTEOPOROSIS_SCREENING_ELIGIBILITY_FLAG	
	, STAGE.OSTEOPOROSIS_SCREENING_GAP_FLAG	
	, STAGE.ADVANCED_CARE_PLANNING_ELIGIBILITY_FLAG	
	, STAGE.ADVANCED_CARE_PLANNING_GAP_FLAG	
	, STAGE.TRANSITIONS_OF_CARE_ELIGIBILITY_FLAG	
	, STAGE.TRANSITIONS_OF_CARE_GAP_FLAG	
	, STAGE.ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_ELIGIBILITY_FLAG	
	, STAGE.ADULT_ACCESS_TO_PREVENTIVE_AMBULATORY_HEALTH_SERVICES_GAP_FLAG	
	, STAGE.MEDICATION_ADHERENCE_FOR_DIABETES_ELIGIBILITY_FLAG	
	, STAGE.MEDICATION_ADHERENCE_FOR_DIABETES_GAP_FLAG	
	, STAGE.MEDICATION_ADHERENCE_FOR_HYPERTENSION_ELIGIBILITY_FLAG	
	, STAGE.MEDICATION_ADHERENCE_FOR_HYPERTENSION_GAP_FLAG	
	, STAGE.MEDICATION_ADHERENCE_FOR_CHOLESTROL_ELIGIBILITY_FLAG	
	, STAGE.MEDICATION_ADHERENCE_FOR_CHOLESTROL_GAP_FLAG	
	, STAGE.ANNUAL_WELLNESS_VISIT_ELIGIBILITY_FLAG	
	, STAGE.ANNUAL_WELLNESS_VISIT_GAP_FLAG	
	, STAGE.FLU_VACCINE_ELIGIBILITY_FLAG	
	, STAGE.FLU_VACCINE_GAP_FLAG	
	, STAGE.ANNUAL_DENTIST_VISIT_ELIGIBILITY_FLAG	
	, STAGE.ANNUAL_DENTIST_VISIT_GAP_FLAG	
	, STAGE.COVID_19_VACCINE_GAP_FLAG	
	, STAGE.COVID_19_VACCINE_ELIGIBILITY_FLAG	
	, STAGE.PNEUMONIA_VACCINE_ELIGIBILITY_FLAG	
	, STAGE.PNEUMONIA_VACCINE_GAP_FLAG	
	, STAGE.TDAP_VACCINE_ELIGIBILITY_FLAG	
	, STAGE.TDAP_VACCINE_GAP_FLAG	
	, STAGE.SHINGLES_VACCINE_ELIGIBILITY_FLAG	
	, STAGE.SHINGLES_VACCINE_GAP_FLAG	
	, STAGE.ANNUAL_EYE_EXAM_ELIGIBILITY_FLAG	
	, STAGE.ANNUAL_EYE_EXAM_GAP_FLAG	
	, STAGE.ETL_TASK_KEY	
	, STAGE.ETL_INSERTED_TASK_KEY	
	, STAGE.ETL_INSERTED_DATE	
	, STAGE.ETL_INSERTED_BY	
	, STAGE.ETL_LAST_UPDATED_DATE	
	, STAGE.ETL_LAST_UPDATED_BY	
	, STAGE.ETL_DELETED_FLAG	
	, STAGE.ETL_INFERRED_MEMBER_FLAG
);
RETURN ''SUCCESS'';
END';