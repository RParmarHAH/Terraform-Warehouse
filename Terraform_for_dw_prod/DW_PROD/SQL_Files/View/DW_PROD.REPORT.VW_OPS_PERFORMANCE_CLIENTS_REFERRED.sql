create or replace view DW_PROD.REPORT.VW_OPS_PERFORMANCE_CLIENTS_REFERRED(
	CALENDAR_DATE,
	FIRST_VISIT_DATE,
	CLIENT_KEY,
	CLIENT_NUMBER,
	CLIENT_NAME,
	BRANCH_KEY,
	CONTRACT_KEY,
	DAYS_TO_SERVICE,
	SOURCE_SYSTEM_ID,
	ORIGINAL_SOURCE_SYSTEM_ID
) as
SELECT DISTINCT
R.REFERRED_DATE AS CALENDAR_DATE,
R.FIRST_VISIT_DATE,
R.CLIENT_KEY,
R.CLIENT_NUMBER,
R.CLIENT_NAME,
R.BRANCH_KEY, 
R.FIRST_CONTRACT_KEY AS CONTRACT_KEY,
R.DAYS_TO_SERVICE ,
R.SOURCE_SYSTEM_ID ,
R.ORIGINAL_SOURCE_SYSTEM_ID 
FROM REPORT.CLIENTS_REFERRED R
JOIN REPORT.VW_DASHBOARD_CONTRACTS DC ON R.FIRST_CONTRACT_KEY=DC.CONTRACT_KEY 
    AND DC.INCLUDE_FOR_OPS_PERF_CLIENTS = 1
WHERE R.REFERRED_DATE>='2020-01-01' AND R.REFERRED_DATE<DATE_TRUNC('MONTH',CURRENT_DATE);