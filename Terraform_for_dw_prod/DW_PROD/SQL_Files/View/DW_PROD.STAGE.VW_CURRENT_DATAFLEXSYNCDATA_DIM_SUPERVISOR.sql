create or replace view DW_PROD.STAGE.VW_CURRENT_DATAFLEXSYNCDATA_DIM_SUPERVISOR(
	SUPERVISOR_KEY
) as
WITH BULK_BILLING_SUPERVISORS AS (
    SELECT DISTINCT I.DBNAME,  
    	TRY_CAST(CONCAT(-100, I.OFFICE) AS INTEGER)::STRING AS DUMMY_SUPERVISOR_CODE,
    	MD5(I.DBNAME || '-' || DUMMY_SUPERVISOR_CODE || '-' || 'DATAFLEXSYNCDATA-DUMMY') AS DUMMY_SUPERVISOR_KEY,
    	CONCAT('BULK BILLING SPV for ', COALESCE(B.BRANCH_NAME, CONCAT(I.DBNAME, '-Unknown'))) AS DUMMY_SUPERVISOR_NAME
    FROM DISC_PROD.DATAFLEXSYNCDATA.DFARINVOICES I
	LEFT JOIN HAH.DIM_BRANCH B ON B.SOURCE_SYSTEM_ID = 3 AND B.SYSTEM_CODE = I.DBNAME AND B.OFFICE_NUMBER = I.OFFICE 
    WHERE I.ETL_LAST_UPDATED_DATE >= '1900-01-01'
)
	SELECT 
		md5(f.DbName || '-'  || nvl(f.Code,'Unknown-' || f.DbName) || '-'  || 'DATAFLEXSYNCDATA') AS SUPERVISOR_KEY
	FROM DISC_PROD.DATAFLEXSYNCDATA.DfSupervisors f
	WHERE f.ETL_LAST_UPDATED_DATE >= '1900-01-01'
	UNION ALL
	SELECT DUMMY_SUPERVISOR_KEY AS SUPERVISOR_KEY
	FROM BULK_BILLING_SUPERVISORS;