create or replace view DW_PROD.STAGE.VW_CURRENT_ALAYACARE_DIM_CONTRACT(
	CONTRACT_KEY
) as
SELECT CONTRACT_KEY FROM (SELECT MD5(NVL(TRIM(COMPANY.PROPERTIES_TBL_GT_ACCOUNT_DESCRIPTION), 'Unknown') || ' (' || NVL(F.BRANCH_ID,-1) || ')' || '-' || F.FUNDER_ID::STRING || '-' || NVL(S.SERVICE_CODE_ID::STRING, '') || '-' || 'ALAYACARE') AS CONTRACT_KEY,
NVL(TRIM(COMPANY.PROPERTIES_TBL_GT_ACCOUNT_DESCRIPTION), 'Unknown') || ' (' || NVL(F.BRANCH_ID,-1) || ')' AS SYSTEM_CODE
FROM DISC_DEV.ALAYACARE.FUNDER F 
JOIN DISC_DEV.ALAYACARE.SERVICE_CODE_BILL_CODE SBC ON F.FUNDER_ID = SBC.FUNDER_ID 
JOIN DISC_DEV.ALAYACARE.SERVICE_CODE S ON SBC.SERVICE_CODE_ID = S.SERVICE_CODE_ID
LEFT JOIN DISC_DEV.ALAYACARE.BILL_CODE AS BC ON BC.BILL_CODE_ID = SBC.BILL_CODE_ID 
LEFT JOIN DISC_DEV.ALAYACARE.BRANCH AS COMPANY
	ON COMPANY.BRANCH_ID = F.BRANCH_ID)DATA 
INNER JOIN DISC_DEV.ALAYACARE.CONFIGURATION CONFIG 
	ON CONFIG.SYSTEM_CODE=DATA.SYSTEM_CODE
	AND CONFIG.CONFIGURATION_ACTIVE=TRUE
	AND CONFIG.SYSTEM_CODE IS NOT NULL;