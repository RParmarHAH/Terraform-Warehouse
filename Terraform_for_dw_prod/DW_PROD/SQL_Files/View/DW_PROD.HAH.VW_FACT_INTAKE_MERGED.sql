create or replace view DW_PROD.HAH.VW_FACT_INTAKE_MERGED(
	INTAKE_KEY,
	REPORT_DATE,
	BRANCH_KEY,
	ORIGINAL_BRANCH_KEY,
	CLIENT_KEY,
	ORIGINAL_CLIENT_KEY,
	CONTRACT_KEY,
	SOURCE_SYSTEM_ID,
	REAUTHORIZED_DATE,
	BRANCH_NAME,
	CLIENT_NUMBER,
	CONTRACT_CODE,
	BILL_RATE,
	SYSTEM_CODE,
	CASE_MANAGER,
	HOURS_AUTHORIZED,
	HOURS_AUTHORIZED_NON_ADJUSTED,
	ETL_TASK_KEY,
	ETL_INSERTED_TASK_KEY,
	ETL_INSERTED_DATE,
	ETL_INSERTED_BY,
	ETL_LAST_UPDATED_DATE,
	ETL_LAST_UPDATED_BY,
	ETL_DELETED_FLAG
) as
	SELECT INTAKE.INTAKE_KEY,
		INTAKE.REPORT_DATE,
		COALESCE(BRANCH_MERGED.BRANCH_KEY, INTAKE.BRANCH_KEY) AS BRANCH_KEY,
		INTAKE.BRANCH_KEY AS ORIGINAL_BRANCH_KEY,
		COALESCE(CLIENT_MERGED.CLIENT_KEY, INTAKE.CLIENT_KEY) AS CLIENT_KEY,
		INTAKE.CLIENT_KEY AS ORIGINAL_CLIENT_KEY,
		INTAKE.CONTRACT_KEY,
		INTAKE.SOURCE_SYSTEM_ID,
		INTAKE.REAUTHORIZED_DATE,
		INTAKE.BRANCH_NAME,
		INTAKE.CLIENT_NUMBER,
		INTAKE.CONTRACT_CODE,
		INTAKE.BILL_RATE,
		INTAKE.SYSTEM_CODE,
		INTAKE.CASE_MANAGER,
		INTAKE.HOURS_AUTHORIZED,
		INTAKE.HOURS_AUTHORIZED_NON_ADJUSTED,
		INTAKE.ETL_TASK_KEY,
		INTAKE.ETL_INSERTED_TASK_KEY,
		INTAKE.ETL_INSERTED_DATE,
		INTAKE.ETL_INSERTED_BY,
		INTAKE.ETL_LAST_UPDATED_DATE,
		INTAKE.ETL_LAST_UPDATED_BY,
		INTAKE.ETL_DELETED_FLAG
	FROM HAH.FACT_INTAKE AS INTAKE
	LEFT JOIN HAH.VW_DIM_BRANCH_MERGED AS BRANCH_MERGED
		ON BRANCH_MERGED.ORIGINAL_BRANCH_KEY = INTAKE.BRANCH_KEY
	LEFT JOIN HAH.VW_DIM_CLIENT_MERGED AS CLIENT_MERGED
		ON CLIENT_MERGED.ORIGINAL_CLIENT_KEY = INTAKE.CLIENT_KEY;