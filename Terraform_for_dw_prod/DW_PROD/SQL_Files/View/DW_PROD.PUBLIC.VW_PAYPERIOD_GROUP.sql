create or replace view DW_PROD.PUBLIC.VW_PAYPERIOD_GROUP(
	OFFICE_STATE_CODE,
	PAYPERIODFREQUENCY,
	PAYPERIOD_FIRST_DAY,
	PAYROLL_DAY,
	OFFICE_CODE_JOIN,
	SOURCE_SYSTEM_ID
) as 
SELECT DISTINCT OFFICE_STATE_CODE, 
CASE 
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 13 AND PP.OFFICE_STATE_CODE IN ('GA','IL','MI','MO','SC') 
THEN 'BIWEEKLY - 1' 
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 20 AND PP.OFFICE_STATE_CODE IN ('AL','MS') 
THEN 'BIWEEKLY - 2'
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 6 AND PP.OFFICE_STATE_CODE IN ('IN','KY','TN') 
THEN 'BIWEEKLY - 3'
WHEN DATEDIFF('DAY',PP.PERIOD_START_DATE,PP.PERIOD_END_DATE) = 6 AND PP.OFFICE_STATE_CODE IN ('PA') 
THEN 'WEEKLY'
END AS PAYPERIODFREQUENCY,
D.DAY_NAME AS PAYPERIOD_FIRST_DAY, 
D2.DAY_NAME AS PAYROLL_DAY,
CASE 
WHEN PP.OFFICE_STATE_CODE IN ('GA','IL','MI','MO','SC') THEN 'GA ,IL ,MI ,MO ,SC'
WHEN PP.OFFICE_STATE_CODE IN ('AL','MS') THEN 'AL ,MS'
WHEN PP.OFFICE_STATE_CODE IN ('IN','KY','TN') THEN 'IN ,KY ,TN'
WHEN PP.OFFICE_STATE_CODE = 'PA' THEN 'PA'
END AS OFFICE_CODE_JOIN,
CASE 
WHEN PP.OFFICE_STATE_CODE IN ('GA','SC') AND D2.DAY_NAME='Fri' THEN 1
WHEN PP.OFFICE_STATE_CODE IN ('GA','SC') AND D2.DAY_NAME='Tue' THEN 2
WHEN PP.OFFICE_STATE_CODE IN ('IL','MI','MO','KY','AL','MS','IN','TN') THEN 3
WHEN PP.OFFICE_STATE_CODE IN ('PA') THEN 4
END AS SOURCE_SYSTEM_ID 
FROM HAH.FACT_BRANCH_PAYROLL_PERIODS PP
LEFT JOIN HAH.DIM_DATE D ON PP.PERIOD_START_DATE = D.CALENDAR_DATE 
LEFT JOIN HAH.DIM_DATE D2 ON PP.CHECK_DATE = D2.CALENDAR_DATE
WHERE PAYPERIODFREQUENCY IS NOT NULL
ORDER BY OFFICE_STATE_CODE;