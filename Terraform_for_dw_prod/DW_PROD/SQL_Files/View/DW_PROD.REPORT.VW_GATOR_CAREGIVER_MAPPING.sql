create or replace view DW_PROD.REPORT.VW_GATOR_CAREGIVER_MAPPING(
	ACCOUNT_ID,
	EMPLOYEE_KEY,
	ORIGINAL_EMPLOYEE_KEY,
	SOURCE_SYSTEM,
	ORIGINAL_SOURCE_SYSTEM,
	EMPLOYEE_FIRST_NAME,
	EMPLOYEE_LAST_NAME
) as
------------------------------------------------------------------------------------------------------------------------------
/*
Object Type : 	View
Object Name	: 	VW_GATOR_CAREGIVER_MAPPING
Author		:	Pooja Deokate
Description :
	- Interim Solution to Map CC Employee Key From Gator with DW Client Key
*/
--*****************************************************************************************************************************
-- CHANGE LOG :
-- Version	Date(MM/DD/YYYY)	Author				Change Description
-- --------	----------------   	------------------	---------------------------------------------------------------------------
-- 1.0		26/09/2023   		Pooja Deokate		Initial development
-------------------------------------------------------------------------------------------------------------------------------
WITH CAREGIVER_LIST AS
(
	SELECT DISTINCT GATOR_CAREGIVER.ID AS ACCOUNT_ID
					, LEFT(GATOR_CAREGIVER.HEALTHCLOUDGA__SOURCESYSTEMID__C, 32) AS GATOR_EMPLOYEE_KEY
					, NVL(DW_CAREGIVER.EMPLOYEE_KEY, LEFT(GATOR_CAREGIVER.HEALTHCLOUDGA__SOURCESYSTEMID__C, 32)) AS DW_EMPLOYEE_KEY
					, NVL(DW_CAREGIVER.EMPLOYEE_FIRST_NAME,  GATOR_CAREGIVER.FIRSTNAME) AS EMPLOYEE_FIRST_NAME 
					, NVL(DW_CAREGIVER.EMPLOYEE_LAST_NAME, GATOR_CAREGIVER.LASTNAME ) AS EMPLOYEE_LAST_NAME
	FROM DISC_PROD.HEALTH_NAVIGATOR.ACCOUNT GATOR_CAREGIVER
	INNER JOIN DISC_PROD.HEALTH_NAVIGATOR.RECORDTYPE RECORD_TYPE
		ON RECORD_TYPE.ID = GATOR_CAREGIVER.RECORDTYPEID
			AND RECORD_TYPE.NAME = 'Caregiver'
	LEFT JOIN APP_DB_PROD.CARE_COORDINATION.CAREGIVER_MATCH_LIST CAREGIVER_MATCH 
		ON LEFT(GATOR_CAREGIVER.HEALTHCLOUDGA__SOURCESYSTEMID__C, 32) = CAREGIVER_MATCH.GATOR_EMPLOYEE_KEY
			AND CAREGIVER_MATCH.ORIGINAL_SOURCE = 'DW'
	LEFT JOIN DW_PROD.INTEGRATION.DIM_EMPLOYEE_MERGED  DW_CAREGIVER
		ON DW_CAREGIVER.ORIGINAL_EMPLOYEE_KEY = NVL(CAREGIVER_MATCH.DW_EMPLOYEE_KEY
										 , LEFT(GATOR_CAREGIVER.HEALTHCLOUDGA__SOURCESYSTEMID__C, 32))
)
SELECT DISTINCT ACCOUNT_ID AS ACCOUNT_ID
			, GATOR_EMPLOYEE_KEY AS EMPLOYEE_KEY
			, GATOR_EMPLOYEE_KEY AS ORIGINAL_EMPLOYEE_KEY
			, 'GATOR' AS SOURCE_SYSTEM
			, 'GATOR' AS ORIGINAL_SOURCE_SYSTEM
			, EMPLOYEE_FIRST_NAME
			, EMPLOYEE_LAST_NAME
FROM CAREGIVER_LIST
UNION
SELECT DISTINCT ACCOUNT_ID AS ACCOUNT_ID
				, GATOR_EMPLOYEE_KEY AS EMPLOYEE_KEY
				, DW_EMPLOYEE_KEY AS ORIGINAL_EMPLOYEE_KEY
				, 'GATOR' AS SOURCE_SYSTEM
				, 'DW' AS ORIGINAL_SOURCE_SYSTEM
				, EMPLOYEE_FIRST_NAME
				, EMPLOYEE_LAST_NAME
FROM CAREGIVER_LIST;