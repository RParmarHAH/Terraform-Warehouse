create or replace view DW_PROD.REPORT.VW_CLIENTS_REFERRED_BY_VISIT_DATE_OPD_MAPPING_BACKUP(
	FIRST_CONTRACT_KEY,
	FIRST_CONTRACT_CODE,
	LATEST_CONTRACT_KEY,
	LATEST_CONTRACT_CODE,
	FIRST_ADJUSTED_AUTH_HOURS,
	FIRST_NON_ADJUSTED_AUTH_HOURS,
	LATEST_ADJUSTED_AUTH_HOURS,
	LATEST_NON_ADJUSTED_AUTH_HOURS,
	NEXT_SCHEDULED_VISIT_DATE,
	CLIENT_NUMBER,
	CLIENT_KEY,
	SYSTEM_CODE,
	SOURCE_SYSTEM_ID,
	CLIENT_NAME,
	CLIENT_HOME_PHONE,
	CLIENT_WORK_PHONE,
	SUPERVISOR_KEY,
	BRANCH_KEY,
	FIRST_VISIT_DATE,
	LATEST_VISIT_DATE,
	REFERRED_DATE,
	DAYS_TO_SERVICE,
	OPEN_REFERRAL,
	REFERRAL_AGE,
	FIRST_CONTRACT_BEGIN_DATE,
	LATEST_CONTRACT_BEGIN_DATE,
	END_DATE
) as 
SELECT 
FIRST_CONTRACT_KEY,
FIRST_CONTRACT_CODE,
LATEST_CONTRACT_KEY,
LATEST_CONTRACT_CODE,
FIRST_ADJUSTED_AUTH_HOURS,
FIRST_NON_ADJUSTED_AUTH_HOURS,
LATEST_ADJUSTED_AUTH_HOURS,
LATEST_NON_ADJUSTED_AUTH_HOURS,
NEXT_SCHEDULED_VISIT_DATE,
CLIENT_NUMBER,
CLIENT_KEY,
R.SYSTEM_CODE,
R.SOURCE_SYSTEM_ID,
CLIENT_NAME,
CLIENT_HOME_PHONE,
CLIENT_WORK_PHONE,
SUPERVISOR_KEY,
BRANCH_KEY,
FIRST_VISIT_DATE,
LATEST_VISIT_DATE,
REFERRED_DATE,
DAYS_TO_SERVICE,
OPEN_REFERRAL,
REFERRAL_AGE,
FIRST_CONTRACT_BEGIN_DATE,
LATEST_CONTRACT_BEGIN_DATE,
END_DATE
FROM REPORT.CLIENTS_REFERRED R
LEFT JOIN REPORT.VW_DASHBOARD_CONTRACTS DC ON DC.CONTRACT_KEY=R.FIRST_CONTRACT_KEY
WHERE DC.INCLUDE_FOR_OPS_PERF_CLIENTS = 1 AND R.LATEST_VISIT_DATE BETWEEN DATEADD('YEAR',-2,DATE_TRUNC('YEAR',CURRENT_DATE)) AND CURRENT_DATE;