resource "snowflake_view" "DISC_AXXESS_EMP_FOR_DEDUPE" {
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "AXXESS"
	name = "EMP_FOR_DEDUPE"
	statement = <<-SQL
	 SELECT DISTINCT EMPLOYEE_ID, 
NULLIF(UPPER(TRIM(SPLIT_PART(PV.CLINICIAN_NAME,',',2))),'') AS EMPLOYEE_FIRST_NAME,
NULLIF(UPPER(TRIM(SPLIT_PART(PV.CLINICIAN_NAME,',',1))),'') AS EMPLOYEE_LAST_NAME,
SSN, TITLE_TYPE, EMPLOYMENT_TYPE, ei.DATE_OF_BIRTH, ADDRESS_LINE_1, ADDRESS_CITY, ADDRESS_STATECODE, ADDRESS_ZIPCODE
FROM AXXESS.AXXESS_EMPLOYEEINFO ei
LEFT JOIN 
	AXXESS.AXXESS_PATIENTVISITS pv 
	ON pv.CLINICIAN_ID = ei.EMPLOYEE_ID
ORDER BY 2, 3, 4, 7, 8, 9, 10, 11;
SQL
	or_replace = true 
	is_secure = false 
}

