resource "snowflake_procedure" "DISC_ALAYACARE_GET_CLIENT_BACKUP" {
	name ="GET_CLIENT_BACKUP"
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "ALAYACARE"
	language  = "SQL"
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

DECLARE
--*****************************************************************************************************************************
-- NAME:  GET_CLIENT_BACKUP 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE        		AUTHOR                	NOTES:
-- ----------  		-------------------   	-----------------------------------------------------------------------------------------------
-- 2021-11-11		UNKNOWN					INITIAL DEVELOPMENT
-- 2023-09-05  		RAVI SUTHAR            	MIGRATED JavaScript to SQL
--*****************************************************************************************************************************
    return_result varchar(1000);
BEGIN
	
    INSERT OVERWRITE INTO ALAYACARE.CLIENT (
        CLIENT_ID, PROFILE_ID, GUID, BRANCH_ID, CREATED_AT, CREATED_BY, UPDATED_AT, REVISION_DATE, UPDATED_BY, 
		PROFILE_ADDRESS, PROFILE_CITY, PROFILE_COMPANY, PROFILE_COUNTRY, PROFILE_FIRST_NAME, PROFILE_IMPORT_ID, PROFILE_LAST_NAME, PROFILE_PHONE_MAIN, PROFILE_START_ON, PROFILE_STATE, PROFILE_ZIP,PROFILE_BIRTHDAY,PROFILE_SSN,PROFILE_GENDER,PROFILE_ETHNICITY,PROFILE_MARITAL_STATUS,PROFILE_SALUTATION,PROFILE_ADDRESS_SUITE,PROFILE_PHONE_PERSONAL,PROFILE_FAX,PROFILE_EMAIL,PROFILE_REFERRAL_DATE, 
		PROPERTIES_TBL_GT_ACCOUNT_CREATE_TIME, PROPERTIES_TBL_GT_ACCOUNT_CREATE_USER_ID, PROPERTIES_TBL_GT_ACCOUNT_DESCRIPTION, PROPERTIES_TBL_GT_ACCOUNT_DISPLAY_ID, PROPERTIES_TBL_GT_ACCOUNT_GEOFENCE, PROPERTIES_TBL_GT_ACCOUNT_GUID, PROPERTIES_TBL_GT_ACCOUNT_ID, PROPERTIES_TBL_GT_ACCOUNT_IDACCOUNTTYPE, PROPERTIES_TBL_GT_ACCOUNT_IDMASTERACCOUNT, PROPERTIES_TBL_GT_ACCOUNT_IDPROFILE, PROPERTIES_TBL_GT_ACCOUNT_IDSTATUS, PROPERTIES_TBL_GT_ACCOUNT_PHONE, PROPERTIES_TBL_GT_ACCOUNT_UPDATE_TIME, PROPERTIES_TBL_GT_ACCOUNT_UPDATE_USER_ID, 
		PROPERTIES_TBL_PROSPECT_CONTACT_CREATE_TIME, PROPERTIES_TBL_PROSPECT_CONTACT_CREATE_USER_ID, PROPERTIES_TBL_PROSPECT_CONTACT_DEPRECATED_GUID_TO, PROPERTIES_TBL_PROSPECT_CONTACT_FULLTEXT_INDEX, PROPERTIES_TBL_PROSPECT_CONTACT_GEO_CODED, PROPERTIES_TBL_PROSPECT_CONTACT_GEO_LAT, PROPERTIES_TBL_PROSPECT_CONTACT_GEO_LON, PROPERTIES_TBL_PROSPECT_CONTACT_GUID, PROPERTIES_TBL_PROSPECT_CONTACT_ID, PROPERTIES_TBL_PROSPECT_CONTACT_IDACCOUNT, PROPERTIES_TBL_PROSPECT_CONTACT_IS_ACTIVE, PROPERTIES_TBL_PROSPECT_CONTACT_LIST_ID, PROPERTIES_TBL_PROSPECT_CONTACT_UPDATE_TIME, PROPERTIES_TBL_PROSPECT_CONTACT_UPDATE_USER_ID, 
		AGE, AGE_RANGE, ADMISSION_DATE, DISCHARGE_DATE, CLIENT_BRN, PREFERRED_LANGUAGE, VISIT_COUNT, LENGTH_OF_STAY, HAS_ADLS
		,PROFILE_acquired_business_,PROFILE_acquisition_date)
		SELECT CLIENT_ID AS CLIENT_ID, PROFILE_ID AS PROFILE_ID, GUID AS GUID, BRANCH_ID AS BRANCH_ID, CREATED_AT AS CREATED_AT, CREATED_BY AS CREATED_BY, UPDATED_AT AS UPDATED_AT, REVISION_DATE AS REVISION_DATE, UPDATED_BY AS UPDATED_BY, 
		PROFILE:address::STRING AS PROFILE_ADDRESS, PROFILE:city::STRING AS PROFILE_CITY, PROFILE:company::STRING AS PROFILE_COMPANY, PROFILE:country::STRING AS PROFILE_COUNTRY, PROFILE:first_name::STRING AS PROFILE_FIRST_NAME, PROFILE:import_id::STRING AS PROFILE_IMPORT_ID, PROFILE:last_name::STRING AS PROFILE_LAST_NAME, PROFILE:phone_main::STRING AS PROFILE_PHONE_MAIN, PROFILE:start_on::STRING AS PROFILE_START_ON, PROFILE:state::STRING AS PROFILE_STATE, PROFILE:zip::STRING AS PROFILE_ZIP, PROFILE:birthday::STRING as	PROFILE_BIRTHDAY,PROFILE:ssn::STRING as PROFILE_SSN,PROFILE:gender::STRING as PROFILE_GENDER,PROFILE:ethnicity::STRING as PROFILE_ETHNICITY,PROFILE:marital_status::STRING as PROFILE_MARITAL_STATUS,PROFILE:salutation::STRING as PROFILE_SALUTATION,PROFILE:address_suite::STRING AS PROFILE_ADDRESS_SUITE,PROFILE:phone_personal::STRING as PROFILE_PHONE_PERSONAL,PROFILE:fax::STRING as PROFILE_FAX,PROFILE:email::STRING as PROFILE_EMAIL,PROFILE:referral_date::STRING as PROFILE_REFERRAL_DATE,
		PROPERTIES_TBL_GT_ACCOUNT:create_time::STRING AS PROPERTIES_TBL_GT_ACCOUNT_CREATE_TIME, PROPERTIES_TBL_GT_ACCOUNT:create_user_id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_CREATE_USER_ID, PROPERTIES_TBL_GT_ACCOUNT:description::STRING AS PROPERTIES_TBL_GT_ACCOUNT_DESCRIPTION, PROPERTIES_TBL_GT_ACCOUNT:display_id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_DISPLAY_ID, PROPERTIES_TBL_GT_ACCOUNT:geofence::STRING AS PROPERTIES_TBL_GT_ACCOUNT_GEOFENCE, PROPERTIES_TBL_GT_ACCOUNT:guid::STRING AS PROPERTIES_TBL_GT_ACCOUNT_GUID, PROPERTIES_TBL_GT_ACCOUNT:id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_ID, PROPERTIES_TBL_GT_ACCOUNT:idaccounttype::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDACCOUNTTYPE, PROPERTIES_TBL_GT_ACCOUNT:idmasteraccount::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDMASTERACCOUNT, PROPERTIES_TBL_GT_ACCOUNT:idprofile::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDPROFILE, PROPERTIES_TBL_GT_ACCOUNT:idstatus::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDSTATUS, PROPERTIES_TBL_GT_ACCOUNT:phone::STRING AS PROPERTIES_TBL_GT_ACCOUNT_PHONE, PROPERTIES_TBL_GT_ACCOUNT:update_time::STRING AS PROPERTIES_TBL_GT_ACCOUNT_UPDATE_TIME, PROPERTIES_TBL_GT_ACCOUNT:update_user_id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_UPDATE_USER_ID, 
		PROPERTIES_TBL_PROSPECT_CONTACT:create_time::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_CREATE_TIME, PROPERTIES_TBL_PROSPECT_CONTACT:create_user_id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_CREATE_USER_ID, PROPERTIES_TBL_PROSPECT_CONTACT:deprecated_guid_to::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_DEPRECATED_GUID_TO, PROPERTIES_TBL_PROSPECT_CONTACT:fulltext_index::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_FULLTEXT_INDEX, PROPERTIES_TBL_PROSPECT_CONTACT:geo_coded::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GEO_CODED, PROPERTIES_TBL_PROSPECT_CONTACT:geo_lat::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GEO_LAT, PROPERTIES_TBL_PROSPECT_CONTACT:geo_lon::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GEO_LON, PROPERTIES_TBL_PROSPECT_CONTACT:guid::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GUID, PROPERTIES_TBL_PROSPECT_CONTACT:id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_ID, PROPERTIES_TBL_PROSPECT_CONTACT:idaccount::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_IDACCOUNT, PROPERTIES_TBL_PROSPECT_CONTACT:is_active::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_IS_ACTIVE, PROPERTIES_TBL_PROSPECT_CONTACT:list_id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_LIST_ID, PROPERTIES_TBL_PROSPECT_CONTACT:update_time::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_UPDATE_TIME, PROPERTIES_TBL_PROSPECT_CONTACT:update_user_id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_UPDATE_USER_ID, 
		AGE AS AGE, AGE_RANGE AS AGE_RANGE, ADMISSION_DATE AS ADMISSION_DATE, DISCHARGE_DATE AS DISCHARGE_DATE, CLIENT_BRN AS CLIENT_BRN, PREFERRED_LANGUAGE AS PREFERRED_LANGUAGE, VISIT_COUNT AS VISIT_COUNT, LENGTH_OF_STAY AS LENGTH_OF_STAY, HAS_ADLS AS HAS_ADLS
		,PROFILE:acquired_business_::STRING AS PROFILE_acquired_business_,PROFILE:acquisition_date::STRING AS PROFILE_acquisition_date 
        FROM ALAYACARE_${var.SF_ENVIRONMENT}UCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_CLIENT
		EXCEPT
        SELECT CLIENT_ID AS CLIENT_ID, PROFILE_ID AS PROFILE_ID, GUID AS GUID, BRANCH_ID AS BRANCH_ID, CREATED_AT AS CREATED_AT, CREATED_BY AS CREATED_BY, UPDATED_AT AS UPDATED_AT, REVISION_DATE AS REVISION_DATE, UPDATED_BY AS UPDATED_BY, 
		PROFILE:address::STRING AS PROFILE_ADDRESS, PROFILE:city::STRING AS PROFILE_CITY, PROFILE:company::STRING AS PROFILE_COMPANY, PROFILE:country::STRING AS PROFILE_COUNTRY, PROFILE:first_name::STRING AS PROFILE_FIRST_NAME, PROFILE:import_id::STRING AS PROFILE_IMPORT_ID, PROFILE:last_name::STRING AS PROFILE_LAST_NAME, PROFILE:phone_main::STRING AS PROFILE_PHONE_MAIN, PROFILE:start_on::STRING AS PROFILE_START_ON, PROFILE:state::STRING AS PROFILE_STATE, PROFILE:zip::STRING AS PROFILE_ZIP, PROFILE:birthday::STRING as	PROFILE_BIRTHDAY,PROFILE:ssn::STRING as PROFILE_SSN,PROFILE:gender::STRING as PROFILE_GENDER,PROFILE:ethnicity::STRING as PROFILE_ETHNICITY,PROFILE:marital_status::STRING as PROFILE_MARITAL_STATUS,PROFILE:salutation::STRING as PROFILE_SALUTATION,PROFILE:address_suite::STRING AS PROFILE_ADDRESS_SUITE,PROFILE:phone_personal::STRING as PROFILE_PHONE_PERSONAL,PROFILE:fax::STRING as PROFILE_FAX,PROFILE:email::STRING as PROFILE_EMAIL,PROFILE:referral_date::STRING as PROFILE_REFERRAL_DATE,
		PROPERTIES_TBL_GT_ACCOUNT:create_time::STRING AS PROPERTIES_TBL_GT_ACCOUNT_CREATE_TIME, PROPERTIES_TBL_GT_ACCOUNT:create_user_id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_CREATE_USER_ID, PROPERTIES_TBL_GT_ACCOUNT:description::STRING AS PROPERTIES_TBL_GT_ACCOUNT_DESCRIPTION, PROPERTIES_TBL_GT_ACCOUNT:display_id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_DISPLAY_ID, PROPERTIES_TBL_GT_ACCOUNT:geofence::STRING AS PROPERTIES_TBL_GT_ACCOUNT_GEOFENCE, PROPERTIES_TBL_GT_ACCOUNT:guid::STRING AS PROPERTIES_TBL_GT_ACCOUNT_GUID, PROPERTIES_TBL_GT_ACCOUNT:id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_ID, PROPERTIES_TBL_GT_ACCOUNT:idaccounttype::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDACCOUNTTYPE, PROPERTIES_TBL_GT_ACCOUNT:idmasteraccount::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDMASTERACCOUNT, PROPERTIES_TBL_GT_ACCOUNT:idprofile::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDPROFILE, PROPERTIES_TBL_GT_ACCOUNT:idstatus::STRING AS PROPERTIES_TBL_GT_ACCOUNT_IDSTATUS, PROPERTIES_TBL_GT_ACCOUNT:phone::STRING AS PROPERTIES_TBL_GT_ACCOUNT_PHONE, PROPERTIES_TBL_GT_ACCOUNT:update_time::STRING AS PROPERTIES_TBL_GT_ACCOUNT_UPDATE_TIME, PROPERTIES_TBL_GT_ACCOUNT:update_user_id::STRING AS PROPERTIES_TBL_GT_ACCOUNT_UPDATE_USER_ID, 
		PROPERTIES_TBL_PROSPECT_CONTACT:create_time::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_CREATE_TIME, PROPERTIES_TBL_PROSPECT_CONTACT:create_user_id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_CREATE_USER_ID, PROPERTIES_TBL_PROSPECT_CONTACT:deprecated_guid_to::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_DEPRECATED_GUID_TO, PROPERTIES_TBL_PROSPECT_CONTACT:fulltext_index::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_FULLTEXT_INDEX, PROPERTIES_TBL_PROSPECT_CONTACT:geo_coded::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GEO_CODED, PROPERTIES_TBL_PROSPECT_CONTACT:geo_lat::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GEO_LAT, PROPERTIES_TBL_PROSPECT_CONTACT:geo_lon::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GEO_LON, PROPERTIES_TBL_PROSPECT_CONTACT:guid::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_GUID, PROPERTIES_TBL_PROSPECT_CONTACT:id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_ID, PROPERTIES_TBL_PROSPECT_CONTACT:idaccount::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_IDACCOUNT, PROPERTIES_TBL_PROSPECT_CONTACT:is_active::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_IS_ACTIVE, PROPERTIES_TBL_PROSPECT_CONTACT:list_id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_LIST_ID, PROPERTIES_TBL_PROSPECT_CONTACT:update_time::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_UPDATE_TIME, PROPERTIES_TBL_PROSPECT_CONTACT:update_user_id::STRING AS PROPERTIES_TBL_PROSPECT_CONTACT_UPDATE_USER_ID, 
		AGE AS AGE, AGE_RANGE AS AGE_RANGE, ADMISSION_DATE AS ADMISSION_DATE, DISCHARGE_DATE AS DISCHARGE_DATE, CLIENT_BRN AS CLIENT_BRN, PREFERRED_LANGUAGE AS PREFERRED_LANGUAGE, VISIT_COUNT AS VISIT_COUNT, LENGTH_OF_STAY AS LENGTH_OF_STAY, HAS_ADLS AS HAS_ADLS
		,PROFILE:acquired_business_::STRING AS PROFILE_acquired_business_,PROFILE:acquisition_date::STRING AS PROFILE_acquisition_date 
        FROM ALAYACARE_${var.SF_ENVIRONMENT}UCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_CLIENT
		WHERE PROFILE_IMPORT_ID  LIKE ''%Client%'';

	SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	return return_result;
END;

 EOT
}

