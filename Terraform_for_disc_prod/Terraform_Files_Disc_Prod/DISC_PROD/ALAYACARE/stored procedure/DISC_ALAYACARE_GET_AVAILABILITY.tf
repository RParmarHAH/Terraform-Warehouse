resource "snowflake_procedure" "DISC_ALAYACARE_GET_AVAILABILITY" {
	name ="GET_AVAILABILITY"
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "ALAYACARE"
	language  = "SQL"
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

DECLARE
--*****************************************************************************************************************************
-- NAME:  GET_AVAILABILITY 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE        		AUTHOR                	NOTES:
-- ----------  		-------------------   	-----------------------------------------------------------------------------------------------
-- 2021-11-11		UNKNOWN					INITIAL DEVELOPMENT
-- 2023-09-05  		RAVI SUTHAR            	MIGRATED JavaScript to SQL
--*****************************************************************************************************************************
    return_result varchar(1000);
BEGIN
	
    INSERT OVERWRITE INTO ALAYACARE.AVAILABILITY (
        AVAILABILITY_ID, AVAILABILITY_GUID_TO, SERVICECODE_ID, AVAILABILITY_START_DATE, AVAILABILITY_END_DATE, EVENT_START_DATE, EVENT_END_DATE, AVAILABILITY_TYPE, AVAILABILITY_FREQUENCY, AVAILABILITY_INTERVAL, EVENT_DURATION_PAID, AVAILABILITY_DISABLED, TIME_OFF_NAME, EVENT_DURATION, AVAILABILITY_DAYS, AVAILABILITY_DESCRIPTION, AVAILABILITY_DAYS_LIST, IS_DELETED, 
		PROPERTIES_SCHEDULE_RRULES_OP, PROPERTIES_SCHEDULE_RRULES_CREATE_TIME, PROPERTIES_SCHEDULE_RRULES_CREATE_USER_ID, PROPERTIES_SCHEDULE_RRULES_DESCRIPTION, PROPERTIES_SCHEDULE_RRULES_DISABLED, PROPERTIES_SCHEDULE_RRULES_DURATION, PROPERTIES_SCHEDULE_RRULES_GUID, PROPERTIES_SCHEDULE_RRULES_GUID_TO, PROPERTIES_SCHEDULE_RRULES_ID, PROPERTIES_SCHEDULE_RRULES_IDMASTERACCOUNT, PROPERTIES_SCHEDULE_RRULES_RRULE, PROPERTIES_SCHEDULE_RRULES_SCHEDULED_TO, PROPERTIES_SCHEDULE_RRULES_START_AT, PROPERTIES_SCHEDULE_RRULES_TYPE, PROPERTIES_SCHEDULE_RRULES_UPDATE_TIME, PROPERTIES_SCHEDULE_RRULES_UPDATE_USER_ID,
		PROPERTIES_UNAVAILABILITY_RRULES_OP, PROPERTIES_UNAVAILABILITY_RRULES_CREATE_TIME, PROPERTIES_UNAVAILABILITY_RRULES_CREATE_USER_ID, PROPERTIES_UNAVAILABILITY_RRULES_DURATION_PAID, PROPERTIES_UNAVAILABILITY_RRULES_ID, PROPERTIES_UNAVAILABILITY_RRULES_IS_DELETED, PROPERTIES_UNAVAILABILITY_RRULES_SCHEDULE_RRULE_ID, PROPERTIES_UNAVAILABILITY_RRULES_TIME_OFF_TYPE_ID, PROPERTIES_UNAVAILABILITY_RRULES_UPDATE_TIME, PROPERTIES_UNAVAILABILITY_RRULES_UPDATE_USER_ID,
		PROPERTIES_AVAILABILITY_RRULES,
		PROPERTIES_TIME_OFF_TYPES_CREATE_TIME, PROPERTIES_TIME_OFF_TYPES_CREATE_USER_ID, PROPERTIES_TIME_OFF_TYPES_DAY_DURATION, PROPERTIES_TIME_OFF_TYPES_ID, PROPERTIES_TIME_OFF_TYPES_IDMASTERACCOUNT, PROPERTIES_TIME_OFF_TYPES_NAME, PROPERTIES_TIME_OFF_TYPES_PAY_SCHEDULE_TIME, PROPERTIES_TIME_OFF_TYPES_UPDATE_TIME, PROPERTIES_TIME_OFF_TYPES_UPDATE_USER_ID,
		PROPERTIES_CALENDAR_EVENTS_OP, PROPERTIES_CALENDAR_EVENTS_CREATE_USER_ID, PROPERTIES_CALENDAR_EVENTS_CREATED_AT, PROPERTIES_CALENDAR_EVENTS_DURATION, PROPERTIES_CALENDAR_EVENTS_END_AT, PROPERTIES_CALENDAR_EVENTS_ID, PROPERTIES_CALENDAR_EVENTS_RRULE_ID, PROPERTIES_CALENDAR_EVENTS_START_AT, PROPERTIES_CALENDAR_EVENTS_TYPE, PROPERTIES_CALENDAR_EVENTS_UPDATE_USER_ID, PROPERTIES_CALENDAR_EVENTS_UPDATED_AT,
		PROPERTIES_CALENDAR_TIME_OFF_EVENTS_OP, PROPERTIES_CALENDAR_TIME_OFF_EVENTS_CALENDAR_EVENT_ID, PROPERTIES_CALENDAR_TIME_OFF_EVENTS_DURATION_PAID,
		PROPERTIES_CALENDAR_TIME_OFF_EVENTS_DURATION_BREAKDOWNS)
        SELECT AVAILABILITY_ID AS AVAILABILITY_ID, AVAILABILITY_GUID_TO AS AVAILABILITY_GUID_TO, SERVICECODE_ID AS SERVICECODE_ID, AVAILABILITY_START_DATE AS AVAILABILITY_START_DATE, AVAILABILITY_END_DATE AS AVAILABILITY_END_DATE, EVENT_START_DATE AS EVENT_START_DATE, EVENT_END_DATE AS EVENT_END_DATE, AVAILABILITY_TYPE AS AVAILABILITY_TYPE, AVAILABILITY_FREQUENCY AS AVAILABILITY_FREQUENCY, AVAILABILITY_INTERVAL AS AVAILABILITY_INTERVAL, EVENT_DURATION_PAID AS EVENT_DURATION_PAID, AVAILABILITY_DISABLED AS AVAILABILITY_DISABLED, TIME_OFF_NAME AS TIME_OFF_NAME, EVENT_DURATION AS EVENT_DURATION, AVAILABILITY_DAYS AS AVAILABILITY_DAYS, AVAILABILITY_DESCRIPTION AS AVAILABILITY_DESCRIPTION, AVAILABILITY_DAYS_LIST AS AVAILABILITY_DAYS_LIST, IS_DELETED AS IS_DELETED, 
			PROPERTIES_SCHEDULE_RRULES:Op::STRING AS PROPERTIES_SCHEDULE_RRULES_OP, PROPERTIES_SCHEDULE_RRULES:create_time::STRING AS PROPERTIES_SCHEDULE_RRULES_CREATE_TIME, PROPERTIES_SCHEDULE_RRULES:create_user_id::STRING AS PROPERTIES_SCHEDULE_RRULES_CREATE_USER_ID, PROPERTIES_SCHEDULE_RRULES:description::STRING AS PROPERTIES_SCHEDULE_RRULES_DESCRIPTION, PROPERTIES_SCHEDULE_RRULES:disabled::STRING AS PROPERTIES_SCHEDULE_RRULES_DISABLED, PROPERTIES_SCHEDULE_RRULES:duration::STRING AS PROPERTIES_SCHEDULE_RRULES_DURATION, PROPERTIES_SCHEDULE_RRULES:guid::STRING AS PROPERTIES_SCHEDULE_RRULES_GUID, PROPERTIES_SCHEDULE_RRULES:guid_to::STRING AS PROPERTIES_SCHEDULE_RRULES_GUID_TO, PROPERTIES_SCHEDULE_RRULES:id::STRING AS PROPERTIES_SCHEDULE_RRULES_ID, PROPERTIES_SCHEDULE_RRULES:idmasteraccount::STRING AS PROPERTIES_SCHEDULE_RRULES_IDMASTERACCOUNT, PROPERTIES_SCHEDULE_RRULES:rrule::STRING AS PROPERTIES_SCHEDULE_RRULES_RRULE, PROPERTIES_SCHEDULE_RRULES:scheduled_to::STRING AS PROPERTIES_SCHEDULE_RRULES_SCHEDULED_TO, PROPERTIES_SCHEDULE_RRULES:start_at::STRING AS PROPERTIES_SCHEDULE_RRULES_START_AT, PROPERTIES_SCHEDULE_RRULES:type::STRING AS PROPERTIES_SCHEDULE_RRULES_TYPE, PROPERTIES_SCHEDULE_RRULES:update_time::STRING AS PROPERTIES_SCHEDULE_RRULES_UPDATE_TIME, PROPERTIES_SCHEDULE_RRULES:update_user_id::STRING AS PROPERTIES_SCHEDULE_RRULES_UPDATE_USER_ID,
			PROPERTIES_UNAVAILABILITY_RRULES:Op::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_OP, PROPERTIES_UNAVAILABILITY_RRULES:create_time::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_CREATE_TIME, PROPERTIES_UNAVAILABILITY_RRULES:create_user_id::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_CREATE_USER_ID, PROPERTIES_UNAVAILABILITY_RRULES:duration_paid::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_DURATION_PAID, PROPERTIES_UNAVAILABILITY_RRULES:id::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_ID, PROPERTIES_UNAVAILABILITY_RRULES:is_deleted::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_IS_DELETED, PROPERTIES_UNAVAILABILITY_RRULES:schedule_rrule_id::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_SCHEDULE_RRULE_ID, PROPERTIES_UNAVAILABILITY_RRULES:time_off_type_id::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_TIME_OFF_TYPE_ID, PROPERTIES_UNAVAILABILITY_RRULES:update_time::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_UPDATE_TIME, PROPERTIES_UNAVAILABILITY_RRULES:update_user_id::STRING AS PROPERTIES_UNAVAILABILITY_RRULES_UPDATE_USER_ID,
			PROPERTIES_AVAILABILITY_RRULES::STRING AS PROPERTIES_AVAILABILITY_RRULES,
			PROPERTIES_TIME_OFF_TYPES:create_time::STRING AS PROPERTIES_TIME_OFF_TYPES_CREATE_TIME, PROPERTIES_TIME_OFF_TYPES:create_user_id::STRING AS PROPERTIES_TIME_OFF_TYPES_CREATE_USER_ID, PROPERTIES_TIME_OFF_TYPES:day_duration::STRING AS PROPERTIES_TIME_OFF_TYPES_DAY_DURATION, PROPERTIES_TIME_OFF_TYPES:id::STRING AS PROPERTIES_TIME_OFF_TYPES_ID, PROPERTIES_TIME_OFF_TYPES:idmasteraccount::STRING AS PROPERTIES_TIME_OFF_TYPES_IDMASTERACCOUNT, PROPERTIES_TIME_OFF_TYPES:name::STRING AS PROPERTIES_TIME_OFF_TYPES_NAME, PROPERTIES_TIME_OFF_TYPES:pay_schedule_time::STRING AS PROPERTIES_TIME_OFF_TYPES_PAY_SCHEDULE_TIME, PROPERTIES_TIME_OFF_TYPES:update_time::STRING AS PROPERTIES_TIME_OFF_TYPES_UPDATE_TIME, PROPERTIES_TIME_OFF_TYPES:update_user_id::STRING AS PROPERTIES_TIME_OFF_TYPES_UPDATE_USER_ID,
			PROPERTIES_CALENDAR_EVENTS:Op::STRING AS PROPERTIES_CALENDAR_EVENTS_OP, PROPERTIES_CALENDAR_EVENTS:create_user_id::STRING AS PROPERTIES_CALENDAR_EVENTS_CREATE_USER_ID, PROPERTIES_CALENDAR_EVENTS:created_at::STRING AS PROPERTIES_CALENDAR_EVENTS_CREATED_AT, PROPERTIES_CALENDAR_EVENTS:duration::STRING AS PROPERTIES_CALENDAR_EVENTS_DURATION, PROPERTIES_CALENDAR_EVENTS:end_at::STRING AS PROPERTIES_CALENDAR_EVENTS_END_AT, PROPERTIES_CALENDAR_EVENTS:id::STRING AS PROPERTIES_CALENDAR_EVENTS_ID, PROPERTIES_CALENDAR_EVENTS:rrule_id::STRING AS PROPERTIES_CALENDAR_EVENTS_RRULE_ID, PROPERTIES_CALENDAR_EVENTS:start_at::STRING AS PROPERTIES_CALENDAR_EVENTS_START_AT, PROPERTIES_CALENDAR_EVENTS:type::STRING AS PROPERTIES_CALENDAR_EVENTS_TYPE, PROPERTIES_CALENDAR_EVENTS:update_user_id::STRING AS PROPERTIES_CALENDAR_EVENTS_UPDATE_USER_ID, PROPERTIES_CALENDAR_EVENTS:updated_at::STRING AS PROPERTIES_CALENDAR_EVENTS_UPDATED_AT,
			PROPERTIES_CALENDAR_TIME_OFF_EVENTS:Op::STRING AS PROPERTIES_CALENDAR_TIME_OFF_EVENTS_OP, PROPERTIES_CALENDAR_TIME_OFF_EVENTS:calendar_event_id::STRING AS PROPERTIES_CALENDAR_TIME_OFF_EVENTS_CALENDAR_EVENT_ID, PROPERTIES_CALENDAR_TIME_OFF_EVENTS:duration_paid::STRING AS PROPERTIES_CALENDAR_TIME_OFF_EVENTS_DURATION_PAID,
			PROPERTIES_CALENDAR_TIME_OFF_EVENTS_DURATION_BREAKDOWNS
        FROM ALAYACARE_${var.SF_ENVIRONMENT}UCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_AVAILABILITY;

	SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	return return_result;
END;

 EOT
}

