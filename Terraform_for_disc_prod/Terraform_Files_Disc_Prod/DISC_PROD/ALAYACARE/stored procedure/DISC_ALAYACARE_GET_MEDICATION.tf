resource "snowflake_procedure" "DISC_ALAYACARE_GET_MEDICATION" {
	name ="GET_MEDICATION"
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "ALAYACARE"
	language  = "SQL"
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

DECLARE
--*****************************************************************************************************************************
-- NAME:  GET_MEDICATION 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE        		AUTHOR                	NOTES:
-- ----------  		-------------------   	-----------------------------------------------------------------------------------------------
-- 2021-11-11		UNKNOWN					INITIAL DEVELOPMENT
-- 2023-09-05  		RAVI SUTHAR            	MIGRATED JavaScript to SQL
--*****************************************************************************************************************************
    return_result varchar(1000);
BEGIN
	
    INSERT OVERWRITE INTO ALAYACARE.MEDICATION (
        MEDICATION_ID, MEDADMIN_ID, PK_MEDICATION_ID, CREATED_DATE, UPDATED_DATE, START_DATE, END_DATE, MED_EMPLOYEE_CREATE_ID, MED_EMPLOYEE_UPDATE_ID, MEDADMIN_EMPLOYEE_CREATE_ID, MEDADMIN_EMPLOYEE_UPDATE_ID, CLIENT_ID, "COMMENT",	DATE_COMPLETED, MEDADMIN_HELD, MEDICATION, HIGH_ALERT, MEDICATION_TYPE, STATUS, ADMINISTERED_BY_NURSE, DOSE, DOSAGE_TYPE, ROUTE, DELIVERY_MODE, ADMINISTRATION_TIMES, ORDERING_PHYSICIAN, INFORMATION_SOURCE, DISCREPANCY, DISCREPANCY_STATUS, EPISODE_ID, TIME_INSTRUCTION, SPECIAL_INSTRUCTIONS, DISCREPANCY_NOTE, 
		PROPERTIES_MEDICATION_ADMINISTRATION_COMMENT, PROPERTIES_MEDICATION_ADMINISTRATION_CONCENTRATION, PROPERTIES_MEDICATION_ADMINISTRATION_CREATED_EMPLOYEE_ID, PROPERTIES_MEDICATION_ADMINISTRATION_DATE_COMPLETE, PROPERTIES_MEDICATION_ADMINISTRATION_DID_NOT_ADMINISTER, PROPERTIES_MEDICATION_ADMINISTRATION_DOSE, PROPERTIES_MEDICATION_ADMINISTRATION_ID, PROPERTIES_MEDICATION_ADMINISTRATION_MEDICATION_ID, PROPERTIES_MEDICATION_ADMINISTRATION_ROUTE, PROPERTIES_MEDICATION_ADMINISTRATION_UPDATED_EMPLOYEE_ID, 
		PROPERTIES_MEDICATION_ADMINISTERED_BY_NURSE, PROPERTIES_MEDICATION_ADMINISTRATION_TIMES, PROPERTIES_MEDICATION_ADMINISTRATOR, PROPERTIES_MEDICATION_COMMENTS, PROPERTIES_MEDICATION_CREATED_EMPLOYEE_ID, PROPERTIES_MEDICATION_CREATED_TIME, PROPERTIES_MEDICATION_DELIVERY_MODE, PROPERTIES_MEDICATION_DISCREPANCY, PROPERTIES_MEDICATION_DISCREPANCY_NOTE, PROPERTIES_MEDICATION_DISCREPANCY_STATUS, PROPERTIES_MEDICATION_DOSAGE_TYPE, PROPERTIES_MEDICATION_DOSE, PROPERTIES_MEDICATION_END_DATE_UNKNOWN, PROPERTIES_MEDICATION_HIGH_ALERT, PROPERTIES_MEDICATION_ID, PROPERTIES_MEDICATION_INFORMATION_SOURCE, PROPERTIES_MEDICATION_MEDICATION, PROPERTIES_MEDICATION_MEDICATION_TYPE, PROPERTIES_MEDICATION_ORDERING_PHYSICIAN, PROPERTIES_MEDICATION_PATIENT_ID, PROPERTIES_MEDICATION_ROUTE, PROPERTIES_MEDICATION_SPECIAL_INSTRUCTIONS, PROPERTIES_MEDICATION_START_DATE, PROPERTIES_MEDICATION_START_DATE_UNKNOWN, PROPERTIES_MEDICATION_STATUS, PROPERTIES_MEDICATION_TIME_INSTRUCTION, PROPERTIES_MEDICATION_UPDATED_EMPLOYEE_ID, PROPERTIES_MEDICATION_UPDATED_TIME)
        SELECT MEDICATION_ID AS MEDICATION_ID, MEDADMIN_ID AS MEDADMIN_ID, PK_MEDICATION_ID AS PK_MEDICATION_ID, CREATED_DATE AS CREATED_DATE, UPDATED_DATE AS UPDATED_DATE, START_DATE AS START_DATE, END_DATE AS END_DATE, MED_EMPLOYEE_CREATE_ID AS MED_EMPLOYEE_CREATE_ID, MED_EMPLOYEE_UPDATE_ID AS MED_EMPLOYEE_UPDATE_ID, MEDADMIN_EMPLOYEE_CREATE_ID AS MEDADMIN_EMPLOYEE_CREATE_ID, MEDADMIN_EMPLOYEE_UPDATE_ID AS MEDADMIN_EMPLOYEE_UPDATE_ID, CLIENT_ID AS CLIENT_ID, "COMMENT" AS "COMMENT", DATE_COMPLETED AS DATE_COMPLETED, MEDADMIN_HELD AS MEDADMIN_HELD, MEDICATION AS MEDICATION, HIGH_ALERT AS HIGH_ALERT, MEDICATION_TYPE AS MEDICATION_TYPE, STATUS AS STATUS, ADMINISTERED_BY_NURSE AS ADMINISTERED_BY_NURSE, DOSE AS DOSE, DOSAGE_TYPE AS DOSAGE_TYPE, ROUTE AS ROUTE, DELIVERY_MODE AS DELIVERY_MODE, ADMINISTRATION_TIMES AS ADMINISTRATION_TIMES, ORDERING_PHYSICIAN AS ORDERING_PHYSICIAN, INFORMATION_SOURCE AS INFORMATION_SOURCE, DISCREPANCY AS DISCREPANCY, DISCREPANCY_STATUS AS DISCREPANCY_STATUS, EPISODE_ID AS EPISODE_ID, TIME_INSTRUCTION AS TIME_INSTRUCTION, SPECIAL_INSTRUCTIONS AS SPECIAL_INSTRUCTIONS, DISCREPANCY_NOTE AS DISCREPANCY_NOTE, 
			PROPERTIES_MEDICATION_ADMINISTRATION:comment::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_COMMENT, PROPERTIES_MEDICATION_ADMINISTRATION:concentration::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_CONCENTRATION, PROPERTIES_MEDICATION_ADMINISTRATION:created_employee_id::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_CREATED_EMPLOYEE_ID, PROPERTIES_MEDICATION_ADMINISTRATION:date_complete::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_DATE_COMPLETE, PROPERTIES_MEDICATION_ADMINISTRATION:did_not_administer::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_DID_NOT_ADMINISTER, PROPERTIES_MEDICATION_ADMINISTRATION:dose::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_DOSE, PROPERTIES_MEDICATION_ADMINISTRATION:id::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_ID, PROPERTIES_MEDICATION_ADMINISTRATION:medication_id::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_MEDICATION_ID, PROPERTIES_MEDICATION_ADMINISTRATION:route::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_ROUTE, PROPERTIES_MEDICATION_ADMINISTRATION:updated_employee_id::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_UPDATED_EMPLOYEE_ID, 
 			PROPERTIES_MEDICATION:administered_by_nurse::STRING AS PROPERTIES_MEDICATION_ADMINISTERED_BY_NURSE, PROPERTIES_MEDICATION:administration_times::STRING AS PROPERTIES_MEDICATION_ADMINISTRATION_TIMES, PROPERTIES_MEDICATION:administrator::STRING AS PROPERTIES_MEDICATION_ADMINISTRATOR, PROPERTIES_MEDICATION:comments::STRING AS PROPERTIES_MEDICATION_COMMENTS, PROPERTIES_MEDICATION:created_employee_id::STRING AS PROPERTIES_MEDICATION_CREATED_EMPLOYEE_ID, PROPERTIES_MEDICATION:created_time::STRING AS PROPERTIES_MEDICATION_CREATED_TIME, PROPERTIES_MEDICATION:delivery_mode::STRING AS PROPERTIES_MEDICATION_DELIVERY_MODE, PROPERTIES_MEDICATION:discrepancy::STRING AS PROPERTIES_MEDICATION_DISCREPANCY, PROPERTIES_MEDICATION:discrepancy_note::STRING AS PROPERTIES_MEDICATION_DISCREPANCY_NOTE, PROPERTIES_MEDICATION:discrepancy_status::STRING AS PROPERTIES_MEDICATION_DISCREPANCY_STATUS, PROPERTIES_MEDICATION:dosage_type::STRING AS PROPERTIES_MEDICATION_DOSAGE_TYPE, PROPERTIES_MEDICATION:dose::STRING AS PROPERTIES_MEDICATION_DOSE, PROPERTIES_MEDICATION:end_date_unknown::STRING AS PROPERTIES_MEDICATION_END_DATE_UNKNOWN, PROPERTIES_MEDICATION:high_alert::STRING AS PROPERTIES_MEDICATION_HIGH_ALERT, PROPERTIES_MEDICATION:id::STRING AS PROPERTIES_MEDICATION_ID, PROPERTIES_MEDICATION:information_source::STRING AS PROPERTIES_MEDICATION_INFORMATION_SOURCE, PROPERTIES_MEDICATION:medication::STRING AS PROPERTIES_MEDICATION_MEDICATION, PROPERTIES_MEDICATION:medication_type::STRING AS PROPERTIES_MEDICATION_MEDICATION_TYPE, PROPERTIES_MEDICATION:ordering_physician::STRING AS PROPERTIES_MEDICATION_ORDERING_PHYSICIAN, PROPERTIES_MEDICATION:patient_id::STRING AS PROPERTIES_MEDICATION_PATIENT_ID, PROPERTIES_MEDICATION:route::STRING AS PROPERTIES_MEDICATION_ROUTE, PROPERTIES_MEDICATION:special_instructions::STRING AS PROPERTIES_MEDICATION_SPECIAL_INSTRUCTIONS, PROPERTIES_MEDICATION:start_date::STRING AS PROPERTIES_MEDICATION_START_DATE, PROPERTIES_MEDICATION:start_date_unknown::STRING AS PROPERTIES_MEDICATION_START_DATE_UNKNOWN, PROPERTIES_MEDICATION:status::STRING AS PROPERTIES_MEDICATION_STATUS, PROPERTIES_MEDICATION:time_instruction::STRING AS PROPERTIES_MEDICATION_TIME_INSTRUCTION, PROPERTIES_MEDICATION:updated_employee_id::STRING AS PROPERTIES_MEDICATION_UPDATED_EMPLOYEE_ID, PROPERTIES_MEDICATION:updated_time::STRING AS PROPERTIES_MEDICATION_UPDATED_TIME 
        FROM ALAYACARE_${var.SF_ENVIRONMENT}UCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_MEDICATION;

	SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	return return_result;
END;

 EOT
}

