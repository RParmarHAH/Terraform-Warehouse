resource "snowflake_procedure" "DISC_ALAYACARE_GET_VISIT" {
	name ="GET_VISIT"
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "ALAYACARE"
	language  = "SQL"
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

DECLARE
--*****************************************************************************************************************************
-- NAME:  GET_VISIT 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE        		AUTHOR                	NOTES:
-- ----------  		-------------------   	-----------------------------------------------------------------------------------------------
-- 2021-11-11		UNKNOWN					INITIAL DEVELOPMENT
-- 2023-09-05  		RAVI SUTHAR            	MIGRATED JavaScript to SQL
--*****************************************************************************************************************************
    return_result varchar(1000);
BEGIN
	
    INSERT OVERWRITE INTO ALAYACARE.VISIT (
        VISIT_ID, SERVICE_ID, CLIENT_ID, IDACCOUNTTYPE, EMPLOYEE_ID, GUID, BRANCH_ID, SERVICE_CODE_ID, CREATED_AT, CREATED_BY, UPDATED_AT, UPDATED_BY, START_AT, END_AT, FUNDER_LAST_UPDATE, HOLIDAY_DATE, VISIT_COMPUTED_RATE_UNITS, VISIT_COMPUTED_RATE_BILLITEM_ID, VISIT_COMPUTED_RATE, FACILITY_ID, VISIT_COMPLETED, PROPERTIES_TBL_SCHEDULER_ITEM_STATUS_REASON_ID, PROPERTIES_TBL_SCHEDULER_ITEM_IDUSER, PROPERTIES_TBL_SCHEDULER_ITEM_END_TIME_OFFSET, PROPERTIES_TBL_SCHEDULER_ITEM_IDMASTERACCOUNT, PROPERTIES_TBL_SCHEDULER_ITEM_LAST_VIEWED, PROPERTIES_TBL_SCHEDULER_ITEM_HOURS_APPROVED, PROPERTIES_TBL_SCHEDULER_ITEM_SERVICE_INSTRUCTIONS, PROPERTIES_TBL_SCHEDULER_ITEM_LAST_WORK_SESSION_ID, PROPERTIES_TBL_SCHEDULER_ITEM_END_TIME_APPROVED, PROPERTIES_TBL_SCHEDULER_ITEM_FIRST_WORK_SESSION_ID, PROPERTIES_TBL_SCHEDULER_ITEM_START_TIME_OFFSET, PROPERTIES_TBL_SCHEDULER_ITEM_RATE_BILL, PROPERTIES_TBL_SCHEDULER_ITEM_OP, PROPERTIES_TBL_SCHEDULER_ITEM_HOURS_BILL, PROPERTIES_TBL_SCHEDULER_ITEM_END_TIME, PROPERTIES_TBL_SCHEDULER_ITEM_CANCELLED_CODE_ID, PROPERTIES_TBL_SCHEDULER_ITEM_START_TIME, PROPERTIES_TBL_SCHEDULER_ITEM_IS_LOCKED, PROPERTIES_TBL_SCHEDULER_ITEM_SERVICE_CODE_ID, PROPERTIES_TBL_SCHEDULER_ITEM_CREATE_TIME, PROPERTIES_TBL_SCHEDULER_ITEM_CHECK_HASH, PROPERTIES_TBL_SCHEDULER_ITEM_GUID, PROPERTIES_TBL_SCHEDULER_ITEM_LAST_EMAILED, PROPERTIES_TBL_SCHEDULER_ITEM_UPDATE_USER_ID, PROPERTIES_TBL_SCHEDULER_ITEM_START_TIME_APPROVED, PROPERTIES_TBL_SCHEDULER_ITEM_LAST_NOTIFICATION, PROPERTIES_TBL_SCHEDULER_ITEM_MODIFIED_SINGLE, PROPERTIES_TBL_SCHEDULER_ITEM_IDPOSITION, PROPERTIES_TBL_SCHEDULER_ITEM_BREAK_MINUTES, PROPERTIES_TBL_SCHEDULER_ITEM_IDDEPTCODE, PROPERTIES_TBL_SCHEDULER_ITEM_SERVICE_RRULE_ID, PROPERTIES_TBL_SCHEDULER_ITEM_UPDATE_TIME, PROPERTIES_TBL_SCHEDULER_ITEM_USE_DEFAULT_DURATION, PROPERTIES_TBL_SCHEDULER_ITEM_IDSTATUS, PROPERTIES_TBL_SCHEDULER_ITEM_ID, PROPERTIES_TBL_SCHEDULER_ITEM_LAST_ACCEPTED, PROPERTIES_TBL_SCHEDULER_ITEM_DISPLAY_ID, PROPERTIES_TBL_SCHEDULER_ITEM_CREATE_USER_ID, PROPERTIES_TBL_SCHEDULER_ITEM_APPROVAL_STATUS, PROPERTIES_TBL_SCHEDULER_ITEM_FUNDER_VALIDATION_BLOCK_ID, PROPERTIES_TBL_SCHEDULER_ITEM_LAST_MODIFIED, PROPERTIES_TBL_SCHEDULER_ITEM_HOURS_PAY, PROPERTIES_TBL_SCHEDULER_ITEM_CONFIRMED, IN_OUT_OF_RECURRENCE_STATUS, VISIT_RECURRENCE, IS_INVOICED, IS_PAID, VISIT_IN_FACILITY, VISIT_SEQUENCE_BY_CLIENT, VISIT_SEQUENCE_BY_CLIENT_SERVICE, ACCOUNT_TYPE, CLIENT_VISIT_FACILITY, VISIT_MARKED_FOR_RESUBMISSION, VISIT_WRITTEN_OFF, ADL_COMPLETE, HAS_ADL, HAS_NOTE, VISIT_NOTE_COUNT, BREAK_MINUTES, BREAK_HOURS, VISIT_APPROVAL_STATUS, VISIT_HOURS_APPROVED, VISIT_HOURS_BILL, VISIT_BILL, VISIT_SCHEDULED_DURATION, VISIT_UNIT_QTY, VISIT_REVENUE, VISIT_REVENUE_BREAKTIME, VISIT_MISSED_CLASS, VISIT_BILL_DURATION)
        SELECT VISIT_ID AS VISIT_ID, SERVICE_ID AS SERVICE_ID, CLIENT_ID AS CLIENT_ID, IDACCOUNTTYPE AS IDACCOUNTTYPE, EMPLOYEE_ID AS EMPLOYEE_ID, GUID AS GUID, BRANCH_ID AS BRANCH_ID, SERVICE_CODE_ID AS SERVICE_CODE_ID, CREATED_AT AS CREATED_AT, CREATED_BY AS CREATED_BY, UPDATED_AT AS UPDATED_AT, UPDATED_BY AS UPDATED_BY, START_AT AS START_AT, END_AT AS END_AT, FUNDER_LAST_UPDATE AS FUNDER_LAST_UPDATE, HOLIDAY_DATE AS HOLIDAY_DATE, VISIT_COMPUTED_RATE_UNITS AS VISIT_COMPUTED_RATE_UNITS, VISIT_COMPUTED_RATE_BILLITEM_ID AS VISIT_COMPUTED_RATE_BILLITEM_ID, VISIT_COMPUTED_RATE AS VISIT_COMPUTED_RATE, FACILITY_ID AS FACILITY_ID, VISIT_COMPLETED AS VISIT_COMPLETED, PROPERTIES_TBL_SCHEDULER_ITEM:status_reason_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_STATUS_REASON_ID, PROPERTIES_TBL_SCHEDULER_ITEM:iduser::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_IDUSER, PROPERTIES_TBL_SCHEDULER_ITEM:end_time_offset::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_END_TIME_OFFSET, PROPERTIES_TBL_SCHEDULER_ITEM:idmasteraccount::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_IDMASTERACCOUNT, PROPERTIES_TBL_SCHEDULER_ITEM:last_viewed::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_LAST_VIEWED, PROPERTIES_TBL_SCHEDULER_ITEM:hours_approved::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_HOURS_APPROVED, PROPERTIES_TBL_SCHEDULER_ITEM:service_instructions::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_SERVICE_INSTRUCTIONS, PROPERTIES_TBL_SCHEDULER_ITEM:last_work_session_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_LAST_WORK_SESSION_ID, PROPERTIES_TBL_SCHEDULER_ITEM:end_time_approved::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_END_TIME_APPROVED, PROPERTIES_TBL_SCHEDULER_ITEM:first_work_session_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_FIRST_WORK_SESSION_ID, PROPERTIES_TBL_SCHEDULER_ITEM:start_time_offset::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_START_TIME_OFFSET, PROPERTIES_TBL_SCHEDULER_ITEM:rate_bill::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_RATE_BILL, PROPERTIES_TBL_SCHEDULER_ITEM:Op::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_OP, PROPERTIES_TBL_SCHEDULER_ITEM:hours_bill::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_HOURS_BILL, PROPERTIES_TBL_SCHEDULER_ITEM:end_time::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_END_TIME, PROPERTIES_TBL_SCHEDULER_ITEM:cancelled_code_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_CANCELLED_CODE_ID, PROPERTIES_TBL_SCHEDULER_ITEM:start_time::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_START_TIME, PROPERTIES_TBL_SCHEDULER_ITEM:is_locked::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_IS_LOCKED, PROPERTIES_TBL_SCHEDULER_ITEM:service_code_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_SERVICE_CODE_ID, PROPERTIES_TBL_SCHEDULER_ITEM:create_time::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_CREATE_TIME, PROPERTIES_TBL_SCHEDULER_ITEM:check_hash::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_CHECK_HASH, PROPERTIES_TBL_SCHEDULER_ITEM:guid::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_GUID, PROPERTIES_TBL_SCHEDULER_ITEM:last_emailed::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_LAST_EMAILED, PROPERTIES_TBL_SCHEDULER_ITEM:update_user_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_UPDATE_USER_ID, PROPERTIES_TBL_SCHEDULER_ITEM:start_time_approved::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_START_TIME_APPROVED, PROPERTIES_TBL_SCHEDULER_ITEM:last_notification::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_LAST_NOTIFICATION, PROPERTIES_TBL_SCHEDULER_ITEM:modified_single::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_MODIFIED_SINGLE, PROPERTIES_TBL_SCHEDULER_ITEM:idposition::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_IDPOSITION, PROPERTIES_TBL_SCHEDULER_ITEM:break_minutes::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_BREAK_MINUTES, PROPERTIES_TBL_SCHEDULER_ITEM:iddeptcode::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_IDDEPTCODE, PROPERTIES_TBL_SCHEDULER_ITEM:service_rrule_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_SERVICE_RRULE_ID, PROPERTIES_TBL_SCHEDULER_ITEM:update_time::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_UPDATE_TIME, PROPERTIES_TBL_SCHEDULER_ITEM:use_default_duration::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_USE_DEFAULT_DURATION, PROPERTIES_TBL_SCHEDULER_ITEM:idstatus::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_IDSTATUS, PROPERTIES_TBL_SCHEDULER_ITEM:id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_ID, PROPERTIES_TBL_SCHEDULER_ITEM:last_accepted::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_LAST_ACCEPTED, PROPERTIES_TBL_SCHEDULER_ITEM:display_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_DISPLAY_ID, PROPERTIES_TBL_SCHEDULER_ITEM:create_user_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_CREATE_USER_ID, PROPERTIES_TBL_SCHEDULER_ITEM:approval_status::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_APPROVAL_STATUS, PROPERTIES_TBL_SCHEDULER_ITEM:funder_validation_block_id::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_FUNDER_VALIDATION_BLOCK_ID, PROPERTIES_TBL_SCHEDULER_ITEM:last_modified::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_LAST_MODIFIED, PROPERTIES_TBL_SCHEDULER_ITEM:hours_pay::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_HOURS_PAY, PROPERTIES_TBL_SCHEDULER_ITEM:confirmed::STRING AS PROPERTIES_TBL_SCHEDULER_ITEM_CONFIRMED, IN_OUT_OF_RECURRENCE_STATUS AS IN_OUT_OF_RECURRENCE_STATUS, VISIT_RECURRENCE AS VISIT_RECURRENCE, IS_INVOICED AS IS_INVOICED, IS_PAID AS IS_PAID, VISIT_IN_FACILITY AS VISIT_IN_FACILITY, VISIT_SEQUENCE_BY_CLIENT AS VISIT_SEQUENCE_BY_CLIENT, VISIT_SEQUENCE_BY_CLIENT_SERVICE AS VISIT_SEQUENCE_BY_CLIENT_SERVICE, ACCOUNT_TYPE AS ACCOUNT_TYPE, CLIENT_VISIT_FACILITY AS CLIENT_VISIT_FACILITY, VISIT_MARKED_FOR_RESUBMISSION AS VISIT_MARKED_FOR_RESUBMISSION, VISIT_WRITTEN_OFF AS VISIT_WRITTEN_OFF, ADL_COMPLETE AS ADL_COMPLETE, HAS_ADL AS HAS_ADL, HAS_NOTE AS HAS_NOTE, VISIT_NOTE_COUNT AS VISIT_NOTE_COUNT, BREAK_MINUTES AS BREAK_MINUTES, BREAK_HOURS AS BREAK_HOURS, VISIT_APPROVAL_STATUS AS VISIT_APPROVAL_STATUS, VISIT_HOURS_APPROVED AS VISIT_HOURS_APPROVED, VISIT_HOURS_BILL AS VISIT_HOURS_BILL, VISIT_BILL AS VISIT_BILL, VISIT_SCHEDULED_DURATION AS VISIT_SCHEDULED_DURATION, VISIT_UNIT_QTY AS VISIT_UNIT_QTY, VISIT_REVENUE AS VISIT_REVENUE, VISIT_REVENUE_BREAKTIME AS VISIT_REVENUE_BREAKTIME, VISIT_MISSED_CLASS AS VISIT_MISSED_CLASS, VISIT_BILL_DURATION AS VISIT_BILL_DURATION 
        FROM ALAYACARE_${var.SF_ENVIRONMENT}UCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_VISIT;

	SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	return return_result;
END;

 EOT
}

