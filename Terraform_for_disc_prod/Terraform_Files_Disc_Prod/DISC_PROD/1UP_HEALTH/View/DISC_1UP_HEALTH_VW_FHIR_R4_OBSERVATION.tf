resource "snowflake_view" "DISC_1UP_HEALTH_VW_FHIR_R4_OBSERVATION" {
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "1UP_HEALTH"
	name = "VW_FHIR_R4_OBSERVATION"
	statement = <<-SQL
	 (
select
parse_json(source_data):id::string as id,
parse_json(source_data):code:coding[0]:code::string as code_coding_code1,
parse_json(source_data):code:coding[0]:display::string as code_coding_display1,
parse_json(source_data):code:coding[0]:system::string as code_coding_system1,
parse_json(source_data):code:coding[1]:code::string as code_coding_code2,
parse_json(source_data):code:coding[1]:display::string as code_coding_display2,
parse_json(source_data):code:coding[1]:system::string as code_coding_system2,
parse_json(source_data):code:text::string as code_text,
parse_json(source_data):effectiveDateTime::TIMESTAMP_NTZ (9) as effectiveDateTime,
parse_json(source_data):encounter:reference::string as encounter_reference,
parse_json(source_data):identifier[0]:system::string as identifier_system1,
parse_json(source_data):identifier[0]:use::string as identifier_use1,
parse_json(source_data):identifier[0]:value::string as identifier_value1,
parse_json(source_data):identifier[1]:system::string as identifier_system2,
parse_json(source_data):identifier[1]:use::string as identifier_use2,
parse_json(source_data):identifier[1]:value::string as identifier_value2,
parse_json(source_data):identifier[2]:system::string as identifier_system3,
parse_json(source_data):identifier[2]:use::string as identifier_use3,
parse_json(source_data):identifier[2]:value::string as identifier_value3,
parse_json(source_data):identifier[3]:system::string as identifier_system4,
parse_json(source_data):identifier[3]:use::string as identifier_use4,
parse_json(source_data):identifier[3]:value::string as identifier_value4,
parse_json(source_data):interpretation[0]:coding[0]:code::string as interpretation_coding_code,
parse_json(source_data):interpretation[0]:coding[0]:display::string as interpretation_coding_display,
parse_json(source_data):interpretation[0]:coding[0]:system::string as interpretation_coding_system,
parse_json(source_data):issued::TIMESTAMP_NTZ (9) as issued,
parse_json(source_data):meta:extension[0]:url::string as meta_extension_url1,
parse_json(source_data):meta:extension[0]:valueDateTime::TIMESTAMP_NTZ (9) as meta_extension_valueDateTime1,
PARSE_JSON(SOURCE_DATA):meta:extension[0]:valueCodeableConcept:coding[0]:code::STRING AS meta_extension_valueCodeableConcept_coding_code1,
PARSE_JSON(SOURCE_DATA):meta:extension[0]:valueCodeableConcept:coding[0]:display::STRING AS meta_extension_valueCodeableConcept_coding_display1,
PARSE_JSON(SOURCE_DATA):meta:extension[0]:valueCodeableConcept:coding[0]:system::STRING AS meta_extension_valueCodeableConcept_coding_system1,
parse_json(source_data):meta:extension[1]:url::string as meta_extension_url2,
parse_json(source_data):meta:extension[1]:valueCodeableConcept:coding[0]:code::string as meta_extension_valueCodeableConcept_coding_code2,
parse_json(source_data):meta:extension[1]:valueCodeableConcept:coding[0]:system::string as meta_extension_valueCodeableConcept_coding_system2,
parse_json(source_data):meta:extension[2]:url::string as meta_extension_url3,
parse_json(source_data):meta:extension[2]:valueCodeableConcept:coding[0]:code::string as meta_extension_valueCodeableConcept_coding_code3,
parse_json(source_data):meta:extension[2]:valueCodeableConcept:coding[0]:system::string as meta_extension_valueCodeableConcept_coding_system3,
parse_json(source_data):meta:extension[3]:url::string as meta_extension_url4,
parse_json(source_data):meta:extension[3]:valueDateTime::TIMESTAMP_NTZ (9) as meta_extension_valueDateTime4,
parse_json(source_data):meta:extension[4]:url::string as meta_extension_url5,
parse_json(source_data):meta:extension[4]:valueString::string as meta_extensionvalueString5,
parse_json(source_data):meta:extension[5]:url::string as meta_extension_url6,
parse_json(source_data):meta:extension[5]:valueString::string as meta_extensionvalueString6,
parse_json(source_data):meta:extension[6]:url::string as meta_extension_url7,
parse_json(source_data):meta:extension[6]:valueString::string as meta_extensionvalueString7,
parse_json(source_data):meta:lastUpdated::TIMESTAMP_NTZ (9)  as meta_lastUpdated,
parse_json(source_data):meta:profile[0]::string as meta_profile,
parse_json(source_data):meta:source::string as meta_source,
parse_json(source_data):meta:versionId::string as meta_versionId,
parse_json(source_data):method:coding[0]:code::string as method_coding_code,
parse_json(source_data):method:text::string AS method_text,
parse_json(source_data):note[0].text::string as note_text,
parse_json(source_data):referenceRange[0]:high:unit::string as referenceRange_high_unit,
parse_json(source_data):referenceRange[0]:high:value::string as referenceRange_high_value,
parse_json(source_data):referenceRange[0]:low:unit::string as referenceRange_low_unit,
parse_json(source_data):referenceRange[0]:low:value::string as referenceRange_low_value,
parse_json(source_data):referenceRange[0]:text::string as referenceRange_text,
parse_json(source_data):resourceType::string as resourceType,
parse_json(source_data):status::string as status,
parse_json(source_data):subject:reference::string as subject_reference,
parse_json(source_data):subject:display::string as subject_display,
parse_json(source_data):text:div::string as text_div,
parse_json(source_data):text:status::string as text_status,
parse_json(source_data):valueQuantity:unit::string as valueQuantity_unit,
parse_json(source_data):valueQuantity:value::string as valueQuantity_value,	
parse_json(source_data):performer[0]:reference::string as performer_reference,	
parse_json(source_data):performer[0]:display::string as performer_display,
LANDING_INSERTED_DATE,
LANDING_INSERTED_BY,
FILENAME,
ETL_INSERTED_BY,
ETL_TASK_KEY,
ETL_INSERTED_DATE
FROM DISC_${var.SF_ENVIRONMENT}."1UP_HEALTH".HIST_FHIR_R4_OBSERVATION
);
SQL
	or_replace = true 
	is_secure = false 
}

