resource "snowflake_procedure" "DISC_PUBLIC_GET_INVOICE_DETAILS" {
	name ="GET_INVOICE_DETAILS"
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "PUBLIC"
	language  = "SQL"
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

DECLARE
  RETURN_RESULT VARCHAR(1000);
BEGIN
    INSERT OVERWRITE INTO ALAYACARE.INVOICE_DETAILS (
        INVOICE_ID, PAYOR_PROGRAM_NAME, INVOICE_FUNDER_ID, PAYOR_PROGRAM_FUNDER_ID, PAYOR_PROGRAM_BILLING_CONTACT_ID, MASTER_INVOICE_ID, MASTER_INVOICE_STATUS, INVOICE_NUMBER_VERSION, INVOICE_REGENERATED, INVOICE_TYPE_TMP, INVOICE_TYPE, INVOICE_TRANS_MODEL, INVOICE_DATEDIFF, INVOICE_AGING_RANGE, DATEDIFF_RANGE, PAYOR_BTP_REFERENCE, PAYOR_CRN,
		PROPERTIES_INVOICE_BALANCE, PROPERTIES_INVOICE_BILL_TO, PROPERTIES_INVOICE_BILL_TO_GUID, PROPERTIES_INVOICE_BILLED_BY_HOUR, PROPERTIES_INVOICE_BILLED_BY_VISIT, PROPERTIES_INVOICE_CLIENT_PREMIUMS_SUBTOTAL, PROPERTIES_INVOICE_CREATE_TIME, PROPERTIES_INVOICE_CREATE_USER_ID, PROPERTIES_INVOICE_FUNDER_ID, PROPERTIES_INVOICE_GUID, PROPERTIES_INVOICE_GUID_TO, PROPERTIES_INVOICE_ID, PROPERTIES_INVOICE_ID_BILLING_PERIOD, PROPERTIES_INVOICE_IDMASTERACCOUNT, PROPERTIES_INVOICE_IDTERM, PROPERTIES_INVOICE_INCOME_ITEMS_SUBTOTAL, PROPERTIES_INVOICE_INVOICE_DATE, PROPERTIES_INVOICE_INVOICE_NUMBER, PROPERTIES_INVOICE_INVOICE_VERSION, PROPERTIES_INVOICE_INVOICING_MODEL, PROPERTIES_INVOICE_IS_AD_HOC, PROPERTIES_INVOICE_MASTER_INVOICE_ID, PROPERTIES_INVOICE_MEMO, PROPERTIES_INVOICE_PAYOR_ID, PROPERTIES_INVOICE_SEND_TO, PROPERTIES_INVOICE_SEND_TO_GUID, PROPERTIES_INVOICE_SERVICE_PROVIDED_TO, PROPERTIES_INVOICE_SERVICE_PROVIDED_TO_GUID, PROPERTIES_INVOICE_STATUS, PROPERTIES_INVOICE_SUBTOTAL, PROPERTIES_INVOICE_SUPPLIES_SUBTOTAL, PROPERTIES_INVOICE_TOTAL, PROPERTIES_INVOICE_TOTAL_CLIENT_PREMIUMS, PROPERTIES_INVOICE_TOTAL_INCOME_ITEMS, PROPERTIES_INVOICE_TOTAL_PREMIUMS, PROPERTIES_INVOICE_TOTAL_SUPPLIES, PROPERTIES_INVOICE_TOTAL_VISITS, PROPERTIES_INVOICE_UPDATE_TIME, PROPERTIES_INVOICE_UPDATE_USER_ID, PROPERTIES_INVOICE_VISITS_AND_PREMIUMS_SUBTOTAL
		,IS_DELETED)
        SELECT INVOICE_ID AS INVOICE_ID, PAYOR_PROGRAM_NAME AS PAYOR_PROGRAM_NAME, INVOICE_FUNDER_ID AS INVOICE_FUNDER_ID, PAYOR_PROGRAM_FUNDER_ID AS PAYOR_PROGRAM_FUNDER_ID, PAYOR_PROGRAM_BILLING_CONTACT_ID AS PAYOR_PROGRAM_BILLING_CONTACT_ID, MASTER_INVOICE_ID AS MASTER_INVOICE_ID, MASTER_INVOICE_STATUS AS MASTER_INVOICE_STATUS, INVOICE_NUMBER_VERSION AS INVOICE_NUMBER_VERSION, INVOICE_REGENERATED AS INVOICE_REGENERATED, INVOICE_TYPE_TMP AS INVOICE_TYPE_TMP, INVOICE_TYPE AS INVOICE_TYPE, INVOICE_TRANS_MODEL AS INVOICE_TRANS_MODEL, INVOICE_DATEDIFF AS INVOICE_DATEDIFF, INVOICE_AGING_RANGE AS INVOICE_AGING_RANGE, DATEDIFF_RANGE AS DATEDIFF_RANGE, PAYOR_BTP_REFERENCE AS PAYOR_BTP_REFERENCE, PAYOR_CRN AS PAYOR_CRN,
			PROPERTIES_INVOICE:balance::STRING AS PROPERTIES_INVOICE_BALANCE, PROPERTIES_INVOICE:bill_to::STRING AS PROPERTIES_INVOICE_BILL_TO, PROPERTIES_INVOICE:bill_to_guid::STRING AS PROPERTIES_INVOICE_BILL_TO_GUID, PROPERTIES_INVOICE:billed_by_hour::STRING AS PROPERTIES_INVOICE_BILLED_BY_HOUR, PROPERTIES_INVOICE:billed_by_visit::STRING AS PROPERTIES_INVOICE_BILLED_BY_VISIT, PROPERTIES_INVOICE:client_premiums_subtotal::STRING AS PROPERTIES_INVOICE_CLIENT_PREMIUMS_SUBTOTAL, PROPERTIES_INVOICE:create_time::STRING AS PROPERTIES_INVOICE_CREATE_TIME, PROPERTIES_INVOICE:create_user_id::STRING AS PROPERTIES_INVOICE_CREATE_USER_ID, PROPERTIES_INVOICE:funder_id::STRING AS PROPERTIES_INVOICE_FUNDER_ID, PROPERTIES_INVOICE:guid::STRING AS PROPERTIES_INVOICE_GUID, PROPERTIES_INVOICE:guid_to::STRING AS PROPERTIES_INVOICE_GUID_TO, PROPERTIES_INVOICE:id::STRING AS PROPERTIES_INVOICE_ID, PROPERTIES_INVOICE:id_billing_period::STRING AS PROPERTIES_INVOICE_ID_BILLING_PERIOD, PROPERTIES_INVOICE:idmasteraccount::STRING AS PROPERTIES_INVOICE_IDMASTERACCOUNT, PROPERTIES_INVOICE:idterm::STRING AS PROPERTIES_INVOICE_IDTERM, PROPERTIES_INVOICE:income_items_subtotal::STRING AS PROPERTIES_INVOICE_INCOME_ITEMS_SUBTOTAL, PROPERTIES_INVOICE:invoice_date::STRING AS PROPERTIES_INVOICE_INVOICE_DATE, PROPERTIES_INVOICE:invoice_number::STRING AS PROPERTIES_INVOICE_INVOICE_NUMBER, PROPERTIES_INVOICE:invoice_version::STRING AS PROPERTIES_INVOICE_INVOICE_VERSION, PROPERTIES_INVOICE:invoicing_model::STRING AS PROPERTIES_INVOICE_INVOICING_MODEL, PROPERTIES_INVOICE:is_ad_hoc::STRING AS PROPERTIES_INVOICE_IS_AD_HOC, PROPERTIES_INVOICE:master_invoice_id::STRING AS PROPERTIES_INVOICE_MASTER_INVOICE_ID, PROPERTIES_INVOICE:memo::STRING AS PROPERTIES_INVOICE_MEMO, PROPERTIES_INVOICE:payor_id::STRING AS PROPERTIES_INVOICE_PAYOR_ID, PROPERTIES_INVOICE:send_to::STRING AS PROPERTIES_INVOICE_SEND_TO, PROPERTIES_INVOICE:send_to_guid::STRING AS PROPERTIES_INVOICE_SEND_TO_GUID, PROPERTIES_INVOICE:service_provided_to::STRING AS PROPERTIES_INVOICE_SERVICE_PROVIDED_TO, PROPERTIES_INVOICE:service_provided_to_guid::STRING AS PROPERTIES_INVOICE_SERVICE_PROVIDED_TO_GUID, PROPERTIES_INVOICE:status::STRING AS PROPERTIES_INVOICE_STATUS, PROPERTIES_INVOICE:subtotal::STRING AS PROPERTIES_INVOICE_SUBTOTAL, PROPERTIES_INVOICE:supplies_subtotal::STRING AS PROPERTIES_INVOICE_SUPPLIES_SUBTOTAL, PROPERTIES_INVOICE:total::STRING AS PROPERTIES_INVOICE_TOTAL, PROPERTIES_INVOICE:total_client_premiums::STRING AS PROPERTIES_INVOICE_TOTAL_CLIENT_PREMIUMS, PROPERTIES_INVOICE:total_income_items::STRING AS PROPERTIES_INVOICE_TOTAL_INCOME_ITEMS, PROPERTIES_INVOICE:total_premiums::STRING AS PROPERTIES_INVOICE_TOTAL_PREMIUMS, PROPERTIES_INVOICE:total_supplies::STRING AS PROPERTIES_INVOICE_TOTAL_SUPPLIES, PROPERTIES_INVOICE:total_visits::STRING AS PROPERTIES_INVOICE_TOTAL_VISITS, PROPERTIES_INVOICE:update_time::STRING AS PROPERTIES_INVOICE_UPDATE_TIME, PROPERTIES_INVOICE:update_user_id::STRING AS PROPERTIES_INVOICE_UPDATE_USER_ID, PROPERTIES_INVOICE:visits_and_premiums_subtotal::STRING AS PROPERTIES_INVOICE_VISITS_AND_PREMIUMS_SUBTOTAL
			,COALESCE (PROPERTIES_INVOICE:is_deleted::INT,0) AS IS_DELETED
        FROM ALAYACARE_${var.SF_ENVIRONMENT}UCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_INVOICE_DETAILS;
SELECT CONCAT (''MESSAGE : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	RETURN return_result;
    END;
    
 EOT
}

