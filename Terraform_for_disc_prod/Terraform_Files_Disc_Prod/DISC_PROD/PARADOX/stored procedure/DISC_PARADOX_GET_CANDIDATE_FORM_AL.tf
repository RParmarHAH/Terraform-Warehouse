resource "snowflake_procedure" "DISC_PARADOX_GET_CANDIDATE_FORM_AL" {
	name ="GET_CANDIDATE_FORM_AL"
	database = "DISC_${var.SF_ENVIRONMENT}"
	schema = "PARADOX"
	language  = "SQL"

	arguments {
		name = "TASKKEY"
		type = "VARCHAR(16777216)"
}	
	return_type = "VARCHAR(16777216)"
	execute_as = "OWNER"
	statement = <<-EOT

--*****************************************************************************************************************************
-- NAME:  GET_CANDIDATE_FORM_AL 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE				AUTHOR										NOTES:
-- ----------		-------------------							-----------------------------------------------------------------------------------------------
-- 2023-11-20		KOMAL DHOKAI/RAVI SUTHAR					INITIAL DEVELOPMENT
--*****************************************************************************************************************************
 
BEGIN 
    --TARGETSQL
    COPY INTO DISC_${var.SF_ENVIRONMENT}.PARADOX.HIST_CANDIDATE_FORM_AL FROM (SELECT A.$1 FORM_NAME, A.$2 LOCATION_CODE, A.$3 LOCATION_NAME, A.$4 JOB_APPLIED_TO, A.$5 JOB_REQ_ID, A.$6 JOB_TITLE, A.$7 CURRENT_CANDIDATE_JOURNEY_STATUS, A.$8 CANDIDATE_ID, A.$9 CANDIDATE_NAME, A.$10 FORM_DATE_SENT, A.$11 FORM_EXPIRATION_DATE, A.$12 FORM_CANCELLATION_DATE, A.$13 FORM_RESENT_DATE, A.$14 FORM_RESENT, A.$15 FORM_IN_PROGRESS_DATE, A.$16 FORM_COMPLETION_STATUS, A.$17 FORM_DATE_SUBMITTED, A.$18 FORM_PREVIEW_LINK, A.$19 PUBLISHED_DATE, A.$20 PUBLISHED_VERSION, A.$21 PROFILE_ID, A.$22 MULTIPLE_RECORDS, A.$23 PRIMARY_IDENTIFIER, A.$24 REAPPLY_IN_CAPTURE, A.$25 REAPPLY_IN_JOB_SEARCH, A.$26 REAPPLY_IN_CAMPAIGN, A.$27 PERSONAL_INFORMATION_YOUR_FULL_NAME, A.$28 PERSONAL_INFORMATION_PHONE_NUMBER, A.$29 PERSONAL_INFORMATION_EMAIL_ADDRESS, TRIM(PARSE_JSON( A.$30):"ADDRESS",''"'') AS PERSONAL_INFORMATION_STREET_ADDRESS_LINE_1, TRIM(PARSE_JSON( A.$30):"ADDRESS_2",''"'') AS PERSONAL_INFORMATION_STREET_ADDRESS_LINE_2, TRIM(PARSE_JSON( A.$30):"CITY",''"'') AS PERSONAL_INFORMATION_CITY, TRIM(PARSE_JSON( A.$30):"STATE",''"'') AS PERSONAL_INFORMATION_STATE, TRIM(PARSE_JSON( A.$30):"ZIP_CODE",''"'') AS PERSONAL_INFORMATION_ZIP_CODE, A.$31 PERSONAL_INFORMATION_EMERGENCY_CONTACT_NAME, A.$32 PERSONAL_INFORMATION_EMERGENCY_CONTACT_PHONE_NUMBER, A.$33 PERSONAL_INFORMATION_RELATION_TO_CAREGIVER, A.$34 PERSONAL_INFORMATION_HOW_DID_YOU_HEAR_ABOUT_THIS_JOB, A.$35 PERSONAL_INFORMATION_IF_OTHER_WHERE, A.$36 PERSONAL_INFORMATION_DO_YOU_HAVE_A_RELATIVE_THAT_WORKS_FOR_HELP_AT_HOME_IF_SO_WHAT_IS_THEIR_NAME, A.$37 PERSONAL_INFORMATION_AVAILABLE_DAYS, A.$38 PERSONAL_INFORMATION_HAVE_YOU_PREVIOUSLY_WORKED_FOR_HELP_AT_HOME, A.$39 PERSONAL_INFORMATION_DO_YOU_HAVE_THE_LEGAL_RIGHT_TO_WORK_IN_THE_US_WITHOUT_SPONSORSHIPS, A.$40 EDUCATION_HISTORY_DO_YOU_HAVE_A_HIGH_SCHOOL_DIPLOMA_OR_GED, A.$41 EDUCATION_HISTORY_IF_YES_WHAT_IS_THE_NAME_OF_THE_SCHOOL, A.$42 EMPLOYMENT_HISTORY, A.$43 EMPLOYMENT_HISTORY_EMPLOYER_NAME, A.$44 EMPLOYMENT_HISTORY_EMPLOYER_CITY, A.$45 EMPLOYMENT_HISTORY_EMPLOYER_STATE, A.$46 EMPLOYMENT_HISTORY_EMPLOYER_PHONE_NUMBER, A.$47 EMPLOYMENT_HISTORY_EMPLOYER_EMAIL_ADDRESS, A.$48 EMPLOYMENT_HISTORY_SUPERVISOR_NAME, A.$49 EMPLOYMENT_HISTORY_POSITION, A.$50 EMPLOYMENT_HISTORY_DATE_STARTED, A.$51 EMPLOYMENT_HISTORY_DATE_ENDED, A.$52 EMPLOYMENT_HISTORY_REASON_FOR_LEAVING, A.$53 EMPLOYMENT_HISTORY_2_EMPLOYER_NAME, A.$54 EMPLOYMENT_HISTORY_2_EMPLOYER_CITY, A.$55 EMPLOYMENT_HISTORY_2_EMPLOYER_STATE, A.$56 EMPLOYMENT_HISTORY_2_EMPLOYER_PHONE_NUMBER, A.$57 EMPLOYMENT_HISTORY_2_EMPLOYER_EMAIL_ADDRESS, A.$58 EMPLOYMENT_HISTORY_2_SUPERVISOR_NAME, A.$59 EMPLOYMENT_HISTORY_2_POSITION, A.$60 EMPLOYMENT_HISTORY_2_DATE_STARTED, A.$61 EMPLOYMENT_HISTORY_2_DATE_ENDED, A.$62 EMPLOYMENT_HISTORY_2_REASON_FOR_LEAVING, A.$63 EMPLOYMENT_HISTORY_3_EMPLOYER_NAME, A.$64 EMPLOYMENT_HISTORY_3_EMPLOYER_CITY, A.$65 EMPLOYMENT_HISTORY_3_EMPLOYER_STATE, A.$66 EMPLOYMENT_HISTORY_3_EMPLOYER_PHONE_NUMBER, A.$67 EMPLOYMENT_HISTORY_3_EMPLOYER_EMAIL_ADDRESS, A.$68 EMPLOYMENT_HISTORY_3_SUPERVISOR_NAME, A.$69 EMPLOYMENT_HISTORY_3_POSITION, A.$70 EMPLOYMENT_HISTORY_3_DATE_STARTED, A.$71 EMPLOYMENT_HISTORY_3_DATE_ENDED, A.$72 EMPLOYMENT_HISTORY_3_REASON_FOR_LEAVING, A.$73 EQUAL_EMPLOYMENT_OPPORTUNITY_EEO_VOLUNTARY_SELFIDENTIFICATION, A.$74 EQUAL_EMPLOYMENT_OPPORTUNITY_EQUAL_EMPLOYMENT_OPPORTUNITY, A.$75 EQUAL_EMPLOYMENT_OPPORTUNITY_WHAT_IS_YOUR_PREFERRED_LANGUAGE_FOR_COMMUNICATION, A.$76 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_NAME_OF_REFERENCE_1, A.$77 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_PHONE_NUMBER_1, A.$78 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_RELATIONSHIP_1, A.$79 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_NAME_OF_REFERENCE_2, A.$80 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_PHONE_NUMBER_2, A.$81 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_RELATIONSHIP_2, A.$82 PROOF_OF_RESIDENCY_HAVE_YOU_BEEN_A_RESIDENT_OF_ALABAMA_FOR_2_CONSECUTIVE_YEARS, A.$83 PROOF_OF_RESIDENCY_HAVE_YOU_EVER_RESIDED_OUTSIDE_OF_THE_STATE_OF_ALABAMA, A.$84 ATTESTATION_PLEASE_READ_AND_SIGN_THIS_FORM_IN_THE_SPACE_PROVIDED_BELOW, A.$85 ATTESTATION_PLEASE_CONFIRM_YOU_HAVE_REVIEWED_THE_STATEMENT_ABOVE_AND_AGREE_TO_THE_TERMS, A.$86 FINAL_SUBMISSION, :TASKKEY AS ETL_TASK_KEY, :TASKKEY AS ETL_INSERTED_TASK_KEY, CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_INSERTED_DATE, CURRENT_USER() AS ETL_INSERTED_BY, CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_LAST_UPDATED_DATE, CURRENT_USER() AS ETL_LAST_UPDATED_BY, 0 AS ETL_DELETED_FLAG  FROM @DISC_${var.SF_ENVIRONMENT}.STAGE.AWSAZSTAGEPROD/PARADOX/Upload_file/FormsCandidate.Forms.Detail.Report.Wide.Format.Al.Application (FILE_FORMAT => DISC_${var.SF_ENVIRONMENT}.STAGE.CSV_FORMAT) A);

    --VIEWSQL
    CREATE OR REPLACE TABLE DISC_${var.SF_ENVIRONMENT}.PARADOX.CANDIDATE_FORM_AL AS  SELECT  FORM_NAME FORM_NAME, LOCATION_CODE LOCATION_CODE, LOCATION_NAME LOCATION_NAME, JOB_APPLIED_TO JOB_APPLIED_TO, JOB_REQ_ID JOB_REQ_ID, JOB_TITLE JOB_TITLE, CURRENT_CANDIDATE_JOURNEY_STATUS CURRENT_CANDIDATE_JOURNEY_STATUS, CANDIDATE_ID CANDIDATE_ID, CANDIDATE_NAME CANDIDATE_NAME, FORM_DATE_SENT FORM_DATE_SENT, FORM_EXPIRATION_DATE FORM_EXPIRATION_DATE, FORM_CANCELLATION_DATE FORM_CANCELLATION_DATE, FORM_RESENT_DATE FORM_RESENT_DATE, FORM_RESENT FORM_RESENT, FORM_IN_PROGRESS_DATE FORM_IN_PROGRESS_DATE, FORM_COMPLETION_STATUS FORM_COMPLETION_STATUS, FORM_DATE_SUBMITTED FORM_DATE_SUBMITTED, FORM_PREVIEW_LINK FORM_PREVIEW_LINK, PUBLISHED_DATE PUBLISHED_DATE, PUBLISHED_VERSION PUBLISHED_VERSION, PROFILE_ID PROFILE_ID, MULTIPLE_RECORDS MULTIPLE_RECORDS, PRIMARY_IDENTIFIER PRIMARY_IDENTIFIER, REAPPLY_IN_CAPTURE REAPPLY_IN_CAPTURE, REAPPLY_IN_JOB_SEARCH REAPPLY_IN_JOB_SEARCH, REAPPLY_IN_CAMPAIGN REAPPLY_IN_CAMPAIGN, PERSONAL_INFORMATION_YOUR_FULL_NAME PERSONAL_INFORMATION_YOUR_FULL_NAME, PERSONAL_INFORMATION_PHONE_NUMBER PERSONAL_INFORMATION_PHONE_NUMBER, PERSONAL_INFORMATION_EMAIL_ADDRESS PERSONAL_INFORMATION_EMAIL_ADDRESS, PERSONAL_INFORMATION_STREET_ADDRESS_LINE_1 PERSONAL_INFORMATION_STREET_ADDRESS_LINE_1, PERSONAL_INFORMATION_STREET_ADDRESS_LINE_2 PERSONAL_INFORMATION_STREET_ADDRESS_LINE_2, PERSONAL_INFORMATION_CITY PERSONAL_INFORMATION_CITY, PERSONAL_INFORMATION_STATE PERSONAL_INFORMATION_STATE, PERSONAL_INFORMATION_ZIP_CODE PERSONAL_INFORMATION_ZIP_CODE, PERSONAL_INFORMATION_EMERGENCY_CONTACT_NAME PERSONAL_INFORMATION_EMERGENCY_CONTACT_NAME, PERSONAL_INFORMATION_EMERGENCY_CONTACT_PHONE_NUMBER PERSONAL_INFORMATION_EMERGENCY_CONTACT_PHONE_NUMBER, PERSONAL_INFORMATION_RELATION_TO_CAREGIVER PERSONAL_INFORMATION_RELATION_TO_CAREGIVER, PERSONAL_INFORMATION_HOW_DID_YOU_HEAR_ABOUT_THIS_JOB PERSONAL_INFORMATION_HOW_DID_YOU_HEAR_ABOUT_THIS_JOB, PERSONAL_INFORMATION_IF_OTHER_WHERE PERSONAL_INFORMATION_IF_OTHER_WHERE, PERSONAL_INFORMATION_DO_YOU_HAVE_A_RELATIVE_THAT_WORKS_FOR_HELP_AT_HOME_IF_SO_WHAT_IS_THEIR_NAME PERSONAL_INFORMATION_DO_YOU_HAVE_A_RELATIVE_THAT_WORKS_FOR_HELP_AT_HOME_IF_SO_WHAT_IS_THEIR_NAME, PERSONAL_INFORMATION_AVAILABLE_DAYS PERSONAL_INFORMATION_AVAILABLE_DAYS, PERSONAL_INFORMATION_HAVE_YOU_PREVIOUSLY_WORKED_FOR_HELP_AT_HOME PERSONAL_INFORMATION_HAVE_YOU_PREVIOUSLY_WORKED_FOR_HELP_AT_HOME, PERSONAL_INFORMATION_DO_YOU_HAVE_THE_LEGAL_RIGHT_TO_WORK_IN_THE_US_WITHOUT_SPONSORSHIPS PERSONAL_INFORMATION_DO_YOU_HAVE_THE_LEGAL_RIGHT_TO_WORK_IN_THE_US_WITHOUT_SPONSORSHIPS, EDUCATION_HISTORY_DO_YOU_HAVE_A_HIGH_SCHOOL_DIPLOMA_OR_GED EDUCATION_HISTORY_DO_YOU_HAVE_A_HIGH_SCHOOL_DIPLOMA_OR_GED, EDUCATION_HISTORY_IF_YES_WHAT_IS_THE_NAME_OF_THE_SCHOOL EDUCATION_HISTORY_IF_YES_WHAT_IS_THE_NAME_OF_THE_SCHOOL, EMPLOYMENT_HISTORY EMPLOYMENT_HISTORY, EMPLOYMENT_HISTORY_EMPLOYER_NAME EMPLOYMENT_HISTORY_EMPLOYER_NAME, EMPLOYMENT_HISTORY_EMPLOYER_CITY EMPLOYMENT_HISTORY_EMPLOYER_CITY, EMPLOYMENT_HISTORY_EMPLOYER_STATE EMPLOYMENT_HISTORY_EMPLOYER_STATE, EMPLOYMENT_HISTORY_EMPLOYER_PHONE_NUMBER EMPLOYMENT_HISTORY_EMPLOYER_PHONE_NUMBER, EMPLOYMENT_HISTORY_EMPLOYER_EMAIL_ADDRESS EMPLOYMENT_HISTORY_EMPLOYER_EMAIL_ADDRESS, EMPLOYMENT_HISTORY_SUPERVISOR_NAME EMPLOYMENT_HISTORY_SUPERVISOR_NAME, EMPLOYMENT_HISTORY_POSITION EMPLOYMENT_HISTORY_POSITION, EMPLOYMENT_HISTORY_DATE_STARTED EMPLOYMENT_HISTORY_DATE_STARTED, EMPLOYMENT_HISTORY_DATE_ENDED EMPLOYMENT_HISTORY_DATE_ENDED, EMPLOYMENT_HISTORY_REASON_FOR_LEAVING EMPLOYMENT_HISTORY_REASON_FOR_LEAVING, EMPLOYMENT_HISTORY_2_EMPLOYER_NAME EMPLOYMENT_HISTORY_2_EMPLOYER_NAME, EMPLOYMENT_HISTORY_2_EMPLOYER_CITY EMPLOYMENT_HISTORY_2_EMPLOYER_CITY, EMPLOYMENT_HISTORY_2_EMPLOYER_STATE EMPLOYMENT_HISTORY_2_EMPLOYER_STATE, EMPLOYMENT_HISTORY_2_EMPLOYER_PHONE_NUMBER EMPLOYMENT_HISTORY_2_EMPLOYER_PHONE_NUMBER, EMPLOYMENT_HISTORY_2_EMPLOYER_EMAIL_ADDRESS EMPLOYMENT_HISTORY_2_EMPLOYER_EMAIL_ADDRESS, EMPLOYMENT_HISTORY_2_SUPERVISOR_NAME EMPLOYMENT_HISTORY_2_SUPERVISOR_NAME, EMPLOYMENT_HISTORY_2_POSITION EMPLOYMENT_HISTORY_2_POSITION, EMPLOYMENT_HISTORY_2_DATE_STARTED EMPLOYMENT_HISTORY_2_DATE_STARTED, EMPLOYMENT_HISTORY_2_DATE_ENDED EMPLOYMENT_HISTORY_2_DATE_ENDED, EMPLOYMENT_HISTORY_2_REASON_FOR_LEAVING EMPLOYMENT_HISTORY_2_REASON_FOR_LEAVING, EMPLOYMENT_HISTORY_3_EMPLOYER_NAME EMPLOYMENT_HISTORY_3_EMPLOYER_NAME, EMPLOYMENT_HISTORY_3_EMPLOYER_CITY EMPLOYMENT_HISTORY_3_EMPLOYER_CITY, EMPLOYMENT_HISTORY_3_EMPLOYER_STATE EMPLOYMENT_HISTORY_3_EMPLOYER_STATE, EMPLOYMENT_HISTORY_3_EMPLOYER_PHONE_NUMBER EMPLOYMENT_HISTORY_3_EMPLOYER_PHONE_NUMBER, EMPLOYMENT_HISTORY_3_EMPLOYER_EMAIL_ADDRESS EMPLOYMENT_HISTORY_3_EMPLOYER_EMAIL_ADDRESS, EMPLOYMENT_HISTORY_3_SUPERVISOR_NAME EMPLOYMENT_HISTORY_3_SUPERVISOR_NAME, EMPLOYMENT_HISTORY_3_POSITION EMPLOYMENT_HISTORY_3_POSITION, EMPLOYMENT_HISTORY_3_DATE_STARTED EMPLOYMENT_HISTORY_3_DATE_STARTED, EMPLOYMENT_HISTORY_3_DATE_ENDED EMPLOYMENT_HISTORY_3_DATE_ENDED, EMPLOYMENT_HISTORY_3_REASON_FOR_LEAVING EMPLOYMENT_HISTORY_3_REASON_FOR_LEAVING, EQUAL_EMPLOYMENT_OPPORTUNITY_EEO_VOLUNTARY_SELFIDENTIFICATION EQUAL_EMPLOYMENT_OPPORTUNITY_EEO_VOLUNTARY_SELFIDENTIFICATION, EQUAL_EMPLOYMENT_OPPORTUNITY_EQUAL_EMPLOYMENT_OPPORTUNITY EQUAL_EMPLOYMENT_OPPORTUNITY_EQUAL_EMPLOYMENT_OPPORTUNITY, EQUAL_EMPLOYMENT_OPPORTUNITY_WHAT_IS_YOUR_PREFERRED_LANGUAGE_FOR_COMMUNICATION EQUAL_EMPLOYMENT_OPPORTUNITY_WHAT_IS_YOUR_PREFERRED_LANGUAGE_FOR_COMMUNICATION, ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_NAME_OF_REFERENCE_1 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_NAME_OF_REFERENCE_1, ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_PHONE_NUMBER_1 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_PHONE_NUMBER_1, ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_RELATIONSHIP_1 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_RELATIONSHIP_1, ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_NAME_OF_REFERENCE_2 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_NAME_OF_REFERENCE_2, ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_PHONE_NUMBER_2 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_PHONE_NUMBER_2, ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_RELATIONSHIP_2 ONBOARDINGBACKGROUND_CHECK_REQUIREMENTS_RELATIONSHIP_2, PROOF_OF_RESIDENCY_HAVE_YOU_BEEN_A_RESIDENT_OF_ALABAMA_FOR_2_CONSECUTIVE_YEARS PROOF_OF_RESIDENCY_HAVE_YOU_BEEN_A_RESIDENT_OF_ALABAMA_FOR_2_CONSECUTIVE_YEARS, PROOF_OF_RESIDENCY_HAVE_YOU_EVER_RESIDED_OUTSIDE_OF_THE_STATE_OF_ALABAMA PROOF_OF_RESIDENCY_HAVE_YOU_EVER_RESIDED_OUTSIDE_OF_THE_STATE_OF_ALABAMA, ATTESTATION_PLEASE_READ_AND_SIGN_THIS_FORM_IN_THE_SPACE_PROVIDED_BELOW ATTESTATION_PLEASE_READ_AND_SIGN_THIS_FORM_IN_THE_SPACE_PROVIDED_BELOW, ATTESTATION_PLEASE_CONFIRM_YOU_HAVE_REVIEWED_THE_STATEMENT_ABOVE_AND_AGREE_TO_THE_TERMS ATTESTATION_PLEASE_CONFIRM_YOU_HAVE_REVIEWED_THE_STATEMENT_ABOVE_AND_AGREE_TO_THE_TERMS, FINAL_SUBMISSION FINAL_SUBMISSION, :TASKKEY AS ETL_TASK_KEY, :TASKKEY AS ETL_INSERTED_TASK_KEY, CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_INSERTED_DATE, CURRENT_USER() AS ETL_INSERTED_BY, CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_LAST_UPDATED_DATE, CURRENT_USER() AS ETL_LAST_UPDATED_BY, 0 AS ETL_DELETED_FLAG  FROM DISC_${var.SF_ENVIRONMENT}.PARADOX.HIST_CANDIDATE_FORM_AL WHERE ETL_LAST_UPDATED_DATE = (SELECT MAX(ETL_LAST_UPDATED_DATE) FROM DISC_${var.SF_ENVIRONMENT}.PARADOX.HIST_CANDIDATE_FORM_AL); 

    RETURN ''SUCCESS'';
END;


 EOT
}

