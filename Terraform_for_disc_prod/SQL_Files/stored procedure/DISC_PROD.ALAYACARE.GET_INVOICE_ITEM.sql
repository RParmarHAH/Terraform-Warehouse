CREATE OR REPLACE PROCEDURE DISC_PROD.ALAYACARE.GET_INVOICE_ITEM()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE
--*****************************************************************************************************************************
-- NAME:  GET_INVOICE_ITEM 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE        		AUTHOR                	NOTES:
-- ----------  		-------------------   	-----------------------------------------------------------------------------------------------
-- 2021-11-11		UNKNOWN					INITIAL DEVELOPMENT
-- 2023-09-05  		RAVI SUTHAR            	MIGRATED JavaScript to SQL
--*****************************************************************************************************************************
    return_result varchar(1000);
BEGIN
	
    INSERT OVERWRITE INTO ALAYACARE.INVOICE_ITEM (
        INVOICE_ITEM_ID, INVOICE_ID, ITEM_GUID_TO, VISIT_ID, PREMIUM_ID, CLIENT_ID, SERVICE_ID, FACILITY_ID, FUNDER_ID, ITEM_BILLITEM_ID, BILLITEM_ID_PREMIUM, CREATED_AT, UPDATED_AT, CREATED_BY, UPDATED_BY, 
		PROPERTIES_TBL_ACC_INVOICE_ITEM_OP, PROPERTIES_TBL_ACC_INVOICE_ITEM_ADJUSTMENT_TYPE, PROPERTIES_TBL_ACC_INVOICE_ITEM_BILLABLE_ITEM_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM_CREATE_TIME, PROPERTIES_TBL_ACC_INVOICE_ITEM_CREATE_USER_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM_GL_ASSET_ACC_ACCOUNT_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM_GL_REVENUE_ACC_ACCOUNT_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM_IDDEPTCODE, PROPERTIES_TBL_ACC_INVOICE_ITEM_IDINVOICE, PROPERTIES_TBL_ACC_INVOICE_ITEM_ITEM_END_AT, PROPERTIES_TBL_ACC_INVOICE_ITEM_ITEM_START_AT, PROPERTIES_TBL_ACC_INVOICE_ITEM_ORIGIN_GUID, PROPERTIES_TBL_ACC_INVOICE_ITEM_QUANTITY, PROPERTIES_TBL_ACC_INVOICE_ITEM_QUANTITY_UNITS, PROPERTIES_TBL_ACC_INVOICE_ITEM_SUBTOTAL, PROPERTIES_TBL_ACC_INVOICE_ITEM_TAXABLE, PROPERTIES_TBL_ACC_INVOICE_ITEM_TOTAL, PROPERTIES_TBL_ACC_INVOICE_ITEM_TYPE, PROPERTIES_TBL_ACC_INVOICE_ITEM_UNITPRICE, PROPERTIES_TBL_ACC_INVOICE_ITEM_UPDATE_TIME, PROPERTIES_TBL_ACC_INVOICE_ITEM_UPDATE_USER_ID, 
		PROPERTIES_TBL_ACC_INVOICE_ITEM_FROZEN, 
		PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN_OP, PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN_ID, PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN_SHIFT_ENCODED, 
		TAX_NAME_1, TAX_AMOUNT_1, TAX_NAME_2, TAX_AMOUNT_2, TAX_NAME_3, TAX_AMOUNT_3, PAYOR_PROGRAM_NAME, PAYOR_PROGRAM_FUNDER_ID, PAYOR_PROGRAM_BILLING_CONTACT_ID, MASTER_INVOICE_ID, MASTER_INVOICE_STATUS, INVOICE_NUMBER_VERSION, INVOICE_REGENERATED, INVOICE_AGING_RANGE, DATEDIFF_RANGE, INVOICE_AMOUNT, INVOICE_ITEM_AMOUNT, TOTAL_CREDIT_AMOUNT, TOTAL_PAYMENT_AMOUNT, PAYMENT_AMOUNT_TMP, PAYMENT_DATE, PAYMENT_CREATION_DATE, CREDIT_AMOUNT_TMP, PAYMENT_TYPE, CREDIT_TYPE, PAYMENT_AMOUNT, CREDIT_AMOUNT, INVOICE_ITEM_BALANCE, INVOICE_ITEM_QTY, PAYAMOUNT, MARGIN, INVOICE_LAST_PAYMENT_DATE, INVOICE_LAST_CREATION_PAYMENT_DATE)
        SELECT INVOICE_ITEM_ID AS INVOICE_ITEM_ID, INVOICE_ID AS INVOICE_ID, ITEM_GUID_TO AS ITEM_GUID_TO, VISIT_ID AS VISIT_ID, PREMIUM_ID AS PREMIUM_ID, CLIENT_ID AS CLIENT_ID, SERVICE_ID AS SERVICE_ID, FACILITY_ID AS FACILITY_ID, FUNDER_ID AS FUNDER_ID, ITEM_BILLITEM_ID AS ITEM_BILLITEM_ID, BILLITEM_ID_PREMIUM AS BILLITEM_ID_PREMIUM, CREATED_AT AS CREATED_AT, UPDATED_AT AS UPDATED_AT, CREATED_BY AS CREATED_BY, UPDATED_BY AS UPDATED_BY, 
			PROPERTIES_TBL_ACC_INVOICE_ITEM:Op::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_OP, PROPERTIES_TBL_ACC_INVOICE_ITEM:adjustment_type::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_ADJUSTMENT_TYPE, PROPERTIES_TBL_ACC_INVOICE_ITEM:billable_item_id::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_BILLABLE_ITEM_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM:create_time::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_CREATE_TIME, PROPERTIES_TBL_ACC_INVOICE_ITEM:create_user_id::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_CREATE_USER_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM:gl_asset_acc_account_id::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_GL_ASSET_ACC_ACCOUNT_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM:gl_revenue_acc_account_id::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_GL_REVENUE_ACC_ACCOUNT_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM:id::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_ID, PROPERTIES_TBL_ACC_INVOICE_ITEM:iddeptcode::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_IDDEPTCODE, PROPERTIES_TBL_ACC_INVOICE_ITEM:idinvoice::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_IDINVOICE, PROPERTIES_TBL_ACC_INVOICE_ITEM:item_end_at::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_ITEM_END_AT, PROPERTIES_TBL_ACC_INVOICE_ITEM:item_start_at::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_ITEM_START_AT, PROPERTIES_TBL_ACC_INVOICE_ITEM:origin_guid::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_ORIGIN_GUID, PROPERTIES_TBL_ACC_INVOICE_ITEM:quantity::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_QUANTITY, PROPERTIES_TBL_ACC_INVOICE_ITEM:quantity_units::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_QUANTITY_UNITS, PROPERTIES_TBL_ACC_INVOICE_ITEM:subtotal::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_SUBTOTAL, PROPERTIES_TBL_ACC_INVOICE_ITEM:taxable::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_TAXABLE, PROPERTIES_TBL_ACC_INVOICE_ITEM:total::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_TOTAL, PROPERTIES_TBL_ACC_INVOICE_ITEM:type::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_TYPE, PROPERTIES_TBL_ACC_INVOICE_ITEM:unitprice::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_UNITPRICE, PROPERTIES_TBL_ACC_INVOICE_ITEM:update_time::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_UPDATE_TIME, PROPERTIES_TBL_ACC_INVOICE_ITEM:update_user_id::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_UPDATE_USER_ID, 
			PROPERTIES_TBL_ACC_INVOICE_ITEM:frozen::STRING AS PROPERTIES_TBL_ACC_INVOICE_ITEM_FROZEN, 
			PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN:Op::STRING AS PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN_OP, PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN:id::STRING AS PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN_ID, PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN:shift_encoded::STRING AS PROPERTIES_TBL_BILLABLE_ITEMS_FROZEN_SHIFT_ENCODED, 
			TAX_NAME_1 AS TAX_NAME_1, TAX_AMOUNT_1 AS TAX_AMOUNT_1, TAX_NAME_2 AS TAX_NAME_2, TAX_AMOUNT_2 AS TAX_AMOUNT_2, TAX_NAME_3 AS TAX_NAME_3, TAX_AMOUNT_3 AS TAX_AMOUNT_3, PAYOR_PROGRAM_NAME AS PAYOR_PROGRAM_NAME, PAYOR_PROGRAM_FUNDER_ID AS PAYOR_PROGRAM_FUNDER_ID, PAYOR_PROGRAM_BILLING_CONTACT_ID AS PAYOR_PROGRAM_BILLING_CONTACT_ID, MASTER_INVOICE_ID AS MASTER_INVOICE_ID, MASTER_INVOICE_STATUS AS MASTER_INVOICE_STATUS, INVOICE_NUMBER_VERSION AS INVOICE_NUMBER_VERSION, INVOICE_REGENERATED AS INVOICE_REGENERATED, INVOICE_AGING_RANGE AS INVOICE_AGING_RANGE, DATEDIFF_RANGE AS DATEDIFF_RANGE, INVOICE_AMOUNT AS INVOICE_AMOUNT, INVOICE_ITEM_AMOUNT AS INVOICE_ITEM_AMOUNT, TOTAL_CREDIT_AMOUNT AS TOTAL_CREDIT_AMOUNT, TOTAL_PAYMENT_AMOUNT AS TOTAL_PAYMENT_AMOUNT, PAYMENT_AMOUNT_TMP AS PAYMENT_AMOUNT_TMP, PAYMENT_DATE AS PAYMENT_DATE, PAYMENT_CREATION_DATE AS PAYMENT_CREATION_DATE, CREDIT_AMOUNT_TMP AS CREDIT_AMOUNT_TMP, PAYMENT_TYPE AS PAYMENT_TYPE, CREDIT_TYPE AS CREDIT_TYPE, PAYMENT_AMOUNT AS PAYMENT_AMOUNT, CREDIT_AMOUNT AS CREDIT_AMOUNT, INVOICE_ITEM_BALANCE AS INVOICE_ITEM_BALANCE, INVOICE_ITEM_QTY AS INVOICE_ITEM_QTY, PAYAMOUNT AS PAYAMOUNT, MARGIN AS MARGIN, INVOICE_LAST_PAYMENT_DATE AS INVOICE_LAST_PAYMENT_DATE, INVOICE_LAST_CREATION_PAYMENT_DATE AS INVOICE_LAST_CREATION_PAYMENT_DATE 
        FROM ALAYACARE_PRODUCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_INVOICE_ITEM;

	SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	return return_result;
END;
';