CREATE OR REPLACE PROCEDURE DISC_PROD.PUBLIC.GET_MASTER_FACT_WAREHOUSE_CREDIT_METRICS()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS CALLER
AS '
DECLARE
  RETURN_RESULT VARCHAR(1000);
BEGIN
  INSERT INTO DISC_PROD.PUBLIC.FACT_WAREHOUSE_CREDIT_METRICS
  SELECT 
    WAREHOUSE_NAME, 
    current_date() as CREDIT_DATE, 
    sum(CREDITS_USED) TOTAL_CREDITS_USED, 
    sum(CREDITS_USED_COMPUTE) TOTAL_CREDITS_USED_COMPUTE, 
    sum(CREDITS_USED_CLOUD_SERVICES) TOTAL_CREDITS_USED_CLOUD_SERVICES
  from table(information_schema.WAREHOUSE_METERING_HISTORY(current_date(),current_date()))
  group by WAREHOUSE_NAME;
SELECT CONCAT (''MESSAGE : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	RETURN return_result;
    END;
    ';