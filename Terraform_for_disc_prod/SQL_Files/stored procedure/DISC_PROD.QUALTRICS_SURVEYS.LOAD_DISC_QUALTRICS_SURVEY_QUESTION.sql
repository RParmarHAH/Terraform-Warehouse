CREATE OR REPLACE PROCEDURE DISC_PROD.QUALTRICS_SURVEYS.LOAD_DISC_QUALTRICS_SURVEY_QUESTION("SURVEY_ID" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE
	SQL VARCHAR;
BEGIN
	DELETE FROM DISC_PROD.QUALTRICS_SURVEYS.QUALTRICS_SURVEY_QUESTION WHERE SURVEY_ID=:SURVEY_ID;
	SELECT ''INSERT INTO DISC_PROD.QUALTRICS_SURVEYS.QUALTRICS_SURVEY_QUESTION SELECT ''''''||SURVEY_ID||'''''',''''''||SURVEY_NAME||'''''',CURRENT_TIMESTAMP(),A.$1 FROM @DISC_PROD.STAGE.AWSAZSTAGEPROD/Qualtrics_Surveys/''||SURVEY_ID||''/(file_format => DISC_PROD.STAGE.MY_JSON_FORMAT,pattern =>''''.*''||SURVEY_ID||''_Questions.*.'''') A;''
	INTO :SQL
	FROM DW_PROD.HAH.DIM_SURVEY 
	WHERE SURVEY_ID=:SURVEY_ID;

	EXECUTE IMMEDIATE SQL;

	INSERT INTO DISC_PROD.QUALTRICS_SURVEYS.HIST_QUALTRICS_SURVEY_QUESTION(SURVEY_ID,SURVEY_NAME,LOAD_TIME,SURVEY_QUESTION_JSON) SELECT SURVEY_ID, SURVEY_NAME, LOAD_TIME, SURVEY_QUESTION_JSON FROM DISC_PROD.QUALTRICS_SURVEYS.QUALTRICS_SURVEY_QUESTION WHERE SURVEY_ID=:SURVEY_ID;

return ''Succeeded.'';
END;
';