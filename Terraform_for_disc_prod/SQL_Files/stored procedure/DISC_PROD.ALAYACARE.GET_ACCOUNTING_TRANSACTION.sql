CREATE OR REPLACE PROCEDURE DISC_PROD.ALAYACARE.GET_ACCOUNTING_TRANSACTION()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
DECLARE
--*****************************************************************************************************************************
-- NAME:  GET_ACCOUNTING_TRANSACTION 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE        		AUTHOR                	NOTES:
-- ----------  		-------------------   	-----------------------------------------------------------------------------------------------
-- 2021-11-11		UNKNOWN					INITIAL DEVELOPMENT
-- 2023-09-05  		RAVI SUTHAR            	MIGRATED JavaScript to SQL
--*****************************************************************************************************************************
    return_result varchar(1000);
BEGIN
	
    INSERT OVERWRITE INTO ALAYACARE.ACCOUNTING_TRANSACTION (
        ID, MAIN_TRANSACTION_ID, ALLOCATION_ID, MAIN_TRANSACTION_INVOICE_ID, MAIN_TRANSACTION_INVOICE_ITEM_ID, MAIN_TRANSACTION_AMOUNT, MAIN_TRANSACTION_BALANCE, MAIN_TRANSACTION_CLIENT_ID, MAIN_TRANSACTION_FUNDER_ID, MAIN_TRANSACTION_POSTING_DATE, CREATION_DATE_TRANSACTION, EMPLOYEE_CREATE_TRANSACTION_ID, UPDATION_DATE_TRANSACTION, EMPLOYEE_UPDATE_TRANSACTION_ID, MAIN_TRANSACTION_MEMO, MAIN_TRANSACTION_NAME, MAIN_TRANSACTION_TYPE, MAIN_TRANSACTION_CONFIG_DESCRIPTION, MAIN_PAYMENT_TYPE, MAIN_PAYMENT_NAME, ALLOC_TRANS_AMOUNT, ALLOC_TRANS_INVOICE_ID, ALLOC_TRANS_INVOICE_ITEM_ID, ALLOC_TRANSACTION_POSTING_DATE, ALLOC_TRANS_CREATED_AT, ITEM_TRANS_LATEST_POSTING_DATE, ITEM_TRANS_LATEST_CREATE_DATE, INVOICE_TRANS_LATEST_POSTING_DATE, INVOICE_TRANS_LATEST_CREATE_DATE, ALLOCATED_AMOUNT, ALLOCATED_TRANS_BALANCE, ALLOCATED_TRANS_NAME, ALLOCATED_TRANS_TYPE, PAYMENT_AMOUNT, CREDIT_AMOUNT, ALLOCATED_TRANS_DESC, ALLOC_PAYMENT_NAME, ALLOC_PAYMENT_TYPE, BRANCH_ID)
        SELECT ID AS ID, MAIN_TRANSACTION_ID AS MAIN_TRANSACTION_ID, ALLOCATION_ID AS ALLOCATION_ID, MAIN_TRANSACTION_INVOICE_ID AS MAIN_TRANSACTION_INVOICE_ID, MAIN_TRANSACTION_INVOICE_ITEM_ID AS MAIN_TRANSACTION_INVOICE_ITEM_ID, MAIN_TRANSACTION_AMOUNT AS MAIN_TRANSACTION_AMOUNT, MAIN_TRANSACTION_BALANCE AS MAIN_TRANSACTION_BALANCE, MAIN_TRANSACTION_CLIENT_ID AS MAIN_TRANSACTION_CLIENT_ID, MAIN_TRANSACTION_FUNDER_ID AS MAIN_TRANSACTION_FUNDER_ID, MAIN_TRANSACTION_POSTING_DATE AS MAIN_TRANSACTION_POSTING_DATE, CREATION_DATE_TRANSACTION AS CREATION_DATE_TRANSACTION, EMPLOYEE_CREATE_TRANSACTION_ID AS EMPLOYEE_CREATE_TRANSACTION_ID, UPDATION_DATE_TRANSACTION AS UPDATION_DATE_TRANSACTION, EMPLOYEE_UPDATE_TRANSACTION_ID AS EMPLOYEE_UPDATE_TRANSACTION_ID, LEFT(MAIN_TRANSACTION_MEMO,250) AS MAIN_TRANSACTION_MEMO, MAIN_TRANSACTION_NAME AS MAIN_TRANSACTION_NAME, MAIN_TRANSACTION_TYPE AS MAIN_TRANSACTION_TYPE, MAIN_TRANSACTION_CONFIG_DESCRIPTION AS MAIN_TRANSACTION_CONFIG_DESCRIPTION, MAIN_PAYMENT_TYPE AS MAIN_PAYMENT_TYPE, MAIN_PAYMENT_NAME AS MAIN_PAYMENT_NAME, ALLOC_TRANS_AMOUNT AS ALLOC_TRANS_AMOUNT, ALLOC_TRANS_INVOICE_ID AS ALLOC_TRANS_INVOICE_ID, ALLOC_TRANS_INVOICE_ITEM_ID AS ALLOC_TRANS_INVOICE_ITEM_ID, ALLOC_TRANSACTION_POSTING_DATE AS ALLOC_TRANSACTION_POSTING_DATE, ALLOC_TRANS_CREATED_AT AS ALLOC_TRANS_CREATED_AT, ITEM_TRANS_LATEST_POSTING_DATE AS ITEM_TRANS_LATEST_POSTING_DATE, ITEM_TRANS_LATEST_CREATE_DATE AS ITEM_TRANS_LATEST_CREATE_DATE, INVOICE_TRANS_LATEST_POSTING_DATE AS INVOICE_TRANS_LATEST_POSTING_DATE, INVOICE_TRANS_LATEST_CREATE_DATE AS INVOICE_TRANS_LATEST_CREATE_DATE, ALLOCATED_AMOUNT AS ALLOCATED_AMOUNT, ALLOCATED_TRANS_BALANCE AS ALLOCATED_TRANS_BALANCE, ALLOCATED_TRANS_NAME AS ALLOCATED_TRANS_NAME, ALLOCATED_TRANS_TYPE AS ALLOCATED_TRANS_TYPE, PAYMENT_AMOUNT AS PAYMENT_AMOUNT, CREDIT_AMOUNT AS CREDIT_AMOUNT, ALLOCATED_TRANS_DESC AS ALLOCATED_TRANS_DESC, ALLOC_PAYMENT_NAME AS ALLOC_PAYMENT_NAME, ALLOC_PAYMENT_TYPE AS ALLOC_PAYMENT_TYPE, BRANCH_ID AS BRANCH_ID 
        FROM ALAYACARE_PRODUCTION."5C3EE5FE-45A5-4DA7-A35B-BD7CDAFE3548".SHARED_ACCOUNTING_TRANSACTION;

	SELECT CONCAT(''Message : '',"number of rows inserted",'' Rows Inserted.'') into :return_result FROM TABLE(RESULT_SCAN(LAST_QUERY_ID()));
	return return_result;
END;
';