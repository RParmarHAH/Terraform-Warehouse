CREATE OR REPLACE PROCEDURE DISC_PROD.COSTALSYNCDATA.GET_PAYCODE_CATEGORY()
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
begin
INSERT INTO COSTALSYNCDATA.PAYCODE_CATEGORY 
(DB,PAY_CODE,DESCRIPTION,PAY_TYPE,ETL_TASK_KEY,ETL_INSERTED_TASK_KEY,ETL_INSERTED_DATE,ETL_INSERTED_BY,ETL_LAST_UPDATED_DATE,ETL_LAST_UPDATED_BY) 
SELECT  SRC.DB  ,SRC.PAY_CODE ,SRC.DESCRIPTION  ,SRC.PAY_TYPE  ,-1 AS ETL_TASK_KEY ,-1 AS ETL_INSERTED_TASK_KEY ,
current_timestamp::TIMESTAMP_NTZ(9) AS ETL_INSERTED_DATE ,current_user() AS ETL_INSERTED_BY ,current_timestamp::TIMESTAMP_NTZ(9) AS ETL_LAST_UPDATED_DATE ,
current_user() AS ETL_LAST_UPDATED_BY FROM COSTALSYNCDATA.GPALLPAYCODESBASE src   
LEFT JOIN COSTALSYNCDATA.PAYCODE_CATEGORY des ON src.DB = des.DB AND src.PAY_CODE  = des.PAY_CODE WHERE des.PAY_CODE IS NULL;
UPDATE COSTALSYNCDATA.PAYCODE_CATEGORY 
SET PAY_CODE_CATEGORY =  CASE  WHEN (UPPER(TRIM(DESCRIPTION)) LIKE ''%HOURLY%'' OR UPPER(TRIM(DESCRIPTION)) LIKE ''%VISITS%'' OR UPPER(TRIM(PAY_CODE))=''DHL'' )  
AND  UPPER(TRIM(DESCRIPTION)) NOT LIKE ''%SUPERVISORY%''  AND  UPPER(TRIM(DESCRIPTION)) NOT LIKE ''%OT%''  THEN ''SERVICE_CODE''
WHEN (UPPER(TRIM(DESCRIPTION)) LIKE ''%OT%'' OR UPPER(TRIM(DESCRIPTION)) LIKE ''%OVERTIME%'') AND UPPER(TRIM(DESCRIPTION)) NOT LIKE ''%ADM%'' THEN ''OVERTIME'' 
WHEN UPPER(TRIM(Description)) LIKE ''%REIMBURSEMENT%'' THEN ''REIMBURSEMENT'' ELSE ''NON-SERVICE'' END  WHERE PAY_CODE_CATEGORY IS NULL;
end;
';