CREATE OR REPLACE PROCEDURE DISC_PROD.PARADOX.GET_CANDIDATE_FORM_OH("TASKKEY" VARCHAR(16777216))
RETURNS VARCHAR(16777216)
LANGUAGE SQL
EXECUTE AS OWNER
AS '
--*****************************************************************************************************************************
-- NAME:  GET_CANDIDATE_FORM_OH 
--
-- PURPOSE: USING THIS SP FOR DISCOVERY TABLE LOAD
--
-- DEVELOPMENT LOG:
-- DATE				AUTHOR										NOTES:
-- ----------		-------------------							-----------------------------------------------------------------------------------------------
-- 2023-11-20		KOMAL DHOKAI/RAVI SUTHAR					INITIAL DEVELOPMENT
--*****************************************************************************************************************************


BEGIN 
    --TARGETSQL
    COPY INTO DISC_PROD.PARADOX.HIST_CANDIDATE_FORM_OH FROM (SELECT DISTINCT A.$1 FORM_NAME,  A.$2 LOCATION_CODE,  A.$3 LOCATION_NAME,  A.$4 JOB_APPLIED_TO,  A.$5 JOB_REQ_ID,  A.$6 JOB_TITLE,  A.$7 CURRENT_CANDIDATE_JOURNEY_STATUS,  A.$8 CANDIDATE_ID,  A.$9 CANDIDATE_NAME,  A.$10 FORM_DATE_SENT,  A.$11 FORM_IN_PROGRESS_DATE,  A.$12 FORM_COMPLETION_STATUS,  A.$13 FORM_DATE_SUBMITTED,  A.$14 FORM_PREVIEW_LINK,  A.$15 PUBLISHED_DATE,  A.$16 PUBLISHED_VERSION,  A.$17 PROFILE_ID,  A.$18 MULTIPLE_RECORDS,  A.$19 PRIMARY_IDENTIFIER,  A.$20 REAPPLY_IN_CAPTURE,  A.$21 REAPPLY_IN_JOB_SEARCH,  A.$22 REAPPLY_IN_CAMPAIGN,  A.$23 PERSONAL_INFORMATION_YOUR_FULL_NAME,  A.$24 PERSONAL_INFORMATION_PHONE_NUMBER,  A.$25 PERSONAL_INFORMATION_EMAIL_ADDRESS,  TRIM(PARSE_JSON( A.$26):"ADDRESS", ''"'') AS PERSONAL_INFORMATION_STREET_ADDRESS_LINE_1,  TRIM(PARSE_JSON( A.$26):"ADDRESS_2", ''"'') AS PERSONAL_INFORMATION_STREET_ADDRESS_LINE_2,  TRIM(PARSE_JSON( A.$26):"CITY", ''"'') AS PERSONAL_INFORMATION_CITY,  TRIM(PARSE_JSON( A.$26):"STATE", ''"'') AS PERSONAL_INFORMATION_STATE,  TRIM(PARSE_JSON( A.$26):"ZIP_CODE", ''"'') AS PERSONAL_INFORMATION_ZIP_CODE,   A.$27 PERSONAL_INFORMATION_EMERGENCY_CONTACT_NAME,  A.$28 PERSONAL_INFORMATION_EMERGENCY_CONTACT_CELL_PHONE_NUMBER,  A.$39 PERSONAL_INFORMATION_EMERGENCY_CONTACT_HOME_PHONE_NUMBER,  A.$30 PERSONAL_INFORMATION_RELATION_TO_CAREGIVER,  A.$31 PERSONAL_INFORMATION_HOW_DID_YOU_HEAR_ABOUT_THIS_JOB,  A.$32 PERSONAL_INFORMATION_IF_OTHER_WHERE,  A.$33 PERSONAL_INFORMATION_DO_YOU_HAVE_A_RELATIVE_THAT_WORKS_FOR_HELP_AT_HOME_IF_SO_WHAT_IS_THEIR_NAME,  A.$34 PERSONAL_INFORMATION_AVAILABLE_DAYS,  A.$35 PERSONAL_INFORMATION_HAVE_YOU_PREVIOUSLY_WORKED_FOR_HELP_AT_HOME,  A.$36 PERSONAL_INFORMATION_DO_YOU_HAVE_THE_LEGAL_RIGHT_TO_WORK_IN_THE_US_WITHOUT_SPONSORSHIPS,  A.$37 PERSONAL_INFORMATION_DO_YOU_HAVE_A_COPY_OF_A_TB_TEST_COMPLETED_LESS_THAN_12_MONTHS_AGO,  A.$38 EDUCATION_HISTORY_DO_YOU_HAVE_A_HIGH_SCHOOL_DIPLOMA_OR_GED,  A.$39 EDUCATION_HISTORY_IF_YES_WHAT_IS_THE_NAME_OF_THE_SCHOOL,  A.$40 EMPLOYMENT_HISTORY_1__EMPLOYER_NAME,  A.$41 EMPLOYMENT_HISTORY_2__EMPLOYER_NAME,  A.$42 EMPLOYMENT_HISTORY_3__EMPLOYER_NAME,  A.$43 EMPLOYMENT_HISTORY_1__EMPLOYER_CITY,  A.$44 EMPLOYMENT_HISTORY_2__EMPLOYER_CITY,  A.$45 EMPLOYMENT_HISTORY_3__EMPLOYER_CITY,  A.$46 EMPLOYMENT_HISTORY_1__EMPLOYER_STATE,  A.$47 EMPLOYMENT_HISTORY_2__EMPLOYER_STATE,  A.$48 EMPLOYMENT_HISTORY_3__EMPLOYER_STATE,  A.$49 EMPLOYMENT_HISTORY_1__EMPLOYER_PHONE_NUMBER,  A.$50 EMPLOYMENT_HISTORY_2__EMPLOYER_PHONE_NUMBER,  A.$51 EMPLOYMENT_HISTORY_3__EMPLOYER_PHONE_NUMBER,  A.$52 EMPLOYMENT_HISTORY_1__SUPERVISOR_NAME,  A.$53 EMPLOYMENT_HISTORY_2__SUPERVISOR_NAME,  A.$54 EMPLOYMENT_HISTORY_3__SUPERVISOR_NAME,  A.$55 EMPLOYMENT_HISTORY_1__POSITION,  A.$56 EMPLOYMENT_HISTORY_2__POSITION,  A.$57 EMPLOYMENT_HISTORY_3__POSITION,  A.$58 EMPLOYMENT_HISTORY_1__DATE_STARTED,  A.$59 EMPLOYMENT_HISTORY_2__DATE_STARTED,  A.$60 EMPLOYMENT_HISTORY_3__DATE_STARTED,  A.$61 EMPLOYMENT_HISTORY_1__DATE_ENDED,  A.$62 EMPLOYMENT_HISTORY_2__DATE_ENDED,  A.$63 EMPLOYMENT_HISTORY_3__DATE_ENDED,  A.$64 EMPLOYMENT_HISTORY_1__REASON_FOR_LEAVING,  A.$65 EMPLOYMENT_HISTORY_2__REASON_FOR_LEAVING,  A.$66 EMPLOYMENT_HISTORY_3__REASON_FOR_LEAVING,  A.$67 REFERENCES_REFERENCES,  A.$68 REFERENCES_NAME_OF_REFERENCE_1,  A.$69 REFERENCES_PHONE_NUMBER_1,  A.$70 REFERENCES_RELATIONSHIP_1,  A.$71 REFERENCES_NAME_OF_REFERENCE_2,  A.$72 REFERENCES_REFERENCE_2_PHONE_NUMBER,  A.$73 REFERENCES_REFERENCE_2_RELATIONSHIP,  A.$74 EQUAL_EMPLOYMENT_OPPORTUNITY_EEO_VOLUNTARY_SELFIDENTIFICATION,  A.$75 EQUAL_EMPLOYMENT_OPPORTUNITY_EQUAL_EMPLOYMENT_OPPORTUNITY,  A.$76 EQUAL_EMPLOYMENT_OPPORTUNITY_WHAT_IS_YOUR_PREFERRED_LANGUAGE_FOR_COMMUNICATION,  A.$77 PROOF_OF_RESIDENCY_HAVE_YOU_BEEN_A_RESIDENT_OF_OHIO_FOR_5_CONSECUTIVE_YEARS,  A.$78 ATTESTATION_PLEASE_READ_AND_SIGN_THIS_FORM_IN_THE_SPACE_PROVIDED_BELOW,  A.$79 ATTESTATION_PLEASE_CONFIRM_YOU_HAVE_REVIEWED_THE_STATEMENT_ABOVE_AND_AGREE_TO_THE_TERMS,  A.$80 BACKGROUND_CHECK_CONSENT_FORM_BACKGROUND_CHECK_CONSENT_FORM,  A.$81 FINAL_SUBMISSION,  :TASKKEY AS ETL_TASK_KEY,  :TASKKEY AS ETL_INSERTED_TASK_KEY,  CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_INSERTED_DATE,  CURRENT_USER() AS ETL_INSERTED_BY,  CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_LAST_UPDATED_DATE,  CURRENT_USER() AS ETL_LAST_UPDATED_BY,  0 AS ETL_DELETED_FLAG FROM @DISC_PROD.STAGE.AWSAZSTAGEPROD/PARADOX/Upload_file/FormsCandidate.Forms.Detail.Report.Wide.Format..Oh.Application (FILE_FORMAT => DISC_PROD.STAGE.CSV_FORMAT) A);

    --VIEWSQL
    CREATE OR REPLACE TABLE DISC_PROD.PARADOX.CANDIDATE_FORM_OH AS  SELECT FORM_NAME FORM_NAME, LOCATION_CODE LOCATION_CODE, LOCATION_NAME LOCATION_NAME, JOB_APPLIED_TO JOB_APPLIED_TO, JOB_REQ_ID JOB_REQ_ID, JOB_TITLE JOB_TITLE, CURRENT_CANDIDATE_JOURNEY_STATUS CURRENT_CANDIDATE_JOURNEY_STATUS, CANDIDATE_ID CANDIDATE_ID, CANDIDATE_NAME CANDIDATE_NAME, FORM_DATE_SENT FORM_DATE_SENT, FORM_IN_PROGRESS_DATE FORM_IN_PROGRESS_DATE, FORM_COMPLETION_STATUS FORM_COMPLETION_STATUS, FORM_DATE_SUBMITTED FORM_DATE_SUBMITTED, FORM_PREVIEW_LINK FORM_PREVIEW_LINK, PUBLISHED_DATE PUBLISHED_DATE, PUBLISHED_VERSION PUBLISHED_VERSION, PROFILE_ID PROFILE_ID, MULTIPLE_RECORDS MULTIPLE_RECORDS, PRIMARY_IDENTIFIER PRIMARY_IDENTIFIER, REAPPLY_IN_CAPTURE REAPPLY_IN_CAPTURE, REAPPLY_IN_JOB_SEARCH REAPPLY_IN_JOB_SEARCH, REAPPLY_IN_CAMPAIGN REAPPLY_IN_CAMPAIGN, PERSONAL_INFORMATION_YOUR_FULL_NAME PERSONAL_INFORMATION_YOUR_FULL_NAME, PERSONAL_INFORMATION_PHONE_NUMBER PERSONAL_INFORMATION_PHONE_NUMBER, PERSONAL_INFORMATION_EMAIL_ADDRESS PERSONAL_INFORMATION_EMAIL_ADDRESS, PERSONAL_INFORMATION_STREET_ADDRESS_LINE_1 PERSONAL_INFORMATION_STREET_ADDRESS_LINE_1, PERSONAL_INFORMATION_STREET_ADDRESS_LINE_2 PERSONAL_INFORMATION_STREET_ADDRESS_LINE_2, PERSONAL_INFORMATION_CITY PERSONAL_INFORMATION_CITY, PERSONAL_INFORMATION_STATE PERSONAL_INFORMATION_STATE, PERSONAL_INFORMATION_ZIP_CODE PERSONAL_INFORMATION_ZIP_CODE, PERSONAL_INFORMATION_EMERGENCY_CONTACT_NAME PERSONAL_INFORMATION_EMERGENCY_CONTACT_NAME, PERSONAL_INFORMATION_EMERGENCY_CONTACT_CELL_PHONE_NUMBER PERSONAL_INFORMATION_EMERGENCY_CONTACT_CELL_PHONE_NUMBER, PERSONAL_INFORMATION_EMERGENCY_CONTACT_HOME_PHONE_NUMBER PERSONAL_INFORMATION_EMERGENCY_CONTACT_HOME_PHONE_NUMBER, PERSONAL_INFORMATION_RELATION_TO_CAREGIVER PERSONAL_INFORMATION_RELATION_TO_CAREGIVER, PERSONAL_INFORMATION_HOW_DID_YOU_HEAR_ABOUT_THIS_JOB PERSONAL_INFORMATION_HOW_DID_YOU_HEAR_ABOUT_THIS_JOB, PERSONAL_INFORMATION_IF_OTHER_WHERE PERSONAL_INFORMATION_IF_OTHER_WHERE, PERSONAL_INFORMATION_DO_YOU_HAVE_A_RELATIVE_THAT_WORKS_FOR_HELP_AT_HOME_IF_SO_WHAT_IS_THEIR_NAME PERSONAL_INFORMATION_DO_YOU_HAVE_A_RELATIVE_THAT_WORKS_FOR_HELP_AT_HOME_IF_SO_WHAT_IS_THEIR_NAME, PERSONAL_INFORMATION_AVAILABLE_DAYS PERSONAL_INFORMATION_AVAILABLE_DAYS, PERSONAL_INFORMATION_HAVE_YOU_PREVIOUSLY_WORKED_FOR_HELP_AT_HOME PERSONAL_INFORMATION_HAVE_YOU_PREVIOUSLY_WORKED_FOR_HELP_AT_HOME, PERSONAL_INFORMATION_DO_YOU_HAVE_THE_LEGAL_RIGHT_TO_WORK_IN_THE_US_WITHOUT_SPONSORSHIPS PERSONAL_INFORMATION_DO_YOU_HAVE_THE_LEGAL_RIGHT_TO_WORK_IN_THE_US_WITHOUT_SPONSORSHIPS, PERSONAL_INFORMATION_DO_YOU_HAVE_A_COPY_OF_A_TB_TEST_COMPLETED_LESS_THAN_12_MONTHS_AGO PERSONAL_INFORMATION_DO_YOU_HAVE_A_COPY_OF_A_TB_TEST_COMPLETED_LESS_THAN_12_MONTHS_AGO, EDUCATION_HISTORY_DO_YOU_HAVE_A_HIGH_SCHOOL_DIPLOMA_OR_GED EDUCATION_HISTORY_DO_YOU_HAVE_A_HIGH_SCHOOL_DIPLOMA_OR_GED, EDUCATION_HISTORY_IF_YES_WHAT_IS_THE_NAME_OF_THE_SCHOOL EDUCATION_HISTORY_IF_YES_WHAT_IS_THE_NAME_OF_THE_SCHOOL, EMPLOYMENT_HISTORY_1__EMPLOYER_NAME EMPLOYMENT_HISTORY_1__EMPLOYER_NAME, EMPLOYMENT_HISTORY_2__EMPLOYER_NAME EMPLOYMENT_HISTORY_2__EMPLOYER_NAME, EMPLOYMENT_HISTORY_3__EMPLOYER_NAME EMPLOYMENT_HISTORY_3__EMPLOYER_NAME, EMPLOYMENT_HISTORY_1__EMPLOYER_CITY EMPLOYMENT_HISTORY_1__EMPLOYER_CITY, EMPLOYMENT_HISTORY_2__EMPLOYER_CITY EMPLOYMENT_HISTORY_2__EMPLOYER_CITY, EMPLOYMENT_HISTORY_3__EMPLOYER_CITY EMPLOYMENT_HISTORY_3__EMPLOYER_CITY, EMPLOYMENT_HISTORY_1__EMPLOYER_STATE EMPLOYMENT_HISTORY_1__EMPLOYER_STATE, EMPLOYMENT_HISTORY_2__EMPLOYER_STATE EMPLOYMENT_HISTORY_2__EMPLOYER_STATE, EMPLOYMENT_HISTORY_3__EMPLOYER_STATE EMPLOYMENT_HISTORY_3__EMPLOYER_STATE, EMPLOYMENT_HISTORY_1__EMPLOYER_PHONE_NUMBER EMPLOYMENT_HISTORY_1__EMPLOYER_PHONE_NUMBER, EMPLOYMENT_HISTORY_2__EMPLOYER_PHONE_NUMBER EMPLOYMENT_HISTORY_2__EMPLOYER_PHONE_NUMBER, EMPLOYMENT_HISTORY_3__EMPLOYER_PHONE_NUMBER EMPLOYMENT_HISTORY_3__EMPLOYER_PHONE_NUMBER, EMPLOYMENT_HISTORY_1__SUPERVISOR_NAME EMPLOYMENT_HISTORY_1__SUPERVISOR_NAME, EMPLOYMENT_HISTORY_2__SUPERVISOR_NAME EMPLOYMENT_HISTORY_2__SUPERVISOR_NAME, EMPLOYMENT_HISTORY_3__SUPERVISOR_NAME EMPLOYMENT_HISTORY_3__SUPERVISOR_NAME, EMPLOYMENT_HISTORY_1__POSITION EMPLOYMENT_HISTORY_1__POSITION, EMPLOYMENT_HISTORY_2__POSITION EMPLOYMENT_HISTORY_2__POSITION, EMPLOYMENT_HISTORY_3__POSITION EMPLOYMENT_HISTORY_3__POSITION, EMPLOYMENT_HISTORY_1__DATE_STARTED EMPLOYMENT_HISTORY_1__DATE_STARTED, EMPLOYMENT_HISTORY_2__DATE_STARTED EMPLOYMENT_HISTORY_2__DATE_STARTED, EMPLOYMENT_HISTORY_3__DATE_STARTED EMPLOYMENT_HISTORY_3__DATE_STARTED, EMPLOYMENT_HISTORY_1__DATE_ENDED EMPLOYMENT_HISTORY_1__DATE_ENDED, EMPLOYMENT_HISTORY_2__DATE_ENDED EMPLOYMENT_HISTORY_2__DATE_ENDED, EMPLOYMENT_HISTORY_3__DATE_ENDED EMPLOYMENT_HISTORY_3__DATE_ENDED, EMPLOYMENT_HISTORY_1__REASON_FOR_LEAVING EMPLOYMENT_HISTORY_1__REASON_FOR_LEAVING, EMPLOYMENT_HISTORY_2__REASON_FOR_LEAVING EMPLOYMENT_HISTORY_2__REASON_FOR_LEAVING, EMPLOYMENT_HISTORY_3__REASON_FOR_LEAVING EMPLOYMENT_HISTORY_3__REASON_FOR_LEAVING, REFERENCES_REFERENCES REFERENCES_REFERENCES, REFERENCES_NAME_OF_REFERENCE_1 REFERENCES_NAME_OF_REFERENCE_1, REFERENCES_PHONE_NUMBER_1 REFERENCES_PHONE_NUMBER_1, REFERENCES_RELATIONSHIP_1 REFERENCES_RELATIONSHIP_1, REFERENCES_NAME_OF_REFERENCE_2 REFERENCES_NAME_OF_REFERENCE_2, REFERENCES_REFERENCE_2_PHONE_NUMBER REFERENCES_REFERENCE_2_PHONE_NUMBER, REFERENCES_REFERENCE_2_RELATIONSHIP REFERENCES_REFERENCE_2_RELATIONSHIP, EQUAL_EMPLOYMENT_OPPORTUNITY_EEO_VOLUNTARY_SELFIDENTIFICATION EQUAL_EMPLOYMENT_OPPORTUNITY_EEO_VOLUNTARY_SELFIDENTIFICATION, EQUAL_EMPLOYMENT_OPPORTUNITY_EQUAL_EMPLOYMENT_OPPORTUNITY EQUAL_EMPLOYMENT_OPPORTUNITY_EQUAL_EMPLOYMENT_OPPORTUNITY, EQUAL_EMPLOYMENT_OPPORTUNITY_WHAT_IS_YOUR_PREFERRED_LANGUAGE_FOR_COMMUNICATION EQUAL_EMPLOYMENT_OPPORTUNITY_WHAT_IS_YOUR_PREFERRED_LANGUAGE_FOR_COMMUNICATION, PROOF_OF_RESIDENCY_HAVE_YOU_BEEN_A_RESIDENT_OF_OHIO_FOR_5_CONSECUTIVE_YEARS PROOF_OF_RESIDENCY_HAVE_YOU_BEEN_A_RESIDENT_OF_OHIO_FOR_5_CONSECUTIVE_YEARS, ATTESTATION_PLEASE_READ_AND_SIGN_THIS_FORM_IN_THE_SPACE_PROVIDED_BELOW ATTESTATION_PLEASE_READ_AND_SIGN_THIS_FORM_IN_THE_SPACE_PROVIDED_BELOW, ATTESTATION_PLEASE_CONFIRM_YOU_HAVE_REVIEWED_THE_STATEMENT_ABOVE_AND_AGREE_TO_THE_TERMS ATTESTATION_PLEASE_CONFIRM_YOU_HAVE_REVIEWED_THE_STATEMENT_ABOVE_AND_AGREE_TO_THE_TERMS,BACKGROUND_CHECK_CONSENT_FORM_BACKGROUND_CHECK_CONSENT_FORM BACKGROUND_CHECK_CONSENT_FORM_BACKGROUND_CHECK_CONSENT_FORM, FINAL_SUBMISSION FINAL_SUBMISSION, :TASKKEY AS ETL_TASK_KEY, :TASKKEY AS ETL_INSERTED_TASK_KEY, CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_INSERTED_DATE, CURRENT_USER() AS ETL_INSERTED_BY, CURRENT_TIMESTAMP::TIMESTAMP_NTZ(9) AS ETL_LAST_UPDATED_DATE, CURRENT_USER() AS ETL_LAST_UPDATED_BY, 0 AS ETL_DELETED_FLAG  FROM DISC_PROD.PARADOX.HIST_CANDIDATE_FORM_OH WHERE ETL_LAST_UPDATED_DATE = (SELECT MAX(ETL_LAST_UPDATED_DATE) FROM DISC_PROD.PARADOX.HIST_CANDIDATE_FORM_OH); 

    RETURN ''SUCCESS'';
END;

';