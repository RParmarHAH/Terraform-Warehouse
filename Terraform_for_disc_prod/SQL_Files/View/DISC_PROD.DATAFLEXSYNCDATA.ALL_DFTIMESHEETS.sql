create or replace view DISC_PROD.DATAFLEXSYNCDATA.ALL_DFTIMESHEETS(
	DBNAME,
	REFERENCENO,
	WEEKENDDATE,
	CLIENTNUMBER,
	EMPLOYEENUMBER,
	CONTRACTCODE,
	PAYROLLDATE,
	BILLCODE,
	REVIEWED,
	SUBMITTED,
	MILEAGE,
	MILEAGEBILLED,
	HOURVALUES,
	BILLEDFLAG,
	BILLEDSUPPLEMENTNO,
	HIGHSUPPLEMENTNO,
	PAIDFLAG,
	CREATEDDATE,
	UPDATEBATCH,
	UPDATEDTIME,
	OFFCENO,
	SUPERVISORCODE,
	CHANGEDBY,
	CHANGEDTIME,
	AUDITTRAILNO,
	SEQENCENO,
	TRACKINGID,
	ISEVV,
	TIMESHEETTYPE,
	SYS_CHANGE_VERSION,
	SYS_CHANGE_OPERATION,
	ETL_TASK_KEY,
	ETL_INSERTED_TASK_KEY,
	ETL_INSERTED_DATE,
	ETL_INSERTED_BY,
	ETL_LAST_UPDATED_DATE,
	ETL_LAST_UPDATED_BY,
	ETL_DELETED_FLAG
) as (
WITH HOURS AS (
	SELECT 
		OLDRECNUM,
		IFF(MON_HOURS = 0, '', TO_VARCHAR(DATEADD(DAY, -6, WEEK_END_DATE),'MM-DD-YYYY')) AS MON_DATES_CLN,
		IFF(TUE_HOURS = 0, '', TO_VARCHAR(DATEADD(DAY, -5, WEEK_END_DATE),'MM-DD-YYYY')) AS TUE_DATES_CLN,
		IFF(WED_HOURS = 0, '', TO_VARCHAR(DATEADD(DAY, -4, WEEK_END_DATE),'MM-DD-YYYY')) AS WED_DATES_CLN,
		IFF(THU_HOURS = 0, '', TO_VARCHAR(DATEADD(DAY, -3, WEEK_END_DATE),'MM-DD-YYYY')) AS THU_DATES_CLN,
		IFF(FRI_HOURS = 0, '', TO_VARCHAR(DATEADD(DAY, -2, WEEK_END_DATE),'MM-DD-YYYY')) AS FRI_DATES_CLN,
		IFF(SAT_HOURS = 0, '', TO_VARCHAR(DATEADD(DAY, -1, WEEK_END_DATE),'MM-DD-YYYY')) AS SAT_DATES_CLN,
		IFF(SUN_HOURS = 0, '', TO_VARCHAR(WEEK_END_DATE,'MM-DD-YYYY')) AS SUN_DATES_CLN,
		IFF(MON_HOURS = 0, NULL, (MON_HOURS::DECIMAL(10,3))::VARCHAR) AS MON_HOURS_CLN,
		IFF(TUE_HOURS = 0, NULL, (TUE_HOURS::DECIMAL(10,3))::VARCHAR) AS TUE_HOURS_CLN,
		IFF(WED_HOURS = 0, NULL, (WED_HOURS::DECIMAL(10,3))::VARCHAR) AS WED_HOURS_CLN,
		IFF(THU_HOURS = 0, NULL, (THU_HOURS::DECIMAL(10,3))::VARCHAR) AS THU_HOURS_CLN,
		IFF(FRI_HOURS = 0, NULL, (FRI_HOURS::DECIMAL(10,3))::VARCHAR) AS FRI_HOURS_CLN,
		IFF(SAT_HOURS = 0, NULL, (SAT_HOURS::DECIMAL(10,3))::VARCHAR) AS SAT_HOURS_CLN,
		IFF(SUN_HOURS = 0, NULL, (SUN_HOURS::DECIMAL(10,3))::VARCHAR) AS SUN_HOURS_CLN,
		IFF(TRIM(MON_BILLED) = 'Y', '_True', '_False') AS MON_BILLED_CLN,
		IFF(TRIM(TUE_BILLED) = 'Y', '_True', '_False') AS TUE_BILLED_CLN,
		IFF(TRIM(WED_BILLED) = 'Y', '_True', '_False') AS WED_BILLED_CLN,
		IFF(TRIM(THU_BILLED) = 'Y', '_True', '_False') AS THU_BILLED_CLN,
		IFF(TRIM(FRI_BILLED) = 'Y', '_True', '_False') AS FRI_BILLED_CLN,
		IFF(TRIM(SAT_BILLED) = 'Y', '_True', '_False') AS SAT_BILLED_CLN,
		IFF(TRIM(SUN_BILLED) = 'Y', '_True', '_False') AS SUN_BILLED_CLN,
		IFF(TRIM(MON_PAID) = 'Y', '_True', '_False') AS MON_PAID_CLN,
		IFF(TRIM(TUE_PAID) = 'Y', '_True', '_False') AS TUE_PAID_CLN,
		IFF(TRIM(WED_PAID) = 'Y', '_True', '_False') AS WED_PAID_CLN,
		IFF(TRIM(THU_PAID) = 'Y', '_True', '_False') AS THU_PAID_CLN,
		IFF(TRIM(FRI_PAID) = 'Y', '_True', '_False') AS FRI_PAID_CLN,
		IFF(TRIM(SAT_PAID) = 'Y', '_True', '_False') AS SAT_PAID_CLN,
		IFF(TRIM(SUN_PAID) = 'Y', '_True', '_False') AS SUN_PAID_CLN,
		IFNULL(MON_DATES_CLN || '_' || MON_HOURS_CLN || MON_BILLED_CLN || MON_PAID_CLN || ';','') ||
		IFNULL(TUE_DATES_CLN || '_' || TUE_HOURS_CLN || TUE_BILLED_CLN || TUE_PAID_CLN || ';','') ||
		IFNULL(WED_DATES_CLN || '_' || WED_HOURS_CLN || WED_BILLED_CLN || WED_PAID_CLN || ';','') ||
		IFNULL(THU_DATES_CLN || '_' || THU_HOURS_CLN || THU_BILLED_CLN || THU_PAID_CLN || ';','') ||
		IFNULL(FRI_DATES_CLN || '_' || FRI_HOURS_CLN || FRI_BILLED_CLN || FRI_PAID_CLN || ';','') ||
		IFNULL(SAT_DATES_CLN || '_' || SAT_HOURS_CLN || SAT_BILLED_CLN || SAT_PAID_CLN || ';','') ||
		IFNULL(SUN_DATES_CLN || '_' || SUN_HOURS_CLN || SUN_BILLED_CLN || SUN_PAID_CLN || ';','') AS HOURVALUES
	FROM
		DATAFLEXSYNCDATA.IL_HOURSOL1
	WHERE WEEK_END_DATE IS NOT NULL
)
SELECT
	DBNAME,
	REFERENCENO::VARCHAR AS REFERENCENO,
	WEEKENDDATE,
	CLIENTNUMBER,
	EMPLOYEENUMBER,
	CONTRACTCODE,
	PAYROLLDATE,
	BILLCODE,
	REVIEWED,
	SUBMITTED,
	MILEAGE,
	MILEAGEBILLED,
	HOURVALUES,
	BILLEDFLAG,
	BILLEDSUPPLEMENTNO,
	HIGHSUPPLEMENTNO,
	PAIDFLAG,
	CREATEDDATE,
	UPDATEBATCH,
	UPDATEDTIME,
	OFFCENO,
	SUPERVISORCODE,
	CHANGEDBY,
	CHANGEDTIME,
	AUDITTRAILNO,
	SEQENCENO,
	TRACKINGID,
	ISEVV,
	TIMESHEETTYPE,
	SYS_CHANGE_VERSION,
	SYS_CHANGE_OPERATION,
	ETL_TASK_KEY,
	ETL_INSERTED_TASK_KEY,
	ETL_INSERTED_DATE,
	ETL_INSERTED_BY,
	ETL_LAST_UPDATED_DATE,
	ETL_LAST_UPDATED_BY,
	ETL_DELETED_FLAG
FROM 
	DATAFLEXSYNCDATA.DFTIMESHEETS
UNION ALL
SELECT
	'IL' AS DBNAME,
	'OLD_' || IL.OLDRECNUM AS REFERENCENO,
	IL.WEEK_END_DATE AS WEEKENDDATE,
	IL.CLIENT_NUMBER AS CLIENTNUMBER,
	IL.EMP_NUMBER AS EMPLOYEENUMBER,
	TRIM(IL.CONTRACT) AS CONTRACTCODE,
	IL.PAYROLL_DATE AS PAYROLLDATE,
	TRIM(IL.LOGIN_NAME) AS BILLCODE,
	NULL AS REVIEWED,
	NULL AS SUBMITTED,
	NULL AS MILEAGE,
	NULL AS MILEAGEBILLED,
	HR.HOURVALUES AS HOURVALUES,
	TRIM(IL.BILLED_FLAG) AS BILLEDFLAG,
	IL.BILLED_SUPPL_NO AS BILLEDSUPPLEMENTNO,
	IL.HIGH_SUPPL_NO AS HIGHSUPPLEMENTNO,
	TRIM(IL.PAID_FLAG) AS PAIDFLAG,
	NULL AS CREATEDDATE,
	NULL AS UPDATEBATCH,
	NULL AS UPDATEDTIME,
	IL.OFFICE AS OFFCENO,
	TRIM(IL.SUPERVISOR) AS SUPERVISORCODE,
	TRIM(IL.CHANGED_BY) AS CHANGEDBY,
	TIMESTAMP_FROM_PARTS(IL.CHANGED_DATE::DATE, IL.CHANGED_TIME::TIME) AS CHANGEDTIME,
	IL.AUDIT_NUMBER AS AUDITTRAILNO,
	IL.SEQ_NUMBER AS SEQENCENO,
	IL.TRACKINGID AS TRACKINGID,
	TRIM(IL.ISEVV) AS ISEVV,
	TRIM(IL."TYPE") AS TIMESHEETTYPE,
	IL.SYS_CHANGE_VERSION AS SYS_CHANGE_VERSION,
	IL.SYS_CHANGE_OPERATION AS SYS_CHANGE_OPERATION,
	IL.ETL_TASK_KEY AS ETL_TASK_KEY,
	IL.ETL_INSERTED_TASK_KEY AS ETL_INSERTED_TASK_KEY,
	IL.ETL_INSERTED_DATE AS ETL_INSERTED_DATE,
	IL.ETL_INSERTED_BY AS ETL_INSERTED_BY,
	IL.ETL_LAST_UPDATED_DATE AS ETL_LAST_UPDATED_DATE,
	IL.ETL_LAST_UPDATED_BY AS ETL_LAST_UPDATED_BY,
	IL.ETL_DELETED_FLAG AS ETL_DELETED_FLAG
FROM
	DATAFLEXSYNCDATA.IL_HOURSOL1 IL
JOIN
	HOURS HR ON HR.OLDRECNUM = IL.OLDRECNUM 
);