create or replace view DISC_PROD.ASR.ASR_OLD_REVENUE(
	MASTER_ID,
	LAST_NAME,
	FIRST_NAME,
	CUSTOMER_ID,
	CUSTOMER,
	EMPLOYEE,
	EMPLOYEE_ID,
	PROGRAM,
	SERVICE_TYPE,
	PAYER_SOURCE,
	BILLING_CODE,
	LOCATION,
	VISIT_DATE,
	VISIT_STATUS,
	POS_HOURS,
	PAYABLE_OR_BILLIABLE_HRS,
	PAY_RATE,
	PAYABLE_AMOUNT,
	IS_PAID,
	BILLING_RATE,
	BILLING_PREMIUM,
	BILLING_PREMIUM_TAG,
	BILLING_AMOUNT,
	BILLING_TRAN_ID_NUMBER,
	BILLING_DATE,
	BILLING_MEMO,
	ETL_TASK_KEY,
	ETL_INSERTED_TASK_KEY,
	ETL_INSERTED_DATE,
	ETL_INSERTED_BY,
	ETL_LAST_UPDATED_DATE,
	ETL_LAST_UPDATED_BY,
	ETL_DELETED_FLAG
) as 
WITH RAW_DATA AS 
(
SELECT DISTINCT --CUSTOMER , -- POSITION (',', CUSTOMER) AS POSITON, LENGTH (CUSTOMER) AS LENTH,
TRIM(UPPER(SUBSTRING(CUSTOMER,0,POSITION (',', CUSTOMER)-1))) AS LAST_NAME,  
TRIM(UPPER(SUBSTRING(CUSTOMER,POSITION (',', CUSTOMER)+1, LENGTH(CUSTOMER)-POSITION (',', CUSTOMER)))) AS FIRST_NAME , *
FROM DISC_PROD.ASR."ASR_P&R2022" MATT
)
SELECT M.MASTER_ID  AS MASTER_ID, R.* 
FROM RAW_DATA R 
LEFT JOIN DISC_DEDUPE_PROD.ASR.CLIENT_MASTER_LIST  M ON  TRIM(UPPER(M.FIRSTNAME)) = TRIM(UPPER(R.FIRST_NAME)) 
AND TRIM(UPPER(M.LASTNAME)) = TRIM(UPPER(R.LAST_NAME))
WHERE M.CLIENTID IS  NULL;